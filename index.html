

<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#050301">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Jadwal Offday</title>

  <style>
    :root{
      --bg:#0b1020;
      --text:#eef2ff;
      --muted:#aab3d1;
      --accent:#8b5cf6;
      --green:#22c55e;
      --radius:18px;
      --shadow:0 20px 60px rgba(0,0,0,.45);
      --ring:0 0 0 2px rgba(139,92,246,.25);
      --gold:#f6d365;
      --gold2:#fda085;
    }
    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background: url("https://mariterbang.io/download/RiKzs6Ne.png")
                  center/cover no-repeat fixed;
      min-height:100vh;
      width:100vw;
      display:block;
      padding:0;
      overflow-x:hidden;
      position:relative;
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:
        radial-gradient(1200px 900px at 50% 30%,
          rgba(0,0,0,0.12) 0%,
          rgba(0,0,0,0.42) 60%);
      pointer-events:none;
      z-index:-1;
    }

    .app{
      width:100%;
      max-width:none;
      min-height:100vh;
      display:grid;
      gap:14px;
      padding:16px;
    }

    .header{
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 16px; background:rgba(255,255,255,.06); border-radius:18px;
      box-shadow:var(--shadow); backdrop-filter:blur(10px);
      position:sticky; top:0; z-index:10;
      gap:10px; flex-wrap:wrap;
    }
    .brand{display:flex; gap:10px; align-items:center;}
    .logo{
      width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
      background:conic-gradient(from 120deg,var(--accent),#06b6d4,#f59e0b,var(--accent));
      font-weight:900;
    }
    .brand h1{margin:0; font-size:18px}
    .brand p{margin:2px 0 0; font-size:12px; color:var(--muted)}

    .controls{display:flex; gap:8px; flex-wrap:wrap;}
    button{
      border:0; background:rgba(255,255,255,.04); color:var(--text); cursor:pointer; font-weight:700;
      padding:9px 12px; border-radius:12px; transition:.15s; outline:none;
    }
    button:hover{transform:translateY(-1px); background:rgba(255,255,255,.08)}
    button:focus-visible{box-shadow:var(--ring)}
    .btn-green{background:rgba(34,197,94,.16)}
    .btn-green:hover{background:rgba(34,197,94,.26)}
    .btn-accent{background:rgba(139,92,246,.18)}
    .btn-accent:hover{background:rgba(139,92,246,.28)}
    .btn-danger{background:rgba(244,63,94,.18)}
    .btn-danger:hover{background:rgba(244,63,94,.28)}
    .btn-amber{background:rgba(245,158,11,.16)}
    .btn-amber:hover{background:rgba(245,158,11,.26)}

    .top-tabs{
      display:flex; gap:8px; align-items:center; justify-content:center;
      padding:6px 8px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      backdrop-filter: blur(8px);
      flex-wrap:wrap;
    }
    .tab-btn{
      border:0; cursor:pointer; font-weight:900; letter-spacing:.4px;
      font-size:12px; padding:7px 10px; border-radius:10px;
      color:#e2e8f0; background:rgba(255,255,255,.06);
      transition:.15s; text-transform:uppercase; white-space:nowrap;
    }
    .tab-btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.12)}
    .tab-btn.active{
      background:rgba(139,92,246,.85);
      color:white;
      box-shadow:0 6px 20px rgba(139,92,246,.45);
    }

    .panel{
      background:rgba(255,255,255,.06); border-radius:18px;
      box-shadow:var(--shadow); backdrop-filter:blur(10px); padding:12px;
      display:flex; flex-direction:column;
      min-height:calc(100vh - 130px);
    }

    .cal-head{
      display:flex; justify-content:space-between; align-items:center;
      padding:8px; background:rgba(255,255,255,.04); border-radius:14px; margin-bottom:8px;
    }
    .month{font-weight:900; letter-spacing:.3px}
    .weekdays{
      display:grid; grid-template-columns:repeat(7,1fr); gap:8px;
      padding:4px 6px 8px; color:#dde3f7; font-size:12px; font-weight:900;
      text-transform:uppercase;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:10px;
      padding:8px;
      flex:1;
      grid-auto-rows: minmax(190px, 1fr);
      align-items: stretch;
    }

    .day{
      min-height:190px; height:100%;
      border-radius:14px; padding:8px;
      background: linear-gradient(145deg,
          rgba(245, 247, 255, 0.95) 0%,
          rgba(205, 210, 225, 0.92) 32%,
          rgba(160, 165, 185, 0.98) 68%,
          rgba(235, 238, 248, 0.92) 100%);
      border:1px solid rgba(255,255,255,0.22);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.55),
        inset 0 -10px 22px rgba(0,0,0,0.35),
        0 10px 30px rgba(0,0,0,0.45);
      display:flex; flex-direction:column; gap:6px;
      cursor:pointer; position:relative; overflow:hidden;
      transition:.15s; color:#0b1020;
    }
    .day:hover{transform:translateY(-2px)}
    .day.muted{opacity:.25; cursor:default; box-shadow:none}

    .date-row{display:flex; align-items:center; gap:6px; font-weight:900; font-size:14px;}
    .badge{
      font-size:10px; padding:2px 6px; border-radius:999px; font-weight:900;
      background: rgba(15, 23, 42, 0.12);
      color: #111827; border: 1px solid rgba(15, 23, 42, 0.18);
      text-transform:uppercase; letter-spacing:.3px;
    }
    .day.weekend .badge{
      background: rgba(245,158,11,0.18);
      border-color: rgba(245,158,11,0.35);
    }

    .day.off{ box-shadow: inset 0 1px 0 rgba(255,255,255,0.75),
                       inset 0 -14px 26px rgba(0,0,0,0.45),
                       0 0 24px rgba(220,225,240,0.9); }
    .day.blocked{
      background: linear-gradient(145deg,#785500,#f5be28,#aa780a,#ffd75a);
      border-color:#ffd75a; color:#1a1200;
    }

    .day.cuti{
      background: linear-gradient(145deg,#d2ebff,#aad7ff,#78b4f0,#ebf8ff);
      border-color:#8cc8ff; color:#031628;
    }
    .day.bagan{
      background: linear-gradient(145deg,#ebe6ff,#d2c8f5,#afa5dc,#f5f2ff);
      border-color:#c8b9ff; color:#16092a;
    }

    .dot{
      position:absolute; right:8px; bottom:8px; width:10px; height:10px; border-radius:50%;
      background:transparent; box-shadow:0 0 0 2px rgba(15,23,42,.18) inset;
    }
    .day.off .dot,.day.blocked .dot,.day.cuti .dot,.day.bagan .dot{
      background:#fff; box-shadow:0 0 12px rgba(255,255,255,.95);
    }

    .names-mini{
      font-size:12.5px; color:#0b0b0b; line-height:1.2; font-weight:900;
      display:grid; gap:4px; margin-top:2px;
    }
    .names-mini .line{display:flex; gap:6px; padding:2px 4px; border-radius:6px}
    .names-mini .empty{opacity:.7; font-weight:700}

    .today{outline:2px dashed rgba(34,197,94,.9); outline-offset:-2px;}

    /* ====== HEADERS ====== */
    .section-head{
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      background:rgba(255,255,255,.05);
      border-radius:14px;
      margin-bottom:10px;
    }
    .section-title{
      justify-self:center;
      font-weight:900;
      letter-spacing:.5px;
      text-transform:uppercase;
      text-align:center;
      padding:8px 14px;
      border-radius:14px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      min-width:min(520px, 90%);
      color:#f8fafc;
    }
    @media (max-width: 700px){
      .section-title{min-width:unset; width:100%;}
      .section-head{grid-template-columns:1fr;}
      .section-head > div:last-child{justify-self:center;}
    }

    /* ====== TEKS HIDUP ====== */
    @supports (-webkit-background-clip:text) or (background-clip:text){
      .section-title{
        position:relative;
        overflow:hidden;
        color: transparent !important;
        -webkit-text-fill-color: transparent;
        -webkit-background-clip: text;
        background-clip: text;
        background-size: 220% 220%;
        animation: titleFlow 4.5s ease-in-out infinite;
        text-shadow: 0 10px 30px rgba(0,0,0,.35);
      }
      .section-title::after{
        content:"";
        position:absolute;
        inset:-40% -60%;
        background: linear-gradient(120deg,
          transparent 0%,
          rgba(255,255,255,.22) 45%,
          rgba(255,255,255,.45) 50%,
          rgba(255,255,255,.22) 55%,
          transparent 100%
        );
        transform: translateX(-60%);
        animation: titleShine 3.2s ease-in-out infinite;
        pointer-events:none;
        mix-blend-mode: screen;
      }
      .section-title.title-cuti{
        background-image: linear-gradient(90deg,#38bdf8 0%,#a78bfa 35%,#22c55e 70%,#38bdf8 100%);
      }
      .section-title.title-bagan{
        background-image: linear-gradient(90deg,#f59e0b 0%,#f97316 35%,#ec4899 70%,#f59e0b 100%);
      }
      .section-title.title-piket{
        background-image: linear-gradient(90deg,#e5e7eb 0%,#94a3b8 30%,#f8fafc 55%,#6b7280 80%,#e5e7eb 100%);
        animation-duration: 5.2s;
      }
      .section-title.title-cs{
        background-image: linear-gradient(90deg,#22c55e 0%,#06b6d4 35%,#a78bfa 70%,#22c55e 100%);
      }
      .section-title.title-catatan{
        background-image: linear-gradient(90deg,#FFE5E5 0%,#FFAAAA 35%,#FF6B6B 70%,#FFE5E5 100%);
      }

      @keyframes titleFlow{
        0%   { background-position: 0% 50%; }
        50%  { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      @keyframes titleShine{
        0%   { transform: translateX(-60%) rotate(2deg); opacity:0; }
        20%  { opacity:.55; }
        50%  { transform: translateX(60%) rotate(2deg); opacity:.35; }
        100% { transform: translateX(60%) rotate(2deg); opacity:0; }
      }
    }
    @media (prefers-reduced-motion: reduce){
      .section-title, .section-title::after{ animation:none !important; }
    }

    /* ===== CUTI ===== */
    .cuti-panel{display:none;}
    .cuti-table-wrap{
      width:100%;
      overflow:auto;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      box-shadow:var(--shadow);
    }
    table.cuti-table{
      width:100%;
      border-collapse:collapse;
      min-width:850px;
      font-size:14px;
    }
    .cuti-table thead th{
      background:linear-gradient(90deg, var(--gold), var(--gold2));
      color:#0b1020;
      text-align:center;
      padding:12px 10px;
      font-weight:900;
      letter-spacing:.4px;
      position:sticky; top:0; z-index:1;
    }
    .cuti-table tbody td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.12);
      text-align:center;
      font-weight:800;
      color:#f8fafc;
      background:rgba(0,0,0,.25);
    }
    .cuti-table tbody tr:hover td{background:rgba(255,255,255,.06)}
    .cuti-table td.name{text-align:left; padding-left:16px;}
    .cuti-table .info-btn{
      padding:6px 10px; border-radius:6px;
      background:#0ea5e9; color:white; font-weight:900; font-size:12px;
    }
    .cuti-table .del-btn{
      padding:6px 10px; border-radius:6px;
      background:#ef4444; color:white; font-weight:900; font-size:12px;
      margin-left:6px;
    }

    /* ===== BAGAN ===== */
    .bagan-panel{display:none;}
    .bagan-wrap{
      position:relative;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.45);
      box-shadow:var(--shadow);
      padding:14px;
      overflow:auto;
      min-height:65vh;
    }
    .bagan-board{
      display:grid;
      grid-auto-rows:70px;
      gap:10px;
      width:max-content;
      padding:8px;
      background:rgba(255,255,255,.04);
      border-radius:12px;
    }
    .seat{
      position:relative;
      border-radius:10px;
      background: linear-gradient(145deg,#f6d365,#fda085);
      color:#111827;
      font-weight:900;
      font-size:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:6px;
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.7),
        0 8px 18px rgba(0,0,0,.6);
      cursor:pointer;
      user-select:none;
      border:2px solid rgba(120,70,0,.7);
    }
    .seat.empty{
      opacity:.5;
      background:linear-gradient(145deg,#cbd5e1,#94a3b8);
      border-color:rgba(0,0,0,.25);
    }
    .seat small{
      position:absolute;
      top:-7px; left:6px;
      background:#0b1020;
      color:#e2e8f0;
      font-size:9px;
      padding:2px 5px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.2);
      min-width:20px;
      text-align:center;
    }
    .seat.dragging{opacity:.35; transform:scale(.98);}
    .seat.drop-target{outline:2px dashed #22c55e; outline-offset:2px;}
    .seat.hidden{
      visibility: hidden;
      pointer-events: none;
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
    }

    /* ===== MODAL ===== */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(2,6,23,.6); display:none;
      place-items:center; padding:18px; z-index:50; backdrop-filter: blur(4px);
    }
    .modal{
      width:min(820px,100%);
      background:#0e1430; border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:14px; box-shadow:var(--shadow);
      color:var(--text);
      display:grid; grid-template-columns: 1.2fr .8fr; gap:12px;
    }
    .modal h3{margin:0 0 6px; font-size:16px}
    .modal .sub{color:var(--muted); font-size:12px; margin-bottom:10px}

    .names-grid{display:grid; grid-template-columns:1fr; gap:8px;}
    .names-grid input{
      width:100%; padding:9px 10px; border-radius:10px; outline:none;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      color:var(--text); font-size:13px;
    }

    .modal-actions{
      display:flex; justify-content:space-between; gap:8px; margin-top:12px; flex-wrap:wrap;
      grid-column: 1 / -1;
    }
    .left-actions,.right-actions{display:flex; gap:8px; flex-wrap:wrap;}

    .role-row{display:grid; grid-template-columns:1.6fr 0.9fr; gap:8px;}
    .select-wrap{position:relative; width:100%;}
    .role-select{
      appearance:none; width:100%; padding:9px 34px 9px 10px; border-radius:10px;
      border:1px solid rgba(255,255,255,.12); outline:none; font-size:12.5px; font-weight:900;
      letter-spacing:.3px; background:#202741; color:#eef2ff;
    }
    .select-wrap .chev{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      font-size:12px; opacity:.7; pointer-events:none;
    }

    .role-pill{
      font-size:9.5px; font-weight:900; padding:2px 6px; border-radius:999px;
      border:1px solid rgba(15,23,42,.18); text-transform:uppercase; white-space:nowrap;
    }

    .copy-panel{
      background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px; padding:10px; display:flex; flex-direction:column; gap:8px;
      height:100%;
    }
    .copy-panel textarea{
      width:100%; flex:1; min-height:220px; resize:vertical; border-radius:10px; padding:10px;
      font-size:12.5px; line-height:1.4; background:#0b1020; color:#eef2ff;
      border:1px dashed rgba(255,255,255,.18); outline:none; white-space:pre;
    }

    .cuti-form{
      display:grid; gap:8px;
      grid-template-columns:1fr 1fr;
    }
    .cuti-form .full{grid-column:1/-1;}
    .cuti-form label{font-size:12px; font-weight:900; letter-spacing:.3px;}
    .cuti-form input, .cuti-form textarea{
      width:100%; padding:9px 10px; border-radius:10px; outline:none;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      color:var(--text); font-size:13px;
    }
    .cuti-form textarea{min-height:90px; resize:vertical;}

    .toast{
      position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
      background:rgba(0,0,0,.7); color:white; padding:10px 12px; border-radius:10px;
      font-size:13px; opacity:0; pointer-events:none; transition:.2s; z-index:99;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px);}

    /* ===== PIKET ===== */
    .piket-panel{display:none;}
    .piket-panel .cuti-table thead th{
      background: linear-gradient(90deg,#111827,#334155);
      color:#f8fafc;
    }
    
    .piket-name {
      display: inline-block;
      padding: 6px 8px;
      margin: 2px;
      border-radius: 10px;
      font-weight: 900;
      cursor: pointer;
      min-width: 70px;
      text-align: center;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.10);
      
      color: #FFE5E5;
      text-shadow: 
        0 0 8px rgba(255, 100, 100, 0.7),
        0 0 12px rgba(255, 200, 200, 0.5),
        0 0 20px rgba(255, 255, 255, 0.3);
      
      background-image: linear-gradient(
        180deg,
        rgba(255, 245, 245, 0.9) 0%,
        rgba(255, 230, 230, 0.8) 25%,
        rgba(255, 210, 210, 0.7) 50%,
        rgba(255, 190, 190, 0.6) 75%,
        rgba(255, 170, 170, 0.5) 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 200, 200, 0.5);
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.6),
        0 4px 12px rgba(255, 100, 100, 0.4);
    }

    .piket-name.empty {
      opacity: 0.55;
      font-weight: 800;
      background-image: none;
      -webkit-background-clip: initial;
      background-clip: initial;
      -webkit-text-fill-color: initial;
      color: rgba(255, 255, 255, 0.55);
      text-shadow: none;
      border: 1px solid rgba(255, 255, 255, 0.14);
    }

    .piket-name:hover {
      transform: translateY(-1px);
      background-color: rgba(255, 200, 200, 0.15);
      box-shadow: 
        0 0 15px rgba(255, 100, 100, 0.8),
        0 0 25px rgba(255, 200, 200, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      transition: all 0.2s ease;
    }

    #piketPanel .piket-name {
      background: rgba(0, 0, 0, 0.28);
      border: 1px solid rgba(255, 255, 255, 0.14);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
      
      background-image: linear-gradient(
        135deg,
        #FFEAEA 0%,
        #FFDADA 25%,
        #FFCACA 50%,
        #FFBABA 75%,
        #FFAAAA 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 180, 180, 0.6);
      
      text-shadow: 
        0 0 10px rgba(255, 150, 150, 0.8),
        0 0 20px rgba(255, 100, 100, 0.6),
        0 0 30px rgba(255, 50, 50, 0.4);
      
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.7),
        0 8px 20px rgba(255, 100, 100, 0.5);
    }

    #piketPanel .piket-name.empty {
      background-image: none;
      -webkit-background-clip: initial;
      background-clip: initial;
      -webkit-text-fill-color: initial;
      color: rgba(255, 200, 200, 0.55);
      -webkit-text-stroke: 0;
      text-shadow: none;
      border: 1px solid rgba(255, 200, 200, 0.3);
    }

    /* ===== CS MAWAROTO TABLE ===== */
    .cs-panel{display:none;}
    .cs-wrap{
      width:100%;
      overflow:auto;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      box-shadow: var(--shadow);
    }
    table.cs-table{
      width:100%;
      border-collapse:collapse;
      min-width:920px;
      font-size:14px;
    }
    .cs-table thead th{
      background:linear-gradient(90deg,#22c55e,#06b6d4,#a78bfa);
      color:#06121a;
      text-align:center;
      padding:12px 10px;
      font-weight:900;
      letter-spacing:.4px;
      position:sticky; top:0; z-index:1;
    }
    .cs-table tbody td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.12);
      text-align:center;
      font-weight:900;
      color:#f8fafc;
      background:rgba(0,0,0,.25);
    }
    .cs-table tbody tr:hover td{background:rgba(255,255,255,.06)}
    .cs-table td.name{
      text-align:left;
      padding-left:16px;
      font-weight:900;
      color:#fff;
    }
    .cs-table td.name:hover{ text-decoration: underline; opacity: .95; }

    .cs-job-wrap{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
    }
    .cs-job-select{
      appearance:none;
      padding:8px 34px 8px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      outline:none;
      font-weight:900;
      font-size:12px;
      letter-spacing:.3px;
      background:#202741;
      color:#eef2ff;
      cursor:pointer;
      min-width:220px;
    }
    .cs-del-btn{
      padding:7px 10px;
      border-radius:10px;
      background:#ef4444;
      color:white;
      font-weight:900;
      border:0;
      cursor:pointer;
    }
    .cs-del-btn:hover{filter:brightness(1.05); transform:translateY(-1px);}

    .cs-panel .btn-green{
      background:rgba(34,197,94,.28);
      color:#eafff2;
      font-weight:900;
      border-radius:10px;
      padding:7px 10px;
      border:0;
      cursor:pointer;
    }
    .cs-panel .btn-green:hover{
      background:rgba(34,197,94,.38);
      transform:translateY(-1px);
    }

    .cs-add-btn{
      padding:9px 12px;
      border-radius:12px;
      background:rgba(34,197,94,.20);
      color:#eafff2;
      font-weight:900;
      border:0;
      cursor:pointer;
    }
    .cs-add-btn:hover{background:rgba(34,197,94,.30); transform:translateY(-1px);}
    .cs-reset-btn{
      padding:9px 12px;
      border-radius:12px;
      background:rgba(244,63,94,.20);
      color:#ffe9ed;
      font-weight:900;
      border:0;
      cursor:pointer;
    }
    .cs-reset-btn:hover{background:rgba(244,63,94,.30); transform:translateY(-1px);}

    @media (max-width: 700px){
      .modal{grid-template-columns:1fr;}
      .day{min-height:175px}
      .grid{ grid-auto-rows: minmax(175px,1fr); }
      .bagan-board{grid-template-columns:repeat(20, 80px);}
    }
  
    .cs-name-span{font-weight:900; letter-spacing:.2px;}

    /* ===== CATATAN PANEL ===== */
    .catatan-panel{display:none;}
    .catatan-container{
      display:flex;
      flex-direction:column;
      gap:15px;
      padding:10px;
    }
    
    .catatan-form{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px;
      padding:15px;
      margin-bottom:10px;
    }
    
    .catatan-form h3{
      margin:0 0 15px 0;
      color:#fff;
      font-size:16px;
      font-weight:900;
      letter-spacing:.5px;
      text-transform:uppercase;
      text-align:center;
      padding:8px 14px;
      border-radius:14px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
    }
    
    .catatan-form .form-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:10px;
    }
    
    .catatan-form input,
    .catatan-form textarea,
    .catatan-form select{
      flex:1;
      min-width:200px;
      padding:8px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-size:14px;
    }
    
    .catatan-form textarea{
      min-height:80px;
      resize:vertical;
      width:100%;
    }
    
    .catatan-list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    
    .catatan-item{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:10px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      overflow:hidden;
    }
    
    .catatan-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    
    .catatan-title{
      font-weight:bold;
      font-size:15px;
      font-weight:900;
      letter-spacing:.5px;
      
      /* Efek teks putih kemerahan metalik */
      color: transparent !important;
      background-image: linear-gradient(
        135deg,
        #FFEAEA 0%,
        #FFDADA 25%,
        #FFCACA 50%,
        #FFBABA 75%,
        #FFAAAA 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 
        0 0 10px rgba(255, 150, 150, 0.8),
        0 0 20px rgba(255, 100, 100, 0.6),
        0 0 30px rgba(255, 50, 50, 0.4);
    }
    
    .catatan-category{
      font-size:11px;
      padding:3px 8px;
      border-radius:20px;
      font-weight:900;
      letter-spacing:.3px;
    }
    
    .catatan-content{
      font-size:13px;
      line-height:1.4;
      margin:5px 0;
      padding:8px;
      border-radius:6px;
      background:rgba(0,0,0,.25);
      
      /* Efek teks putih kemerahan metalik untuk konten */
      color: #FFE5E5;
      text-shadow: 
        0 0 8px rgba(255, 100, 100, 0.7),
        0 0 12px rgba(255, 200, 200, 0.5),
        0 0 20px rgba(255, 255, 255, 0.3);
      
      border: 1px solid rgba(255, 180, 180, 0.3);
    }
    
    .catatan-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11px;
    }
    
    .catatan-date{
      opacity:.8;
      font-weight:900;
      
      /* Efek teks metalik untuk tanggal */
      color: #FFCACA;
      text-shadow: 
        0 0 5px rgba(255, 150, 150, 0.6),
        0 0 10px rgba(255, 100, 100, 0.4);
    }
    
    .catatan-actions{
      display:flex;
      gap:5px;
    }
    
    .catatan-btn{
      padding:4px 8px;
      border-radius:6px;
      font-size:11px;
      border:none;
      cursor:pointer;
      background:rgba(255,255,255,.08);
      color:var(--text);
      font-weight:900;
      letter-spacing:.3px;
      
      /* Efek tombol metalik */
      background-image: linear-gradient(
        180deg,
        rgba(255, 245, 245, 0.9) 0%,
        rgba(255, 230, 230, 0.8) 25%,
        rgba(255, 210, 210, 0.7) 50%,
        rgba(255, 190, 190, 0.6) 75%,
        rgba(255, 170, 170, 0.5) 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 200, 200, 0.5);
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.6),
        0 2px 4px rgba(255, 100, 100, 0.3);
    }
    
    .catatan-btn:hover{
      background-color: rgba(255, 200, 200, 0.15);
      transform:translateY(-1px);
      box-shadow: 
        0 0 10px rgba(255, 100, 100, 0.6),
        0 0 15px rgba(255, 200, 200, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    
    .catatan-btn.delete{
      background-image: linear-gradient(
        180deg,
        #FFCACA 0%,
        #FFAAAA 25%,
        #FF8A8A 50%,
        #FF6A6A 75%,
        #FF4A4A 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 100, 100, 0.6);
    }
    
    .catatan-btn.edit{
      background-image: linear-gradient(
        180deg,
        #FFF4CA 0%,
        #FFEAAA 25%,
        #FFE08A 50%,
        #FFD66A 75%,
        #FFCC4A 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 200, 100, 0.6);
    }
    
    .empty-catatan{
      text-align:center;
      padding:40px 20px;
      color:var(--muted);
      font-size:14px;
    }

    /* Kategori warna untuk catatan */
    .catatan-category[data-category="DI BAWAH 3 BULAN"] {
      background: rgba(34, 197, 94, 0.3);
      color: #a7f3d0;
      border: 1px solid rgba(34, 197, 94, 0.5);
    }
    
    .catatan-category[data-category="DI ATAS 3 BULAN"] {
      background: rgba(59, 130, 246, 0.3);
      color: #93c5fd;
      border: 1px solid rgba(59, 130, 246, 0.5);
    }
    
    .catatan-category[data-category="DI BAWAH 6 BULAN"] {
      background: rgba(245, 158, 11, 0.3);
      color: #fcd34d;
      border: 1px solid rgba(245, 158, 11, 0.5);
    }
    
    .catatan-category[data-category="DI ATAS 6 BULAN"] {
      background: rgba(139, 92, 246, 0.3);
      color: #c4b5fd;
      border: 1px solid rgba(139, 92, 246, 0.5);
    }
    
    .catatan-category[data-category="RESIGN"] {
      background: rgba(239, 68, 68, 0.3);
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, 0.5);
    }

    /* Menu Catatan di Top Tabs */
    #topTabs .tab-btn[data-type="CATATAN"] {
      background:rgba(255, 100, 100, 0.16);
      color:#FFCACA;
    }
    
    #topTabs .tab-btn[data-type="CATATAN"]:hover {
      background:rgba(255, 100, 100, 0.26);
    }
    
    #topTabs .tab-btn[data-type="CATATAN"].active {
      background:rgba(255, 100, 100, 0.85);
      color:#FFEAEA;
      box-shadow:0 6px 20px rgba(255, 100, 100, 0.45);
    }

    /* ===== MODAL PASSWORD RESET ===== */
    .password-modal .modal {
      width: min(400px, 90%);
      grid-template-columns: 1fr;
    }
    
    .password-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      font-size: 14px;
      margin: 10px 0;
      letter-spacing: 1px;
    }
    
    .password-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.25);
    }
    
    .password-hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 5px;
      text-align: center;
    }
  </style>

  <!-- Firebase SDK (v8 compat CDN) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD0gaCXH6ny4EwLwhJhUVAZzS5x1nLjs-s",
      authDomain: "dedy-b7d09.firebaseapp.com",
      databaseURL: "https://dedy-b7d09-default-rtdb.firebaseio.com",
      projectId: "dedy-b7d09",
      storageBucket: "dedy-b7d09.appspot.com",
      messagingSenderId: "908979972372",
      appId: "1:908979972372:web:93ebb4eb1bf20ab8f42f0a1"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>

<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="logo">OFF</div>
        <div>
          <img src="https://mawartotoday.com/assets/img/xj/logo.png?v=krjgviudzez0veqxtcqf" alt="MAWARTOTO Logo">
        </div>
      </div>

      <div class="top-tabs" id="topTabs">
        <button class="tab-btn active" data-type="ALL">ALL</button>
        <button class="tab-btn" data-type="OFF">OFFDAY</button>
        <button class="tab-btn" data-type="CUTI">CUTI</button>
        <button class="tab-btn" data-type="BAGAN_VIEW">BAGAN</button>
        <button class="tab-btn" data-type="PIKET">PIKET</button>
        <button class="tab-btn" data-type="CS_MAWAROTO">STAFF MAWAROTO</button>
        <button class="tab-btn" data-type="CATATAN">CATATAN</button>
      </div>

      <div class="controls">
        <button id="prev">‚Üê Bulan lalu</button>
        <button id="todayBtn" class="btn-green">Hari ini</button>
        <button id="next">Bulan depan ‚Üí</button>
        <button id="clear" class="btn-accent">Reset bulan ini</button>
        <button id="bulkImport" class="btn-accent">üì• Import Excel</button>
        <button id="lockBtn" class="btn-amber">üîí TERKUNCI</button>
      </div>
    </div>

    <!-- CALENDAR -->
    <section class="panel" id="calendarPanel">
      <div class="cal-head">
        <div style="display:flex; gap:6px">
          <button id="prevMini">‚Üê</button>
          <button id="nextMini">‚Üí</button>
        </div>
        <div class="month" id="monthLabel">-</div>
        <div><button id="jumpYear">Loncat Tahun</button></div>
      </div>

      <div class="weekdays" id="weekdays"></div>
      <div class="grid" id="grid"></div>
    </section>

    <!-- CUTI -->
    <section class="panel cuti-panel" id="cutiPanel">
      <div class="section-head">
        <div class="section-title title-cuti"> ‚ú® DAFTAR CUTI STAFF  ‚ú®</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addCutiBtn" class="btn-green">+ Tambah Cuti</button>
          <button id="resetCutiBtn" class="btn-danger">Reset CUTI</button>
          <button id="exportCutiBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="cuti-table-wrap">
        <table class="cuti-table">
          <thead>
            <tr>
              <th>Nama Staff</th>
              <th>Tanggal Cuti</th>
              <th>Selesai Cuti</th>
              <th>Info</th>
            </tr>
          </thead>
          <tbody id="cutiTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- BAGAN -->
    <section class="panel bagan-panel" id="baganPanel">
      <div class="section-head">
        <div class="section-title title-bagan">üåü TATA LETAK MEJA KERJA üåü</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addRowBtn" class="btn-green">+ Baris</button>
          <button id="addColBtn" class="btn-green">+ Kolom</button>
          <button id="removeColBtn" class="btn-danger">üóë Hapus Kolom</button>
          <button id="toggleDeleteSeatBtn" class="btn-amber">üßΩ MODE HAPUS: OFF</button>
          <button id="resetBaganBtn" class="btn-danger">Reset BAGAN</button>
          <button id="exportBaganBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="bagan-wrap">
        <div style="font-size:12px; opacity:.8; margin:0 0 10px;">
          Grid dinamis ‚Äî klik seat untuk edit nama.
          <br>Jika <b>MODE HAPUS ON</b>, klik seat ‚Üí kotak hilang tapi posisi lain tidak geser.
        </div>
        <div class="bagan-board" id="baganBoard"></div>
      </div>
    </section>

    <!-- PIKET -->
    <section class="panel piket-panel" id="piketPanel">
      <div class="section-head">
        <div class="section-title title-piket">‚¨áÔ∏è PIKET BUANG SAMPAH MAWARTOTO ‚¨áÔ∏è</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="resetPiketBtn" class="btn-danger">Reset Piket</button>
          <button id="exportPiketBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="cuti-table-wrap">
        <table class="cuti-table" id="piketTable">
          <thead>
            <tr>
              <th>Hari</th>
              <th colspan="8">PIKET SHIF PAGI</th>
            </tr>
          </thead>
          <tbody id="piketTableBody"></tbody>
        </table>
      </div>

      <div style="margin-top:10px; font-size:12px; opacity:.8;">
        Klik nama untuk edit. PIKET ini <b>tidak mempengaruhi</b> OFFDAY / CUTI / BAGAN.
      </div>
    </section>

    <!-- CS MAWAROTO -->
    <section class="panel cs-panel" id="csPanel">
      <div class="section-head">
        <div class="section-title title-cs">üë§ STAFF MAWAROTO üë§</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addCsBtn" class="cs-add-btn">+ Tambah CS</button>
          <button id="resetCsBtn" class="cs-reset-btn">Reset CS</button>
          <button id="exportCsBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="cs-wrap">
        <table class="cs-table">
          <thead>
            <tr>
              <th style="width:45%;">NAMA CS</th>
              <th style="width:30%;">JOBDESK</th>
              <th style="width:25%;">AKSI</th>
            </tr>
          </thead>
          <tbody id="csTableBody"></tbody>
        </table>
      </div>

      <div style="margin-top:10px; font-size:12px; opacity:.85;">
        Dropdown untuk <b>ganti jobdesk</b>. Tombol <b>‚Üí OFFDAY</b> untuk masukin nama ke kalender.
      </div>
    </section>

    <!-- CATATAN CS BARU & RESIGN -->
    <section class="panel catatan-panel" id="catatanPanel">
      <div class="section-head">
        <div class="section-title title-catatan">üìù INFO CS BARU & RESIGN üìù</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addCatatanBtn" class="btn-green">+ Tambah Catatan</button>
          <button id="resetCatatanBtn" class="btn-danger">Reset CATATAN</button>
          <button id="exportCatatanBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="catatan-container">
        <!-- Form Input Catatan -->
        <div class="catatan-form">
          <h3>MASUKAN NAMA STAFF</h3>
          <form id="catatanForm">
            <div class="form-row">
              <input type="text" id="catatanTitle" placeholder="Nama Staff" required>
              <select id="catatanCategory" required>
                <option value="">Pilih Kategori</option>
                <option value="DI BAWAH 3 BULAN">DI BAWAH 3 BULAN</option>
                <option value="DI ATAS 3 BULAN">DI ATAS 3 BULAN</option>
                <option value="DI BAWAH 6 BULAN">DI BAWAH 6 BULAN</option>
                <option value="DI ATAS 6 BULAN">DI ATAS 6 BULAN</option>
                <option value="RESIGN">RESIGN</option>
              </select>
            </div>
            <div class="form-row">
              <textarea id="catatanContent" placeholder="Isi catatan di sini..." required></textarea>
            </div>
            <button type="submit" class="btn btn-green" style="margin-top:10px;">
              <i class="fas fa-plus"></i> Simpan Catatan
            </button>
          </form>
        </div>

        <!-- Daftar Catatan -->
        <div class="catatan-list" id="catatanList">
          <!-- Catatan akan muncul di sini -->
        </div>
      </div>
    </section>
  </div>

  <!-- MODAL OFFDAY/BAGAN -->
  <div class="modal-backdrop" id="backdrop">
    <div class="modal">
      <div>
        <h3 id="modalTitle">Isi Jadwal</h3>
        <div class="sub" id="modalSub">Maksimal 8 orang</div>

        <div style="margin:8px 0 10px;">
          <label style="font-size:12px; font-weight:900; letter-spacing:.3px; opacity:.9;">
            Jenis Jadwal
          </label>
          <div class="select-wrap" style="margin-top:6px;">
            <select id="typeSelect" class="role-select" style="font-size:13px;">
              <option value="OFF">OFFDAY</option>
              <option value="BAGAN">BAGAN</option>
            </select>
            <span class="chev">‚ñæ</span>
          </div>
        </div>

        <div class="names-grid" id="modalNames"></div>
      </div>

      <div class="copy-panel">
        <h4>Kolom Copy Nama</h4>
        <p>List otomatis (nama saja). Blok manual atau klik Copy.</p>
        <textarea id="copyBox" readonly placeholder="Belum ada nama..."></textarea>
        <button id="copyBtn" class="btn-accent">Copy</button>
      </div>

      <div class="modal-actions">
        <div class="left-actions">
          <button id="toggleBlock" class="btn-danger">BLOCK TANGGAL</button>
          <button id="deleteOff" class="btn-danger">Hapus Jadwal</button>
        </div>
        <div class="right-actions">
          <button id="cancel">Batal</button>
          <button id="save" class="btn-green">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL CUTI -->
  <div class="modal-backdrop" id="cutiBackdrop">
    <div class="modal" style="grid-template-columns:1fr;">
      <div>
        <h3 id="cutiModalTitle">Tambah CUTI</h3>
        <div class="sub">Isi data cuti staff</div>

        <div class="cuti-form">
          <div class="full">
            <label>Nama Staff</label>
            <input id="cutiName" placeholder="Nama staff..." />
          </div>
          <div>
            <label>Tanggal Cuti</label>
            <input id="cutiStart" type="date" />
          </div>
          <div>
            <label>Selesai Cuti</label>
            <input id="cutiEnd" type="date" />
          </div>
          <div class="full">
            <label>Info / Keterangan</label>
            <textarea id="cutiInfo" placeholder="Contoh: Cuti tahunan / urusan keluarga / dll"></textarea>
          </div>
        </div>

        <div class="modal-actions">
          <div class="left-actions">
            <button id="cutiDeleteBtn" class="btn-danger" style="display:none;">Hapus CUTI</button>
          </div>
          <div class="right-actions">
            <button id="cutiCancelBtn">Batal</button>
            <button id="cutiSaveBtn" class="btn-green">Simpan</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL PASSWORD RESET -->
  <div class="modal-backdrop password-modal" id="passwordBackdrop">
    <div class="modal">
      <div>
        <h3 id="passwordModalTitle">Verifikasi Password</h3>
        <div class="sub" id="passwordModalSub">Masukkan password untuk melanjutkan</div>

        <input type="password" id="passwordInput" class="password-input" placeholder="Masukkan password..." autocomplete="off" />

        <div class="modal-actions">
          <div class="right-actions">
            <button id="passwordCancelBtn">Batal</button>
            <button id="passwordConfirmBtn" class="btn-green">Verifikasi</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const $ = q => document.querySelector(q);

  // =========================
  // ‚úÖ GLOBAL FIREBASE SYNC
  // =========================
  const GLOBAL_ROOM_ID = "mwtt-main"; // semua user pakai room ini ‚Üí data sama global

  const clientIdKey = "mwtt-client-id";
  const clientId = localStorage.getItem(clientIdKey) || ("c_" + Math.random().toString(16).slice(2));
  localStorage.setItem(clientIdKey, clientId);

  const dbRef = firebase.database().ref("offday/" + GLOBAL_ROOM_ID);

  let isApplyingRemote = false;
  let lastRemoteUpdatedAt = 0;
  let pushTimer = null;

  function schedulePush() {
    if (isApplyingRemote) return;
    clearTimeout(pushTimer);
    pushTimer = setTimeout(pushNow, 300);
  }

  function pushNow() {
    if (isApplyingRemote) return;
    const payload = {
      updatedAt: Date.now(),
      updatedBy: clientId,
      calendar: store,
      cuti: cutiStore,
      bagan: { meta: baganMeta, seats: baganStore },
      piket: piketStore,
      csMawaroto: csStore,
      catatan: catatanStore,
      lock: { isLocked }
    };
    dbRef.set(payload).catch(err => console.error("GLOBAL SAVE ERR:", err));
  }

  function applyRemote(payload) {
    if (!payload) return;
    const u = Number(payload.updatedAt || 0);
    if (u && u <= lastRemoteUpdatedAt) return;

    isApplyingRemote = true;
    try {
      lastRemoteUpdatedAt = u || lastRemoteUpdatedAt;

      if (payload.calendar && typeof payload.calendar === "object") {
        Object.keys(store).forEach(k => delete store[k]);
        Object.assign(store, payload.calendar);
        saveStore();
      }

      if (Array.isArray(payload.cuti)) {
        cutiStore.splice(0, cutiStore.length, ...payload.cuti);
        saveCuti();
      }

      if (payload.bagan && typeof payload.bagan === "object") {
        if (payload.bagan.meta) baganMeta = payload.bagan.meta;
        if (Array.isArray(payload.bagan.seats)) baganStore = payload.bagan.seats;
        saveBagan();
      }

      if (payload.piket && typeof payload.piket === "object") {
        Object.keys(piketStore).forEach(k => delete piketStore[k]);
        Object.assign(piketStore, payload.piket);
        savePiket();
      }

      if (Array.isArray(payload.csMawaroto)) {
        csStore.splice(0, csStore.length, ...payload.csMawaroto);
        saveCS();
      }

      if (Array.isArray(payload.catatan)) {
        catatanStore.splice(0, catatanStore.length, ...payload.catatan);
        saveCatatan();
      }

      if (payload.lock && typeof payload.lock.isLocked === "boolean") {
        isLocked = payload.lock.isLocked;
        updateLockUI();
      }

      if (activeFilterType === "CUTI") renderCutiTable();
      else if (activeFilterType === "BAGAN_VIEW") { renderBagan(); updateDeleteSeatUI(); }
      else if (activeFilterType === "PIKET") renderPiketTable();
      else if (activeFilterType === "CS_MAWAROTO") renderCSTable();
      else if (activeFilterType === "CATATAN") renderCatatanList();
      else renderCalendar();

    } finally {
      isApplyingRemote = false;
    }
  }

  function startRealtimeSync() {
    dbRef.on("value", snap => {
      const payload = snap.val();
      applyRemote(payload);
    }, err => {
      console.error("GLOBAL LOAD ERR:", err);
    });
  }

  // =========================
  // APP ORIGINAL LOGIC
  // =========================
  const WEEKDAYS_ID = ["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU","MINGGU"];
  const MONTHS_ID = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];

  const ROLE_OPTIONS = [
    { value: "", label: "Pilih Divisi", color: "#202741" },
    { value: "FINANCE", label: "FINANCE", color: "#f7d88b" },
    { value: "DESIGN", label: "DESIGN", color: "#7a3a00" },
    { value: "LIVECHAT", label: "LIVECHAT", color: "#bfe3ff" },
    { value: "SPV_WD", label: "SPV WD", color: "#1f5a6b" },
    { value: "WORKER_WD", label: "WORKER WD", color: "#e5c9ff" },
    { value: "DEPOSIT", label: "DEPOSIT", color: "#8B5CF6" },
    { value: "ADMIN", label: "BANKER", color: "#F59E0B" },
    { value: "ADMIN", label: "ADMIN", color: "#FB923C" },
    { value: "SPV_WD", label: "WD PGA", color: "#FB7185" },
    { value: "ASSIST LEAD UTAMA", label: "ASSIST LEAD UTAMA", color: "#9F1239" },
    { value: "QRIS", label: "QRIS", color: "#C4B5FD" },
    { value: "LEADER WD", label: "LEADER WD", color: "#22D3EE" },
    { value: "LEADER DEPOSIT", label: "LEADER DEPOSIT", color: "#FDE047" },
    { value: "LEADER WD", label: "WHATSAPP", color: "#A3E635" },
    { value: "LEADER LIVE CHAT", label: "LEADER LIVE CHAT", color: "#CA8A04" },
    { value: "ASSIT LEADER WD", label: "ASSIT LEADER WD", color: "#003333" },
    { value: "TELEGRAM / SOSMED", label: "TELEGRAM / SOSMED", color: "#FF7F50" },
  ];
  const ROLE_COLOR_MAP = Object.fromEntries(ROLE_OPTIONS.map(o => [o.value, o.color]));

  const TYPE_OPTIONS = [
    { value:"OFF", label:"OFFDAY" },
    { value:"BAGAN", label:"BAGAN" }
  ];

  const EDIT_PASSWORD = "mawartoto12";
  const lockKey = "offday-lock-state";
  let isLocked = (localStorage.getItem(lockKey) ?? "true") === "true";

  // ===== VARIABLES UNTUK MODAL PASSWORD =====
  let passwordCallback = null;
  let resetPanelName = "";

  const storeKey = "offday-v4";
  const store = JSON.parse(localStorage.getItem(storeKey) || "{}");
  const saveStore = () => localStorage.setItem(storeKey, JSON.stringify(store));

  const cutiKey = "cuti-v1";
  const cutiStore = JSON.parse(localStorage.getItem(cutiKey) || "[]");
  const saveCuti = () => localStorage.setItem(cutiKey, JSON.stringify(cutiStore));

  const baganKey = "bagan-v3";
  const baganMetaKey = "bagan-meta-v1";

  let baganMeta = JSON.parse(localStorage.getItem(baganMetaKey) || "null")
               || { rows: 10, cols: 20 };

  function BAGAN_ROWS(){ return baganMeta.rows; }
  function BAGAN_COLS(){ return baganMeta.cols; }
  function BAGAN_SIZE(){ return BAGAN_ROWS() * BAGAN_COLS(); }

  let baganStore = JSON.parse(localStorage.getItem(baganKey) || "null")
                 || Array.from({length:BAGAN_SIZE()}, ()=>({name:"", active:true}));

  const saveBagan = () => {
    localStorage.setItem(baganKey, JSON.stringify(baganStore));
    localStorage.setItem(baganMetaKey, JSON.stringify(baganMeta));
  };

  function ensureBaganSize(){
    const sizeNeeded = BAGAN_SIZE();
    if(baganStore.length < sizeNeeded){
      baganStore.push(
        ...Array.from(
          {length:sizeNeeded-baganStore.length},
          ()=>({name:"", active:true})
        )
      );
    }
    if(baganStore.length > sizeNeeded){
      baganStore = baganStore.slice(0, sizeNeeded);
    }

    baganStore.forEach(s=>{
      if(typeof s.active !== "boolean") s.active = true;
      if(typeof s.name !== "string") s.name = "";
    });
  }

  const piketKey = "piket-v1";
  const defaultPiket = {
    SENIN: Array(8).fill(""),
    SELASA: Array(8).fill(""),
    RABU: Array(8).fill(""),
    KAMIS: Array(8).fill(""),
    JUMAT: Array(8).fill(""),
    SABTU: Array(8).fill(""),
    MINGGU: Array(8).fill("")
  };
  const safeClone = obj => JSON.parse(JSON.stringify(obj));
  const piketStore = JSON.parse(localStorage.getItem(piketKey) || "null")
    || safeClone(defaultPiket);
  const savePiket = () => localStorage.setItem(piketKey, JSON.stringify(piketStore));

  // ===== CS MAWAROTO STORE =====
  const csKey = "cs-mawaroto-v1";
  const csDefault = [
    { name: "CS ANITA", job: "LIVECHAT" },
    { name: "CS RINA", job: "WHATSAPP" },
    { name: "CS DWI", job: "REPORT PHISING" }
  ];
  const csStore = JSON.parse(localStorage.getItem(csKey) || "null") || csDefault.slice();
  const saveCS = () => localStorage.setItem(csKey, JSON.stringify(csStore));

  const CS_JOB_OPTIONS = [
    { value:"", label:"Pilih Jobdesk", color:"#202741" },
    { value:"LIVECHAT", label:"LIVECHAT", color:"#bfe3ff" },
    { value:"WHATSAPP", label:"WHATSAPP", color:"#A3E635" },
    { value:"DEPOSIT", label:"DEPOSIT", color:"#8B5CF6" },
    { value:"WORKER WD", label:"WORKER WD", color:"#D8BFD8" },
    { value:"DESIGN", label:"DESIGN", color:"#f59e0b" },
    { value:"ADMIN", label:"ADMIN", color:"#FB923C" },
    { value:"BANKER", label:"BANKER", color:"#22c55e" },
    { value:"FINANCE", label:"FINANCE", color:"#f7d88b" },
    { value:"TELEMARKETING", label:"TELEMARKETING", color:"#fda085" },
    { value:"MARKETING", label:"MARKETING", color:"#ef4444" },
    { value:"LEADER DEPOSIT", label:"LEADER DEPOSIT", color:"#94a3b8" },
    { value:"TELEGRAM / SOSMED", label:"TELEGRAM / SOSMED", color:"#EE82EE" },
    { value:"REPORT PHISING", label:"REPORT PHISING", color:"#2563eb" },
    { value:"LEADER WD", label:"LEADER WD", color:"#b91c1c" },
    { value:"QRIS", label:"QRIS", color:"#C4B5FD" },
    { value:"SPV WD", label:"SPV WD", color:"#0f766e" },
    { value:"WD PGA", label:"WD PGA", color:"#22c55e" },
    { value:"LEADER LIVE CHAT", label:"LEADER LIVE CHAT", color:"#a16207" },
    { value:"ASSIT LEADER UTAMA", label:"ASSIT LEADER UTAMA", color:"#FBCFE8" },
    { value:"ASSIT LEADER WD", label:"ASSIT LEADER WD", color:"#E6E6FA" },
    { value:"RESULT", label:"RESULT", color:"#52525B" },
  ];

  // ===== CATATAN STORE =====
  const catatanKey = "catatan-v1";
  const catatanStore = JSON.parse(localStorage.getItem(catatanKey) || "[]");
  const saveCatatan = () => localStorage.setItem(catatanKey, JSON.stringify(catatanStore));

  let view = new Date();
  let activeKey = null;
  let activeFilterType = "ALL";
  let editingCutiIndex = null;
  let editingCatatanIndex = null;

  function toast(msg){
    const t=$("#toast");
    t.textContent=msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 1600);
  }

  async function copyToClipboard(text){
    const t = String(text||"");
    try{
      if(navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(t);
        return true;
      }
    }catch(e){}
    try{
      const ta = document.createElement("textarea");
      ta.value = t;
      ta.setAttribute("readonly","");
      ta.style.position="fixed";
      ta.style.left="-9999px";
      ta.style.top="0";
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return !!ok;
    }catch(e){
      return false;
    }
  }

  // ===== FUNGSI MODAL PASSWORD =====
  function openPasswordModal(title, sub, callback, panelName = "") {
    resetPanelName = panelName;
    passwordCallback = callback;
    $("#passwordModalTitle").textContent = title;
    $("#passwordModalSub").textContent = sub;
    $("#passwordInput").value = "";
    $("#passwordBackdrop").style.display = "grid";
    setTimeout(() => $("#passwordInput").focus(), 100);
  }

  function closePasswordModal() {
    $("#passwordBackdrop").style.display = "none";
    passwordCallback = null;
    resetPanelName = "";
  }

  $("#passwordCancelBtn").onclick = closePasswordModal;
  $("#passwordConfirmBtn").onclick = () => {
    const input = $("#passwordInput").value.trim();
    if (!input) {
      toast("Password tidak boleh kosong");
      return;
    }

    if (input === EDIT_PASSWORD) {
      if (passwordCallback) {
        passwordCallback();
      }
      closePasswordModal();
    } else {
      toast("Password salah!");
      $("#passwordInput").value = "";
      $("#passwordInput").focus();
    }
  };

  // Handle Enter key in password modal
  $("#passwordInput").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      $("#passwordConfirmBtn").click();
    }
  });

  function updateLockUI(){
    const b=$("#lockBtn");
    b.textContent = isLocked ? "üîí TERKUNCI" : "üîì EDIT MODE";
    b.className = isLocked ? "btn-amber" : "btn-green";
    localStorage.setItem(lockKey, String(isLocked));
    
    // Sembunyikan tombol tambah dan reset saat terkunci
    const buttonsToHide = [
      "#addCutiBtn",
      "#addCatatanBtn",
      "#resetCutiBtn",
      "#resetBaganBtn",
      "#resetPiketBtn",
      "#resetCsBtn",
      "#resetCatatanBtn",
      "#addCsBtn",
      "#addRowBtn",
      "#addColBtn",
      "#removeColBtn",
      "#toggleDeleteSeatBtn",
      "#clear",
      "#bulkImport"
    ];
    
    buttonsToHide.forEach(selector => {
      const btn = $(selector);
      if (btn) btn.style.display = isLocked ? "none" : "inline-block";
    });

    // Render ulang panel aktif untuk update tombol di dalamnya
    reRenderActivePanel();
  }

  function reRenderActivePanel() {
    if (activeFilterType === "CUTI") renderCutiTable();
    else if (activeFilterType === "BAGAN_VIEW") { renderBagan(); updateDeleteSeatUI(); }
    else if (activeFilterType === "PIKET") renderPiketTable();
    else if (activeFilterType === "CS_MAWAROTO") renderCSTable();
    else if (activeFilterType === "CATATAN") renderCatatanList();
    else renderCalendar();
  }

  // ===== FUNGSI LOCK/UNLOCK =====
  $("#lockBtn").onclick = () => {
    if (!isLocked) {
      // Jika sedang tidak terkunci, kunci langsung
      isLocked = true;
      updateLockUI();
      schedulePush();
      toast("Mode terkunci");
    } else {
      // Jika terkunci, minta password untuk buka
      openPasswordModal(
        "Buka Mode Edit",
        "Masukkan password untuk mengaktifkan mode edit",
        () => {
          isLocked = false;
          updateLockUI();
          schedulePush();
          toast("Edit mode aktif");
        }
      );
    }
  };

  function ymd(date){
    const y=date.getFullYear();
    const m=String(date.getMonth()+1).padStart(2,"0");
    const d=String(date.getDate()).padStart(2,"0");
    return y + "-" + m + "-" + d;
  }

  function getMonthData(date){
    const y=date.getFullYear(), m=date.getMonth();
    const first=new Date(y,m,1), last=new Date(y,m+1,0);
    const startDay=(first.getDay()+6)%7;
    return {y:y, m:m, startDay:startDay, daysInMonth:last.getDate()};
  }

  function ensureDay(key){
    store[key]=store[key]||{};
    if(store[key].off===true && !store[key].type) store[key].type="OFF";
    if(!store[key].type) store[key].type="OFF";

    if(!store[key].entries){
      const old = store[key].names || Array(8).fill("");
      store[key].entries = old.map(n=>({name:n||"",role:""}));
      delete store[key].names;
    }
    while(store[key].entries.length<8) store[key].entries.push({name:"",role:""});
    store[key].entries = store[key].entries.slice(0,8);

    store[key].blocked = store[key].blocked || false;
  }

  function isDark(hex){
    let c = (hex||"#000").replace("#","");
    if(c.length===3) c=c.split("").map(x=>x+x).join("");
    const r=parseInt(c.slice(0,2),16);
    const g=parseInt(c.slice(2,4),16);
    const b=parseInt(c.slice(4,6),16);
    const lum=0.299*r+0.587*g+0.114*b;
    return lum<140;
  }

  function renderWeekdays(){
    $("#weekdays").innerHTML = WEEKDAYS_ID.map(d=>"<div>"+d+"</div>").join("");
  }

  function buildCopyText(key){
    const entries=(store[key]?.entries||[])
      .map(e=>({name:(e.name||"").trim()}))
      .filter(e=>e.name);
    return entries.length? entries.map(e=>e.name).join("\n") : "";
  }

  function refreshCopyBox(){
    if(!activeKey) return;
    $("#copyBox").value = buildCopyText(activeKey);
  }

  function renderCalendar(){
    const grid=$("#grid");
    const md=getMonthData(view);
    const y=md.y, m=md.m, startDay=md.startDay, daysInMonth=md.daysInMonth;
    $("#monthLabel").textContent=MONTHS_ID[m]+" "+y;
    grid.innerHTML="";

    for(let i=0;i<startDay;i++){
      const blank=document.createElement("div");
      blank.className="day muted";
      grid.appendChild(blank);
    }

    const today=new Date();

    for(let d=1; d<=daysInMonth; d++){
      const date=new Date(y,m,d);
      const key=ymd(date);
      const dow=(date.getDay()+6)%7;
      const isWeekend=dow>=5;

      ensureDay(key);

      const isBlocked=store[key]?.blocked===true;
      const type=store[key]?.type||"OFF";

      const hideByFilter =
        activeFilterType !== "ALL" &&
        activeFilterType !== "CUTI" &&
        activeFilterType !== "BAGAN_VIEW" &&
        activeFilterType !== "PIKET" &&
        activeFilterType !== "CS_MAWAROTO" &&
        activeFilterType !== "CATATAN" &&
        !isBlocked &&
        type !== activeFilterType;

      const cell=document.createElement("div");
      cell.className=
        "day"+
        (isWeekend?" weekend":"")+
        (isBlocked?" blocked":"")+
        (!isBlocked && type==="OFF"?" off":"")+
        (!isBlocked && type==="BAGAN"?" bagan":"")+
        (hideByFilter ? " muted":"")+
        (date.toDateString()===today.toDateString()?" today":"");
      cell.dataset.key=key;

      let miniHtml="";
      if(isBlocked){
        miniHtml=
          '<div class="names-mini">'+
            '<div class="line"><b>BLOCKED</b></div>'+
            '<div class="line empty">Tanggal ditutup</div>'+
          '</div>';
      } else{
        const entries=(store[key].entries||[])
          .map(e=>({name:(e.name||"").trim(),role:(e.role||"").trim()}))
          .filter(e=>e.name);

        const typeLabel=(TYPE_OPTIONS.find(t=>t.value===type)||{}).label||type;

        if(entries.length===0){
          const emptyText = (type==="OFF") ? "Klik untuk isi" : (typeLabel + ": klik untuk isi");
          miniHtml=
            '<div class="names-mini">'+
              '<div class="line empty">'+emptyText+'</div>'+
            '</div>';
        } else{
          const lines=entries.map(e=>{
            const copyText=e.name;
            if(!e.role){
              return '<div class="line copy-line" data-copy="'+copyText+'">'+
                        '<span class="nm">'+e.name+'</span>'+
                      '</div>';
            }
            const color=ROLE_COLOR_MAP[e.role]||"#CBD5E1";
            const dark=isDark(color);
            const text=dark?"#F8FAFC":"#0B0F1D";
            return '<div class="line copy-line" data-copy="'+copyText+'">'+
                     '<span class="nm">'+e.name+'</span>'+
                     '<span class="role-pill" style="background:'+color+'; color:'+text+'; border-color:rgba(0,0,0,.15)">'+
                       e.role+
                     '</span>'+
                   '</div>';
          }).join("");

          const showHeader = (type !== "OFF");
          const headerHtml = showHeader ? ('<div class="line"><b>'+typeLabel+'</b></div>') : "";

          miniHtml=
            '<div class="names-mini">'+
              headerHtml+
              lines+
            '</div>';
        }
      }

      cell.innerHTML=
        '<div class="date-row">'+
          '<span>'+d+'</span>'+
          '<span class="badge">'+(isWeekend?"WEEKEND":"WORKDAY")+'</span>'+
        '</div>'+
        miniHtml+
        '<div class="dot"></div>';

      cell.querySelectorAll(".copy-line").forEach(line=>{
        line.addEventListener("click", async ev=>{
          ev.stopPropagation();
          const txt=line.dataset.copy||"";
          if(!txt) return;
          try{
            await navigator.clipboard.writeText(txt);
            toast("Tercopy: "+txt);
          }catch(e){ toast("Gagal auto copy, blok manual ya"); }
        });
      });

      cell.addEventListener("click", ()=>{
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
        activeKey=key; openCalendarModal(key,date);
      });

      grid.appendChild(cell);
    }
  }

  function openCalendarModal(key,date){
    ensureDay(key);
    const type=store[key].type||"OFF";

    $("#modalTitle").textContent =
      "Jadwal: "+WEEKDAYS_ID[(date.getDay()+6)%7]+", "+date.getDate()+" "+MONTHS_ID[date.getMonth()]+" "+date.getFullYear();

    const isBlocked=store[key].blocked===true;
    $("#modalSub").textContent=isBlocked
      ? "Tanggal ini sedang diblok."
      : "Isi sampai 8 orang (boleh kosong).";

    const typeSelect=$("#typeSelect");
    typeSelect.value=type;
    typeSelect.disabled=isBlocked;

    const wrap=$("#modalNames");
    wrap.innerHTML="";

    store[key].entries.forEach((entry,i)=>{
      const row=document.createElement("div");
      row.className="role-row";

      const input=document.createElement("input");
      input.placeholder="Nama "+(i+1);
      input.value=entry.name||"";
      input.dataset.i=i;
      input.disabled=isBlocked;

      const selectWrap=document.createElement("div");
      selectWrap.className="select-wrap";

      const select=document.createElement("select");
      select.className="role-select";
      select.dataset.i=i;
      select.disabled=isBlocked;

      ROLE_OPTIONS.forEach(opt=>{
        const o=document.createElement("option");
        o.value=opt.value; o.textContent=opt.label;
        o.setAttribute("data-color",opt.color);
        if(opt.value===entry.role) o.selected=true;
        select.appendChild(o);
      });

      const chev=document.createElement("span");
      chev.className="chev"; chev.textContent="‚ñæ";

      selectWrap.appendChild(select);
      selectWrap.appendChild(chev);
      row.appendChild(input); row.appendChild(selectWrap);
      wrap.appendChild(row);

      const applyColor=()=>{
        const opt=select.options[select.selectedIndex];
        const color=opt.getAttribute("data-color")||"#202741";
        select.style.background=color;
        const dark=isDark(color);
        select.style.color=dark?"#eef2ff":"#0b0f1d";
        chev.style.color=dark?"#eef2ff":"#0b0f1d";
      };

      input.addEventListener("input",()=>{
        store[key].entries[i].name=input.value;
        refreshCopyBox();
      });
      select.addEventListener("change",()=>{
        store[key].entries[i].role=select.value;
        applyColor(); refreshCopyBox();
      });
      applyColor();
    });

    typeSelect.onchange=()=>{
      store[key].type=typeSelect.value;
      store[key].off=true;
      saveStore(); refreshCopyBox(); renderCalendar();
      schedulePush();
    };

    refreshCopyBox();
    $("#backdrop").style.display="grid";
  }

  function closeCalendarModal(){
    $("#backdrop").style.display="none";
    activeKey=null;
  }
  $("#cancel").onclick=closeCalendarModal;

  $("#save").onclick=()=>{
    if(!activeKey) return;
    if(store[activeKey].blocked){
      saveStore(); closeCalendarModal(); renderCalendar();
      schedulePush();
      return;
    }

    const inputs=[...$("#modalNames").querySelectorAll("input")];
    const selects=[...$("#modalNames").querySelectorAll("select")];

    inputs.forEach(inp=>{
      const i=Number(inp.dataset.i); store[activeKey].entries[i].name=inp.value;
    });
    selects.forEach(sel=>{
      const i=Number(sel.dataset.i); store[activeKey].entries[i].role=sel.value;
    });

    store[activeKey].off=true;
    store[activeKey].type=store[activeKey].type||"OFF";
    saveStore(); closeCalendarModal(); renderCalendar();
    schedulePush();
  };

  $("#deleteOff").onclick=()=>{
    if(!activeKey) return;
    store[activeKey].off=false;
    store[activeKey].type="OFF";
    store[activeKey].entries=Array.from({length:8},()=>({name:"",role:""}));
    if(!store[activeKey].blocked) delete store[activeKey];
    saveStore(); closeCalendarModal(); renderCalendar();
    schedulePush();
  };

  $("#toggleBlock").onclick=()=>{
    if(!activeKey) return;
    store[activeKey]=store[activeKey]||{};
    store[activeKey].blocked=!store[activeKey].blocked;
    if(store[activeKey].blocked){
      store[activeKey].off=false;
      store[activeKey].entries=Array.from({length:8},()=>({name:"",role:""}));
    } else {
      store[activeKey].type=store[activeKey].type||"OFF";
    }
    saveStore(); closeCalendarModal(); renderCalendar();
    schedulePush();
  };

  $("#copyBtn").onclick = async ()=>{
    const txt=$("#copyBox").value.trim();
    if(!txt){ toast("Belum ada nama"); return; }
    try{
      await navigator.clipboard.writeText(txt);
      toast("Tersalin ke clipboard");
    }catch(e){
      toast("Gagal auto copy, silakan copy manual");
      $("#copyBox").focus(); $("#copyBox").select();
    }
  };

  function fmtDateID(iso){
    if(!iso) return "-";
    const d=new Date(iso);
    return d.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"});
  }

  function renderCutiTable(){
    const body=$("#cutiTableBody");
    body.innerHTML="";

    if(cutiStore.length===0){
      body.innerHTML = '<tr><td colspan="4" style="padding:16px; opacity:.7;">Belum ada data cuti.</td></tr>';
      return;
    }

    cutiStore.forEach((row,idx)=>{
      const tr=document.createElement("tr");
      tr.innerHTML=
        '<td class="name">'+(row.name||"-")+'</td>'+
        '<td>'+fmtDateID(row.start)+'</td>'+
        '<td>'+fmtDateID(row.end)+'</td>'+
        '<td>'+
          '<button class="info-btn" data-idx="'+idx+'">Detail</button>'+
          (!isLocked? '<button class="del-btn" data-del="'+idx+'">Hapus</button>' : '')+
        '</td>';
      body.appendChild(tr);
    });

    body.querySelectorAll(".info-btn").forEach(btn=>{
      btn.onclick=()=>{
        const idx=Number(btn.dataset.idx);
        openCutiModal(idx);
      };
    });

    body.querySelectorAll(".del-btn").forEach(btn=>{
      btn.onclick=()=>{
        if(isLocked) return;
        const idx=Number(btn.dataset.del);
        if(confirm("Hapus data CUTI ini?")){
          cutiStore.splice(idx,1);
          saveCuti(); renderCutiTable();
          schedulePush();
          toast("Data CUTI dihapus");
        }
      };
    });
  }

  function openCutiModal(idx=null){
    if(idx===null && isLocked){
      toast("Terkunci. Tidak bisa tambah CUTI.");
      return;
    }
    editingCutiIndex = idx;
    $("#cutiModalTitle").textContent = idx===null ? "Tambah CUTI" : "Detail / Edit CUTI";
    $("#cutiDeleteBtn").style.display = (!isLocked && idx!==null) ? "inline-block" : "none";

    const data = idx===null ? {name:"",start:"",end:"",info:""} : cutiStore[idx];

    $("#cutiName").value = data.name||"";
    $("#cutiStart").value = data.start||"";
    $("#cutiEnd").value = data.end||"";
    $("#cutiInfo").value = data.info||"";

    ["cutiName","cutiStart","cutiEnd","cutiInfo","cutiSaveBtn"].forEach(id=>{
      $("#"+id).disabled = isLocked && idx!==null;
    });

    $("#cutiBackdrop").style.display="grid";
  }

  function closeCutiModal(){
    $("#cutiBackdrop").style.display="none";
    editingCutiIndex=null;
  }
  $("#cutiCancelBtn").onclick=closeCutiModal;
  $("#addCutiBtn").onclick=()=>openCutiModal(null);

  $("#cutiSaveBtn").onclick=()=>{
    if(isLocked) return;

    const data={
      name: $("#cutiName").value.trim(),
      start: $("#cutiStart").value,
      end: $("#cutiEnd").value,
      info: $("#cutiInfo").value.trim()
    };
    if(!data.name || !data.start || !data.end){
      toast("Nama & tanggal wajib diisi");
      return;
    }

    if(editingCutiIndex===null){
      cutiStore.push(data);
      toast("CUTI ditambahkan");
    } else {
      cutiStore[editingCutiIndex]=data;
      toast("CUTI diupdate");
    }

    saveCuti(); renderCutiTable(); closeCutiModal();
    schedulePush();
  };

  $("#cutiDeleteBtn").onclick=()=>{
    if(isLocked || editingCutiIndex===null) return;
    if(confirm("Hapus data CUTI ini?")){
      cutiStore.splice(editingCutiIndex,1);
      saveCuti(); renderCutiTable(); closeCutiModal();
      schedulePush();
      toast("Data CUTI dihapus");
    }
  };

  $("#exportCutiBtn").onclick=async ()=>{
    const txt = cutiStore.map((r,i)=>(
      (i+1)+". "+r.name+"\n   "+fmtDateID(r.start)+" ‚Üí "+fmtDateID(r.end)+"\n   "+(r.info||"-")
    )).join("\n\n");
    try{
      await navigator.clipboard.writeText(txt||"Belum ada data cuti");
      toast("Data CUTI dicopy");
    }catch(e){
      toast("Gagal copy, blok manual");
      alert(txt);
    }
  };

  // ===== TOMBOL RESET DENGAN PASSWORD =====
  $("#resetCutiBtn").onclick = () => {
    if (isLocked) {
      toast("Terkunci. Tidak bisa reset CUTI.");
      return;
    }
    
    openPasswordModal(
      "Reset Data CUTI",
      "Masukkan password untuk reset semua data CUTI",
      () => {
        if (confirm("Reset semua data CUTI? Tindakan ini tidak dapat dikembalikan.")) {
          cutiStore.length = 0;
          saveCuti();
          renderCutiTable();
          schedulePush();
          toast("Semua data CUTI direset.");
        }
      },
      "CUTI"
    );
  };

  function seatLabel(i){ return String(i + 1); }

  let deleteSeatMode = false;
  function updateDeleteSeatUI(){
    const b = $("#toggleDeleteSeatBtn");
    b.textContent = deleteSeatMode ? "üßΩ MODE HAPUS: ON" : "üßΩ MODE HAPUS: OFF";
    b.className = deleteSeatMode ? "btn-danger" : "btn-amber";
  }

  $("#toggleDeleteSeatBtn").onclick = () => {
    if(isLocked){ toast("Terkunci. Tidak bisa hapus seat."); return; }
    deleteSeatMode = !deleteSeatMode;
    updateDeleteSeatUI();
    toast(deleteSeatMode ? "Klik seat untuk hapus (kotak hilang)" : "Mode hapus dimatikan");
  };

  function renderBagan(){
    ensureBaganSize();

    const board=$("#baganBoard");
    const cols = BAGAN_COLS();
    board.style.gridTemplateColumns = "repeat("+cols+", 90px)";
    board.innerHTML="";

    baganStore.forEach((seat,i)=>{
      const div=document.createElement("div");
      const isActive = seat.active !== false;

      div.className =
        "seat" +
        (!isActive ? " hidden" : (!seat.name ? " empty" : ""));

      div.draggable = !isLocked && isActive;
      div.dataset.i=i;

      div.innerHTML = isActive
        ? "<small>"+seatLabel(i)+"</small>"+(seat.name || "-")
        : "";

      div.addEventListener("click", ()=>{
        if(isLocked){
          toast("Terkunci. Tidak bisa edit BAGAN.");
          return;
        }

        if(deleteSeatMode){
          if(!baganStore[i].active){
            toast("Seat "+seatLabel(i)+" sudah dihapus");
            return;
          }
          if(!confirm("Hapus seat "+seatLabel(i)+"? Kotak akan hilang.")) return;

          baganStore[i].name = "";
          baganStore[i].active = false;
          saveBagan();
          renderBagan();
          schedulePush();
          toast("Seat "+seatLabel(i)+" dihapus");
          return;
        }

        const nm = prompt("Isi nama untuk seat "+seatLabel(i)+":", seat.name||"");
        if(nm===null) return;
        baganStore[i].name = nm.trim();
        baganStore[i].active = true;
        saveBagan();
        renderBagan();
        schedulePush();
      });

      div.addEventListener("dragstart", e=>{
        div.classList.add("dragging");
        e.dataTransfer.setData("text/plain", String(i));
      });
      div.addEventListener("dragend", ()=>{
        div.classList.remove("dragging");
        board.querySelectorAll(".seat").forEach(s=>s.classList.remove("drop-target"));
      });
      div.addEventListener("dragover", e=>{
        if(isLocked || !isActive) return;
        e.preventDefault();
        div.classList.add("drop-target");
      });
      div.addEventListener("dragleave", ()=> div.classList.remove("drop-target"));
      div.addEventListener("drop", e=>{
        if(isLocked || !isActive) return;
        e.preventDefault();
        const from = Number(e.dataTransfer.getData("text/plain"));
        const to = i;
        if(from===to) return;
        const tmp = baganStore[from];
        baganStore[from]=baganStore[to];
        baganStore[to]=tmp;
        saveBagan(); renderBagan();
        schedulePush();
        toast("Swap seat "+seatLabel(from)+" ‚Üî "+seatLabel(to));
      });

      board.appendChild(div);
    });
  }

  $("#addRowBtn").onclick=()=>{
    if(isLocked){ toast("Terkunci. Tidak bisa tambah baris."); return; }
    baganMeta.rows += 1;
    ensureBaganSize();
    saveBagan();
    renderBagan();
    schedulePush();
    toast("Baris ditambah. Total: "+baganMeta.rows);
  };

  $("#addColBtn").onclick=()=>{
    if(isLocked){ toast("Terkunci. Tidak bisa tambah kolom."); return; }
    baganMeta.cols += 1;
    ensureBaganSize();
    saveBagan();
    renderBagan();
    schedulePush();
    toast("Kolom ditambah. Total: "+baganMeta.cols);
  };

  $("#removeColBtn").onclick = () => {
    if (isLocked) { toast("Terkunci. Tidak bisa hapus kolom."); return; }

    const cols = baganMeta.cols;
    const rows = baganMeta.rows;
    if (cols <= 1) { toast("Kolom minimal 1"); return; }

    const input = prompt(
      "Mau hapus kolom ke berapa?\n\nTotal kolom sekarang: "+cols+"\nIsi angka 1 - "+cols,
      String(cols)
    );
    if (input === null) return;

    const colToRemove = Number(input);
    if (!Number.isInteger(colToRemove) || colToRemove < 1 || colToRemove > cols) {
      toast("Nomor kolom tidak valid");
      return;
    }

    if (!confirm("Yakin hapus kolom ke-"+colToRemove+"?\nSemua nama di kolom ini akan hilang.")) return;

    const oldCols = cols;
    const removeIndexInRow = colToRemove - 1;

    for (let r = rows - 1; r >= 0; r--) {
      const idx = r * oldCols + removeIndexInRow;
      baganStore.splice(idx, 1);
    }

    baganMeta.cols -= 1;

    ensureBaganSize();
    saveBagan();
    renderBagan();
    schedulePush();
    toast("Kolom ke-"+colToRemove+" dihapus. Total kolom: "+baganMeta.cols);
  };

  $("#resetBaganBtn").onclick = () => {
    if (isLocked) {
      toast("Terkunci. Tidak bisa reset BAGAN.");
      return;
    }
    
    openPasswordModal(
      "Reset BAGAN",
      "Masukkan password untuk reset semua data BAGAN",
      () => {
        if (confirm("Reset BAGAN? Semua nama hilang & seat yang dihapus muncul lagi.")) {
          ensureBaganSize();
          for(let i=0;i<BAGAN_SIZE();i++) baganStore[i]={name:"", active:true};
          saveBagan(); renderBagan();
          schedulePush();
          toast("BAGAN direset");
        }
      },
      "BAGAN"
    );
  };

  $("#exportBaganBtn").onclick=async ()=>{
    const lines = baganStore.map((s,i)=>seatLabel(i)+": "+(s.active===false ? "[DELETED]" : (s.name||"-")));
    const txt = lines.join("\n");
    try{
      await navigator.clipboard.writeText(txt);
      toast("BAGAN dicopy");
    }catch(e){
      toast("Gagal copy, blok manual");
      alert(txt);
    }
  };

  function renderPiketTable(){
    const body = $("#piketTableBody");
    body.innerHTML = "";
    const days = ["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU","MINGGU"];

    days.forEach(day=>{
      const tr = document.createElement("tr");
      const names = piketStore[day] || Array(8).fill("");

      const wrap = document.createElement("div");
      names.forEach((nm,i)=>{
        const span = document.createElement("span");
        span.className = "piket-name " + ((nm||"").trim() ? "" : "empty");
        span.dataset.day = day;
        span.dataset.i = i;
        span.textContent = (nm||"").trim() || "‚Äî";
        wrap.appendChild(span);
      });

      const tdDay = document.createElement("td");
      tdDay.className = "name";
      tdDay.style.fontWeight = "900";
      tdDay.textContent = day;

      const tdNames = document.createElement("td");
      tdNames.colSpan = 8;
      tdNames.appendChild(wrap);

      tr.appendChild(tdDay);
      tr.appendChild(tdNames);
      body.appendChild(tr);
    });

    body.querySelectorAll(".piket-name").forEach(el=>{
      el.onclick = ()=>{
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const day = el.dataset.day;
        const i = Number(el.dataset.i);
        const old = piketStore[day][i] || "";
        const nm = prompt("Nama piket " + day + " slot " + (i+1) + ":", old);
        if(nm===null) return;
        piketStore[day][i] = nm.trim();
        savePiket();
        renderPiketTable();
        schedulePush();
      };
    });
  }

  $("#resetPiketBtn").onclick = ()=>{
    if (isLocked) {
      toast("Terkunci. Tidak bisa reset PIKET.");
      return;
    }
    
    openPasswordModal(
      "Reset PIKET",
      "Masukkan password untuk reset semua jadwal PIKET",
      () => {
        if (confirm("Reset semua jadwal PIKET?")) {
          Object.keys(defaultPiket).forEach(d=>{
            piketStore[d] = Array(8).fill("");
          });
          savePiket();
          renderPiketTable();
          schedulePush();
          toast("PIKET direset");
        }
      },
      "PIKET"
    );
  };

  $("#exportPiketBtn").onclick = async ()=>{
    const days = ["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU","MINGGU"];
    let txt = "";
    days.forEach(d=>{
      const list = (piketStore[d]||[]).filter(n=>String(n).trim());
      txt += d + ":\n" + (list.length ? list.map(x=>"- "+x).join("\n") : "- (kosong)") + "\n\n";
    });

    try{
      await navigator.clipboard.writeText(txt);
      toast("PIKET dicopy");
    }catch(e){
      alert(txt);
      toast("Gagal copy, blok manual");
    }
  };

  // ===== CS MAWAROTO TABLE RENDER + tombol ‚Üí OFFDAY =====
  function renderCSTable(){
    const body = $("#csTableBody");
    if(!body) return;
    body.innerHTML = "";

    if(csStore.length === 0){
      body.innerHTML = `<tr><td colspan="3" style="padding:16px; opacity:.7;">Belum ada data CS.</td></tr>`;
      return;
    }

    csStore.forEach((row, idx) => {
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      tdName.className = "name";
      tdName.style.display = "flex";
      tdName.style.alignItems = "center";
      tdName.style.gap = "10px";

      const nameSpan = document.createElement("span");
      nameSpan.className = "cs-name-span";
      nameSpan.textContent = ((idx+1) + ". " + ((row.name||"-").trim() || "-"));
      nameSpan.style.cursor = "pointer";
      nameSpan.title = "Klik untuk copy nama";
      nameSpan.onclick = async (ev) => {
        ev.stopPropagation();
        const nm = (row.name || "").trim();
        if(!nm) { toast("Nama kosong"); return; }
        const ok = await copyToClipboard(nm);
        if(ok) toast("Tercopy: " + nm);
        else { prompt("Copy manual (CTRL+C):", nm); toast("Gagal auto copy, copy manual"); }
      };

      const editBtn = document.createElement("button");
      editBtn.textContent = "‚úé";
      editBtn.title = "Edit nama CS";
      editBtn.style.padding = "6px 10px";
      editBtn.style.borderRadius = "10px";
      editBtn.style.border = "1px solid rgba(255,255,255,.16)";
      editBtn.style.background = "rgba(255,255,255,.06)";
      editBtn.style.color = "#eef2ff";
      editBtn.style.cursor = "pointer";
      editBtn.onmouseenter = () => editBtn.style.background = "rgba(255,255,255,.10)";
      editBtn.onmouseleave = () => editBtn.style.background = "rgba(255,255,255,.06)";
      editBtn.onclick = (ev) => {
        ev.stopPropagation();
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const cur = (csStore[idx]?.name || "").trim();
        const nm = prompt("Edit nama CS:", cur);
        if(nm === null) return;
        const name = nm.trim();
        if(!name){ toast("Nama tidak boleh kosong"); return; }
        csStore[idx].name = name;
        saveCS();
        renderCSTable();
        schedulePush();
        toast("Nama CS diupdate");
      };

      tdName.appendChild(nameSpan);
      tdName.appendChild(editBtn);

      const tdJob = document.createElement("td");
      const wrap = document.createElement("div");
      wrap.className = "cs-job-wrap";

      const select = document.createElement("select");
      select.className = "cs-job-select";

      CS_JOB_OPTIONS.forEach(opt=>{
        const o = document.createElement("option");
        o.value = opt.value;
        o.textContent = opt.label;
        o.setAttribute("data-color", opt.color);
        if(opt.value === (row.job||"")) o.selected = true;
        select.appendChild(o);
      });

      const applyJobColor = () => {
        const opt = select.options[select.selectedIndex];
        const color = opt.getAttribute("data-color") || "#202741";
        select.style.background = color;
        const dark = isDark(color);
        select.style.color = dark ? "#eef2ff" : "#0b0f1d";
      };
      applyJobColor();

      select.onchange = () => {
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); renderCSTable(); return; }
        csStore[idx].job = select.value;
        saveCS();
        applyJobColor();
        schedulePush();
        toast("Jobdesk diubah");
      };

      wrap.appendChild(select);
      tdJob.appendChild(wrap);

      const tdAct = document.createElement("td");

      const offBtn = document.createElement("button");
      offBtn.className = "btn-green";
      offBtn.textContent = "‚Üí OFFDAY";
      offBtn.style.marginRight = "6px";

      offBtn.onclick = () => {
        if(isLocked){
          toast("Terkunci. Hanya bos yang bisa edit.");
          return;
        }

        const tgl = prompt("Masukkan tanggal OFFDAY (YYYY-MM-DD):", ymd(new Date()));
        if(!tgl) return;

        ensureDay(tgl);

        if(store[tgl].blocked){
          toast("Tanggal diblokir");
          return;
        }

        const slot = store[tgl].entries.find(e => !(e.name||"").trim());
        if(!slot){
          toast("Slot OFFDAY penuh (maks 8)");
          return;
        }

        slot.name = row.name || "";
        slot.role = row.job || "";
        store[tgl].type = "OFF";
        store[tgl].off = true;

        saveStore();
        renderCalendar();
        schedulePush();
        toast((row.name||"CS") + " masuk OFFDAY " + tgl);
      };

      const del = document.createElement("button");
      del.className = "cs-del-btn";
      del.textContent = "HAPUS";
      del.onclick = () => {
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
        if(confirm("Hapus CS ini?")){
          csStore.splice(idx, 1);
          saveCS();
          renderCSTable();
          schedulePush();
          toast("CS dihapus");
        }
      };

      tdAct.appendChild(offBtn);
      tdAct.appendChild(del);

      tr.appendChild(tdName);
      tr.appendChild(tdJob);
      tr.appendChild(tdAct);
      body.appendChild(tr);
    });
  }

  $("#addCsBtn").onclick = () => {
    if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
    const nm = prompt("Masukkan nama CS:", "");
    if(nm === null) return;
    const name = nm.trim();
    if(!name){ toast("Nama tidak boleh kosong"); return; }
    csStore.push({ name, job: "" });
    saveCS();
    renderCSTable();
    schedulePush();
    toast("CS ditambahkan");
  };

  $("#resetCsBtn").onclick = () => {
    if (isLocked) {
      toast("Terkunci. Tidak bisa reset CS MAWAROTO.");
      return;
    }
    
    openPasswordModal(
      "Reset CS MAWAROTO",
      "Masukkan password untuk reset data CS MAWAROTO",
      () => {
        if (confirm("Reset data CS MAWAROTO?")) {
          csStore.splice(0, csStore.length, ...csDefault.slice());
          saveCS();
          renderCSTable();
          schedulePush();
          toast("CS direset");
        }
      },
      "CS MAWAROTO"
    );
  };

  $("#exportCsBtn").onclick = async () => {
    const txt = csStore.map((r,i)=>`${i+1}. ${r.name} ‚Äî ${r.job || "-"}`).join("\n") || "Belum ada data CS";
    try{
      await navigator.clipboard.writeText(txt);
      toast("CS dicopy");
    }catch(e){
      alert(txt);
      toast("Gagal copy, blok manual");
    }
  };

  // ===== CATATAN FUNCTIONS =====
  function renderCatatanList() {
    const container = $("#catatanList");
    if (!container) return;
    
    container.innerHTML = "";
    
    if (catatanStore.length === 0) {
      container.innerHTML = '<div class="empty-catatan">Belum ada catatan. Tambahkan catatan baru.</div>';
      return;
    }
    
    // Urutkan dari yang terbaru
    const sortedCatatan = [...catatanStore].sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
    
    sortedCatatan.forEach((catatan, idx) => {
      const item = document.createElement("div");
      item.className = "catatan-item";
      
      item.innerHTML = `
        <div class="catatan-header">
          <div class="catatan-title">${catatan.title || "Tanpa Judul"}</div>
          <div class="catatan-category" data-category="${catatan.category || ''}">${catatan.category || ""}</div>
        </div>
        <div class="catatan-content">${catatan.content || ""}</div>
        <div class="catatan-footer">
          <div class="catatan-date">${catatan.date || ""}</div>
          <div class="catatan-actions">
            ${!isLocked ? `<button class="catatan-btn edit" data-index="${idx}">Edit</button>` : ''}
            ${!isLocked ? `<button class="catatan-btn delete" data-index="${idx}">Hapus</button>` : ''}
          </div>
        </div>
      `;
      
      container.appendChild(item);
    });
    
    // Tambahkan event listener untuk tombol edit dan hapus
    container.querySelectorAll(".catatan-btn.edit").forEach(btn => {
      btn.addEventListener("click", (e) => {
        if (isLocked) { toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const idx = parseInt(e.target.dataset.index);
        editCatatan(idx);
      });
    });
    
    container.querySelectorAll(".catatan-btn.delete").forEach(btn => {
      btn.addEventListener("click", (e) => {
        if (isLocked) { toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const idx = parseInt(e.target.dataset.index);
        deleteCatatan(idx);
      });
    });
  }

  function editCatatan(idx) {
    if (idx < 0 || idx >= catatanStore.length) return;
    
    const catatan = catatanStore[idx];
    editingCatatanIndex = idx;
    
    $("#catatanTitle").value = catatan.title || "";
    $("#catatanCategory").value = catatan.category || "";
    $("#catatanContent").value = catatan.content || "";
    
    $("#catatanForm button[type='submit']").innerHTML = '<i class="fas fa-save"></i> Update Catatan';
  }

  function deleteCatatan(idx) {
    if (isLocked) { toast("Terkunci. Hanya bos yang bisa hapus."); return; }
    
    if (confirm("Hapus catatan ini?")) {
      catatanStore.splice(idx, 1);
      saveCatatan();
      renderCatatanList();
      schedulePush();
      toast("Catatan dihapus");
    }
  }

  function setupCatatanForm() {
    const form = $("#catatanForm");
    if (!form) return;
    
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      
      if (isLocked) {
        toast("Terkunci. Hanya bos yang bisa tambah catatan.");
        return;
      }
      
      const title = $("#catatanTitle").value.trim();
      const category = $("#catatanCategory").value;
      const content = $("#catatanContent").value.trim();
      
      if (!title || !category || !content) {
        toast("Harap isi semua field!");
        return;
      }
      
      const now = new Date();
      const dateStr = `${now.getDate()} ${MONTHS_ID[now.getMonth()]} ${now.getFullYear()}`;
      
      const newCatatan = {
        title,
        category,
        content,
        date: dateStr
      };
      
      if (editingCatatanIndex !== null) {
        // Update catatan yang sedang diedit
        catatanStore[editingCatatanIndex] = newCatatan;
        toast("Catatan diupdate");
      } else {
        // Tambah catatan baru
        catatanStore.push(newCatatan);
        toast("Catatan ditambahkan");
      }
      
      saveCatatan();
      renderCatatanList();
      schedulePush();
      
      // Reset form
      form.reset();
      editingCatatanIndex = null;
      $("#catatanForm button[type='submit']").innerHTML = '<i class="fas fa-plus"></i> Simpan Catatan';
    });
  }

  $("#addCatatanBtn").onclick = () => {
    if (isLocked) {
      toast("Terkunci. Hanya bos yang bisa tambah catatan.");
      return;
    }
    
    // Reset form dan fokus ke input judul
    $("#catatanForm").reset();
    editingCatatanIndex = null;
    $("#catatanForm button[type='submit']").innerHTML = '<i class="fas fa-plus"></i> Simpan Catatan';
    $("#catatanTitle").focus();
  };

  $("#resetCatatanBtn").onclick = () => {
    if (isLocked) {
      toast("Terkunci. Tidak bisa reset Catatan.");
      return;
    }
    
    openPasswordModal(
      "Reset Catatan",
      "Masukkan password untuk reset semua catatan",
      () => {
        if (confirm("Reset semua catatan? Tindakan ini tidak dapat dikembalikan.")) {
          catatanStore.length = 0;
          saveCatatan();
          renderCatatanList();
          schedulePush();
          toast("Semua catatan direset.");
        }
      },
      "CATATAN"
    );
  };

  $("#exportCatatanBtn").onclick = async () => {
    if (catatanStore.length === 0) {
      toast("Belum ada catatan untuk diexport");
      return;
    }
    
    const txt = catatanStore.map((c, i) => 
      `${i+1}. ${c.title}\nKategori: ${c.category}\nTanggal: ${c.date}\n${c.content}\n`
    ).join("\n---\n\n");
    
    try {
      await navigator.clipboard.writeText(txt);
      toast("Catatan dicopy ke clipboard");
    } catch(e) {
      alert(txt);
      toast("Gagal copy, blok manual");
    }
  };

  function setActiveTab(type){
    activeFilterType = type;

    $("#topTabs").querySelectorAll(".tab-btn").forEach(b=>{
      b.classList.toggle("active", b.dataset.type===type);
    });

    const hideAll = () => {
      $("#calendarPanel").style.display="none";
      $("#cutiPanel").style.display="none";
      $("#baganPanel").style.display="none";
      $("#piketPanel").style.display="none";
      $("#csPanel").style.display="none";
      $("#catatanPanel").style.display="none";
    };

    if(type==="CUTI"){
      hideAll();
      $("#cutiPanel").style.display="flex";
      renderCutiTable();
      toast("Mode: CUTI");
      return;
    }

    if(type==="BAGAN_VIEW"){
      hideAll();
      $("#baganPanel").style.display="flex";
      renderBagan();
      updateDeleteSeatUI();
      toast("Mode: BAGAN");
      return;
    }

    if(type==="PIKET"){
      hideAll();
      $("#piketPanel").style.display="flex";
      renderPiketTable();
      toast("Mode: PIKET");
      return;
    }

    if(type==="CS_MAWAROTO"){
      hideAll();
      $("#csPanel").style.display="flex";
      renderCSTable();
      toast("Menu: CS MAWAROTO");
      return;
    }

    if(type==="CATATAN"){
      hideAll();
      $("#catatanPanel").style.display="flex";
      renderCatatanList();
      toast("Menu: Catatan Awal Masuk Kerja");
      return;
    }

    $("#calendarPanel").style.display="flex";
    $("#cutiPanel").style.display="none";
    $("#baganPanel").style.display="none";
    $("#piketPanel").style.display="none";
    $("#csPanel").style.display="none";
    $("#catatanPanel").style.display="none";
    renderCalendar();
    toast(type==="ALL" ? "Mode: ALL" : "Filter: "+type);
  }

  function initTopTabs(){
    $("#topTabs").querySelectorAll(".tab-btn").forEach(btn=>{
      btn.addEventListener("click", ()=> setActiveTab(btn.dataset.type));
    });
  }

  const prev=()=>{view.setMonth(view.getMonth()-1); renderCalendar();};
  const next=()=>{view.setMonth(view.getMonth()+1); renderCalendar();};
  $("#prev").onclick=$("#prevMini").onclick=prev;
  $("#next").onclick=$("#nextMini").onclick=next;
  $("#todayBtn").onclick=()=>{view=new Date(); renderCalendar();};
  $("#jumpYear").onclick=()=>{
    const y=prompt("Masukkan tahun (contoh 2026):", view.getFullYear());
    if(!y) return; view.setFullYear(Number(y)); renderCalendar();
  };
  $("#clear").onclick=()=>{
    if(isLocked){ toast("Terkunci. Tidak bisa reset."); return; }
    const md=getMonthData(view);
    const prefix = md.y+"-"+String(md.m+1).padStart(2,"0");
    Object.keys(store).forEach(k=>{ if(k.startsWith(prefix)) delete store[k]; });
    saveStore(); renderCalendar();
    schedulePush();
  };

  // bulk import (tetap)
  function parseNamesFromPaste(text){
    return text.split(/\r?\n|\t|,|;/g).map(s=>s.trim()).filter(Boolean);
  }
  function shuffle(arr){
    const a=arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }
  function normalizeName(n){ return (n||"").trim().toLowerCase(); }

  function getCsJobForName(name){
    const key = normalizeName(name);
    const found = (csStore||[]).find(r => normalizeName(r.name) === key);
    return found ? (found.job || "") : "";
  }

  function bulkImportNames(){
    if(isLocked){ toast("Terkunci. Tidak bisa import."); return; }

    const pasted = prompt(
      "Paste nama dari Excel.\n\nMODE: PENCAR PERIODE\n- Periode 1: tgl 1‚Äì15\n- Periode 2: tgl 16‚Äìakhir\nNama sama otomatis beda periode.\nRandom 1 nama per tanggal.\nSkip BLOCKED.",
      ""
    );
    if(!pasted) return;

    let rawNames=parseNamesFromPaste(pasted);
    if(rawNames.length===0){ toast("Tidak ada nama terdeteksi"); return; }

    const toggleByName={}, namesP1=[], namesP2=[];
    for(const nm of rawNames){
      const key=normalizeName(nm);
      if(!(key in toggleByName)) toggleByName[key]=0;
      if(toggleByName[key]===0){ namesP1.push(nm); toggleByName[key]=1; }
      else { namesP2.push(nm); toggleByName[key]=0; }
    }

    const listP1=shuffle(namesP1), listP2=shuffle(namesP2);
    const md=getMonthData(view);
    const y=md.y, m=md.m, daysInMonth=md.daysInMonth;

    let eligibleP1=[], eligibleP2=[];
    for(let d=1; d<=daysInMonth; d++){
      const key=ymd(new Date(y,m,d));
      ensureDay(key);
      if(store[key]?.blocked) continue;
      (d<=15?eligibleP1:eligibleP2).push(key);
    }

    function fillPeriod(namesList, eligibleKeys){
      let idx=0, filled=0;
      while(idx<namesList.length){
        const roundKeys=shuffle(eligibleKeys);
        let any=false;
        for(const key of roundKeys){
          if(idx>=namesList.length) break;
          ensureDay(key);
          const slot=store[key].entries.find(e=>!(e.name||"").trim());
          if(slot){
            slot.name=namesList[idx];
            // otomatis isi jobdesk jika nama ada di CS MAWAROTO
            slot.role=getCsJobForName(namesList[idx]);
            store[key].off=true;
            store[key].type=store[key].type||"OFF";
            idx++; filled++; any=true;
          }
        }
        if(!any) break;
      }
      return {filled:filled, remaining:namesList.length-idx};
    }

    const r1=fillPeriod(listP1, eligibleP1);
    const r2=fillPeriod(listP2, eligibleP2);
    saveStore(); renderCalendar();
    schedulePush();
    toast("P1 masuk "+r1.filled+" | P2 masuk "+r2.filled);
  }
  $("#bulkImport").onclick=bulkImportNames;

  window.addEventListener("load", () => {
    updateLockUI();
    initTopTabs();
    renderWeekdays();
    renderCalendar();
    setActiveTab("ALL");
    updateDeleteSeatUI();
    renderCSTable();
    setupCatatanForm();

    startRealtimeSync();

    setTimeout(() => {
      dbRef.once("value").then(snap => {
        if (!snap.exists()) pushNow();
      }).catch(()=>{});
    }, 500);
  });
})();

</script>
<script>
  document.addEventListener("contextmenu", e => e.preventDefault());

  document.onkeydown = function(e) {
    if (e.keyCode === 123) { // F12
      alert("MAEN KALI AHHH");
      return false;
    }

    if (e.ctrlKey && e.shiftKey && e.keyCode === 73) { // Ctrl+Shift+I
      alert("MAEN KALI AHHH");
      return false;
    }

    if (e.ctrlKey && e.shiftKey && e.keyCode === 74) { // Ctrl+Shift+J
      alert("OWALAHHH");
      return false;
    }

    if (e.ctrlKey && e.shiftKey && e.keyCode === 67) { // Ctrl+Shift+C
      alert("EAA GAK NYERAH YAA");
      return false;
    }

    if (e.ctrlKey && e.keyCode === 85) { // Ctrl+U
      alert("WOPSS MASOKK DIAAA");
      return false;
    }
  };

</script>
</body>
</html>
