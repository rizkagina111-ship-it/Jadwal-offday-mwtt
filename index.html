<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#050301">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Jadwal Offday - MAWARTOTO</title>

  <style>
    :root{
      --bg:#0b1020;
      --text:#eef2ff;
      --muted:#aab3d1;
      --accent:#8b5cf6;
      --green:#22c55e;
      --radius:18px;
      --shadow:0 20px 60px rgba(0,0,0,.45);
      --ring:0 0 0 2px rgba(139,92,246,.25);
      --gold:#f6d365;
      --gold2:#fda085;
    }
    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background: 
        radial-gradient(ellipse at 20% 20%, 
          rgba(139, 0, 0, 0.1) 0%, 
          transparent 40%),
        radial-gradient(ellipse at 80% 80%, 
          rgba(165, 42, 42, 0.08) 0%, 
          transparent 40%),
        radial-gradient(ellipse at 40% 60%, 
          rgba(178, 34, 34, 0.06) 0%, 
          transparent 50%),
        url("https://mariterbang.io/download/RiKzs6Ne.png") center/cover no-repeat fixed,
        linear-gradient(135deg, 
          #0b1020 0%, 
          #1a0f1a 30%, 
          #0f0f1a 70%, 
          #0b1020 100%);
      min-height:100vh;
      width:100vw;
      display:block;
      padding:0;
      overflow-x:hidden;
      position:relative;
      user-select:none;
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      background: 
        radial-gradient(1200px 900px at 50% 30%,
          rgba(0,0,0,0.12) 0%,
          rgba(0,0,0,0.42) 60%),
        radial-gradient(circle at 20% 80%, 
          rgba(139, 0, 0, 0.08) 0%,
          transparent 50%),
        radial-gradient(circle at 80% 20%, 
          rgba(165, 42, 42, 0.06) 0%,
          transparent 50%),
        radial-gradient(circle at 40% 60%, 
          rgba(178, 34, 34, 0.04) 0%,
          transparent 50%);
      pointer-events:none;
      z-index:-1;
    }

    /* ===== BACKGROUND BUNGA MAWAR TRANSPARAN ===== */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background-image: 
        url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50,30 Q60,20 70,30 Q80,40 70,50 Q60,60 50,50 Q40,60 30,50 Q20,40 30,30 Q40,20 50,30' fill='rgba(139,0,0,0.15)'/%3E%3Cpath d='M50,35 Q55,30 60,35 Q65,40 60,45 Q55,50 50,45 Q45,50 40,45 Q35,40 40,35 Q45,30 50,35' fill='rgba(178,34,34,0.1)'/%3E%3C/svg%3E"),
        url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M40,25 Q48,18 56,25 Q64,32 56,40 Q48,48 40,40 Q32,48 24,40 Q16,32 24,25 Q32,18 40,25' fill='rgba(165,42,42,0.12)'/%3E%3C/svg%3E"),
        url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30,18 Q36,12 42,18 Q48,24 42,30 Q36,36 30,30 Q24,36 18,30 Q12,24 18,18 Q24,12 30,18' fill='rgba(139,0,0,0.08)'/%3E%3C/svg%3E"),
        url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20,12 Q24,8 28,12 Q32,16 28,20 Q24,24 20,20 Q16,24 12,20 Q8,16 12,12 Q16,8 20,12' fill='rgba(178,34,34,0.06)'/%3E%3C/svg%3E"),
        url("data:image/svg+xml,%3Csvg width='30' height='30' viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15,9 Q18,6 21,9 Q24,12 21,15 Q18,18 15,15 Q12,18 9,15 Q6,12 9,9 Q12,6 15,9' fill='rgba(165,42,42,0.05)'/%3E%3C/svg%3E"),
        url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10,6 Q12,4 14,6 Q16,8 14,10 Q12,12 10,10 Q8,12 6,10 Q4,8 6,6 Q8,4 10,6' fill='rgba(139,0,0,0.04)'/%3E%3C/svg%3E");
      
      background-size: 
        100px 100px,
        80px 80px,
        60px 60px,
        40px 40px,
        30px 30px,
        20px 20px;
      
      background-position: 
        10% 10%,
        85% 15%,
        15% 85%,
        90% 80%,
        70% 30%,
        30% 70%,
        95% 60%,
        5% 40%,
        50% 20%,
        80% 90%;
      
      background-repeat: no-repeat;
      opacity: 0.4;
      z-index: -2;
      pointer-events: none;
      
      animation: floatRoses 30s infinite ease-in-out;
    }

    @keyframes floatRoses {
      0%, 100% {
        transform: translate(0, 0) rotate(0deg);
      }
      25% {
        transform: translate(5px, 10px) rotate(1deg);
      }
      50% {
        transform: translate(-3px, -5px) rotate(-1deg);
      }
      75% {
        transform: translate(7px, -3px) rotate(0.5deg);
      }
    }

    /* ===== BACKGROUND BINTANG/BULAN BERJATUHAN ===== */
    .falling-stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }

    .falling-star {
      position: absolute;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      animation: fallingStar linear infinite;
    }

    .falling-star.moon {
      background: radial-gradient(circle at 30% 30%, 
        rgba(255, 255, 220, 0.9) 0%, 
        rgba(200, 200, 255, 0.6) 50%, 
        transparent 70%);
      box-shadow: 
        0 0 20px rgba(255, 255, 200, 0.5),
        0 0 40px rgba(200, 200, 255, 0.3);
    }

    .falling-star.star {
      background: radial-gradient(circle, 
        rgba(255, 255, 200, 1) 0%, 
        rgba(255, 255, 100, 0.8) 50%, 
        rgba(255, 200, 50, 0.6) 100%);
      box-shadow: 
        0 0 15px rgba(255, 255, 150, 0.7),
        0 0 30px rgba(255, 255, 100, 0.4),
        0 0 45px rgba(255, 200, 50, 0.2);
      clip-path: polygon(
        50% 0%, 
        61% 35%, 
        98% 35%, 
        68% 57%, 
        79% 91%, 
        50% 70%, 
        21% 91%, 
        32% 57%, 
        2% 35%, 
        39% 35%
      );
    }

    @keyframes fallingStar {
      0% {
        transform: translateY(-100px) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) translateX(100px) rotate(360deg);
        opacity: 0;
      }
    }

    /* ===== BUNGA MAWAR BESAR BERGERAK ===== */
    .floating-roses {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -2;
    }

    .floating-rose {
      position: absolute;
      opacity: 0.2;
      filter: blur(0.5px);
      animation: floatRose 20s linear infinite;
    }

    .floating-rose.large {
      width: 120px;
      height: 120px;
      background: radial-gradient(circle at 40% 40%,
        rgba(255, 100, 100, 0.4) 0%,
        rgba(220, 20, 60, 0.3) 40%,
        rgba(178, 34, 34, 0.2) 70%,
        transparent 100%);
      border-radius: 40% 60% 60% 40% / 60% 40% 60% 40%;
    }

    .floating-rose.medium {
      width: 80px;
      height: 80px;
      background: radial-gradient(circle at 35% 35%,
        rgba(255, 150, 150, 0.3) 0%,
        rgba(219, 112, 147, 0.25) 50%,
        rgba(255, 182, 193, 0.15) 80%,
        transparent 100%);
      border-radius: 50% 50% 40% 60% / 60% 40% 60% 40%;
    }

    .floating-rose.small {
      width: 40px;
      height: 40px;
      background: radial-gradient(circle at 45% 45%,
        rgba(255, 200, 200, 0.25) 0%,
        rgba(255, 182, 193, 0.2) 60%,
        rgba(255, 192, 203, 0.1) 90%,
        transparent 100%);
      border-radius: 50%;
    }

    @keyframes floatRose {
      0% {
        transform: translateY(100vh) translateX(0) rotate(0deg);
        opacity: 0;
      }
      5% {
        opacity: 0.2;
      }
      95% {
        opacity: 0.2;
      }
      100% {
        transform: translateY(-100px) translateX(100px) rotate(180deg);
        opacity: 0;
      }
    }

    /* ===== GLOW EFFECT UNTUK SEMUA PANEL ===== */
    .panel::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      background: radial-gradient(circle at 50% 0%,
        rgba(255, 100, 100, 0.1) 0%,
        rgba(139, 0, 0, 0.05) 30%,
        transparent 70%);
      border-radius: 28px;
      z-index: -1;
      pointer-events: none;
    }

    /* ===== ANIMASI PADA TAB AKTIF ===== */
    #topTabs .tab-btn.active::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg,
        rgba(255, 100, 100, 0.3),
        rgba(139, 0, 0, 0.2),
        rgba(255, 200, 200, 0.3));
      border-radius: 12px;
      z-index: -1;
      animation: tabGlow 2s ease-in-out infinite alternate;
    }

    @keyframes tabGlow {
      0% {
        opacity: 0.5;
        transform: scale(1);
      }
      100% {
        opacity: 0.8;
        transform: scale(1.02);
      }
    }

    /* ===== ANIMASI UNTUK TOMBOL UTAMA ===== */
    .controls button {
      position: relative;
      overflow: hidden;
    }

    .controls button::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg,
        transparent 30%,
        rgba(255, 255, 255, 0.1) 50%,
        transparent 70%);
      transform: rotate(45deg);
      animation: buttonShine 3s linear infinite;
      pointer-events: none;
    }

    @keyframes buttonShine {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }
      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }

    .app{
      width:100%;
      max-width:none;
      min-height:100vh;
      display:grid;
      gap:14px;
      padding:16px;
      overflow-x:auto;
    }

    .header{
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 16px; background:rgba(255,255,255,.06); border-radius:18px;
      box-shadow:var(--shadow); backdrop-filter:blur(10px);
      position:sticky; top:0; z-index:10;
      gap:10px; flex-wrap:wrap;
      min-width:1200px;
    }
    .brand{display:flex; gap:10px; align-items:center;}
    .logo{
      width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
      background:conic-gradient(from 120deg,var(--accent),#06b6d4,#f59e0b,var(--accent));
      font-weight:900;
    }
    .brand h1{margin:0; font-size:18px}
    .brand p{margin:2px 0 0; font-size:12px; color:var(--muted)}

    .controls{display:flex; gap:8px; flex-wrap:wrap;}
    button{
      border:0; background:rgba(255,255,255,.04); color:var(--text); cursor:pointer; font-weight:700;
      padding:9px 12px; border-radius:12px; transition:.15s; outline:none;
    }
    button:hover{transform:translateY(-1px); background:rgba(255,255,255,.08)}
    button:focus-visible{box-shadow:var(--ring)}
    .btn-green{background:rgba(34,197,94,.16)}
    .btn-green:hover{background:rgba(34,197,94,.26)}
    .btn-accent{background:rgba(139,92,246,.18)}
    .btn-accent:hover{background:rgba(139,92,246,.28)}
    .btn-danger{background:rgba(244,63,94,.18)}
    .btn-danger:hover{background:rgba(244,63,94,.28)}
    .btn-amber{background:rgba(245,158,11,.16)}
    .btn-amber:hover{background:rgba(245,158,11,.26)}

    .top-tabs{
      display:flex; gap:8px; align-items:center; justify-content:center;
      padding:6px 8px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      backdrop-filter: blur(8px);
      flex-wrap:wrap;
    }
    .tab-btn{
      border:0; cursor:pointer; font-weight:900; letter-spacing:.4px;
      font-size:12px; padding:7px 10px; border-radius:10px;
      color:#e2e8f0; background:rgba(255,255,255,.06);
      transition:.15s; text-transform:uppercase; white-space:nowrap;
      position: relative;
    }
    .tab-btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.12)}
    .tab-btn.active{
      background:rgba(139,92,246,.85);
      color:white;
      box-shadow:0 6px 20px rgba(139,92,246,.45);
    }

    .panel{
      background:rgba(255,255,255,.06); border-radius:18px;
      box-shadow:var(--shadow); backdrop-filter:blur(10px); padding:12px;
      display:flex; flex-direction:column;
      min-height:calc(100vh - 130px);
      min-width:1200px;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .panel::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, 
        rgba(255,100,100,0.1) 0%, 
        rgba(139,0,0,0.05) 30%, 
        rgba(255,200,200,0.05) 70%, 
        rgba(255,100,100,0.1) 100%);
      border-radius: 20px;
      z-index: -2;
      pointer-events: none;
      animation: panelGlow 4s ease-in-out infinite alternate;
    }

    @keyframes panelGlow {
      0% {
        opacity: 0.3;
      }
      100% {
        opacity: 0.6;
      }
    }

    .cal-head{
      display:flex; justify-content:space-between; align-items:center;
      padding:8px 12px; background:rgba(255,255,255,.06); border-radius:12px; margin-bottom:10px;
      border:1px solid rgba(255,255,255,.08);
    }
    .month{
      font-weight:900; letter-spacing:.3px; font-size:16px;
      background:rgba(0,0,0,.2); padding:6px 12px; border-radius:8px;
      border:1px solid rgba(255,255,255,.1);
    }
    .cal-head button{
      padding:6px 10px; font-size:12px; border-radius:8px;
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
      color:#eef2ff; font-weight:700;
    }
    .cal-head button:hover{background:rgba(255,255,255,.12)}

    .weekdays{
      display:grid !important;
      grid-template-columns: repeat(7, 1fr) !important;
      gap: 6px !important;
      padding: 4px 6px !important;
      font-size: 11px !important;
      font-weight: 900 !important;
      text-transform: uppercase !important;
      text-align: center !important;
      border-radius: 8px !important;
      margin-bottom: 4px !important;
      background: linear-gradient(145deg,
        #5A0000 0%,
        #6B0000 25%,
        #7A0000 50%,
        #5A0000 75%,
        #2A0000 100%
      ) !important;
      color: #FFD700 !important;
      border: 1px solid rgba(255, 215, 0, 0.6) !important;
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -1px 0 rgba(0, 0, 0, 0.7),
        0 4px 8px rgba(0, 0, 0, 0.4) !important;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 5px rgba(255, 215, 0, 0.5);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:8px;
      padding:8px;
      flex:1;
      grid-auto-rows: minmax(140px, auto);
      align-items: stretch;
      min-width:1200px;
      overflow-x:auto;
    }

    .day{
      min-height:140px;
      height:100%;
      border-radius:12px;
      padding:6px;
      background: linear-gradient(145deg,
        #5A0000 0%,
        #6B0000 25%,
        #7A0000 50%,
        #5A0000 75%,
        #2A0000 100%
      );
      border:1px solid rgba(255, 215, 0, 0.5);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        inset 0 -6px 12px rgba(0, 0, 0, 0.4),
        0 4px 12px rgba(0, 0, 0, 0.5);
      display:flex; flex-direction:column; gap:6px;
      cursor:pointer; position:relative; overflow:hidden;
      transition:.15s; color:#FFD700;
    }
    .day:hover{
      transform:translateY(-2px);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -8px 16px rgba(0, 0, 0, 0.5),
        0 6px 16px rgba(0, 0, 0, 0.6);
    }
    .day.muted{opacity:.25; cursor:default; box-shadow:none; transform:none !important;}

    .date-row{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:4px; font-weight:900; font-size:13px;
      padding:2px 4px; border-radius:6px; background:rgba(255, 255, 255, 0.15);
      color: #FFD700;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 5px rgba(255, 215, 0, 0.5);
    }
    .date-row span:first-child{
      font-size:15px; min-width:24px; text-align:center;
      color: #FFD700;
      text-shadow: 
        0 0 8px rgba(255, 215, 0, 0.8),
        0 0 12px rgba(255, 215, 0, 0.6);
    }

    .badge {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: .2px;
      background: linear-gradient(145deg,
        #5A0000 0%,
        #6B0000 25%,
        #7A0000 50%,
        #5A0000 75%,
        #2A0000 100%
      );
      color: #FFD700;
      border: 1px solid rgba(139, 0, 0, 0.7);
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 5px rgba(255, 215, 0, 0.5);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        inset 0 -1px 0 rgba(0, 0, 0, 0.7),
        0 2px 4px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }

    .day.weekend .badge {
      background: linear-gradient(145deg,
        #6B0000 0%,
        #7A1A1A 25%,
        #8A2A2A 50%,
        #6B0000 75%,
        #3A0000 100%
      );
      color: #FFE4B5;
      border: 1px solid rgba(210, 105, 30, 0.7);
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 6px rgba(255, 228, 181, 0.6);
    }

    .day.blocked {
      background: linear-gradient(145deg,
        #FFD700 0%,
        #FFC800 25%,
        #FFB900 50%,
        #FFAA00 75%,
        #FF9B00 100%
      ) !important;
      border-color: rgba(255, 200, 0, 0.8) !important;
      color: #000000 !important;
    }

    .day.blocked .date-row {
      background: rgba(255, 255, 255, 0.3) !important;
      color: #000000 !important;
      text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
    }

    .day.blocked .date-row span:first-child {
      color: #000000 !important;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
    }

    .day.blocked .badge {
      background: linear-gradient(145deg,
        #000000 0%,
        #333333 25%,
        #666666 50%,
        #333333 75%,
        #000000 100%
      ) !important;
      color: #FFD700 !important;
      border: 1px solid rgba(0, 0, 0, 0.7) !important;
      text-shadow: 
        0 1px 0 rgba(255, 215, 0, 0.8),
        0 0 5px rgba(255, 215, 0, 0.5);
    }

    .day.blocked .names-mini .line {
      background: rgba(255, 255, 255, 0.25) !important;
      border: 1px solid rgba(255, 255, 255, 0.3) !important;
      color: #000000 !important;
    }

    .day.blocked .names-mini .empty {
      color: rgba(0, 0, 0, 0.8) !important;
      border: 1px dashed rgba(0, 0, 0, 0.4) !important;
    }

    .day.blocked .dot {
      background: #000000 !important;
      box-shadow: 
        0 0 0 1.5px rgba(255, 215, 0, 0.8) inset,
        0 0 12px rgba(0, 0, 0, 0.8) !important;
    }

    .day.off {
      background: linear-gradient(145deg,
        #3A0000 0%,
        #4A0000 20%,
        #5A0000 40%,
        #6B0000 60%,
        #7A1A1A 80%,
        #6B0000 100%
      ) !important;
      
      border: 1px solid rgba(255, 100, 100, 0.5) !important;
      
      box-shadow:
        inset 0 1px 0 rgba(255, 180, 180, 0.3),
        inset 0 -6px 12px rgba(0, 0, 0, 0.5),
        0 4px 12px rgba(139, 0, 0, 0.5) !important;
      
      color: #FFFFFF !important;
    }

    .day.off:hover {
      transform: translateY(-2px);
      box-shadow:
        inset 0 1px 0 rgba(255, 180, 180, 0.4),
        inset 0 -8px 16px rgba(0, 0, 0, 0.6),
        0 6px 16px rgba(139, 0, 0, 0.6) !important;
    }

    .day.off .date-row {
      background: rgba(255, 255, 255, 0.15) !important;
      color: #FFFFFF !important;
      border: 1px solid rgba(255, 200, 200, 0.3) !important;
    }

    .day.off .date-row span:first-child {
      color: #FFFFFF !important;
      text-shadow: 
        0 0 5px rgba(255, 180, 180, 0.8),
        0 0 10px rgba(255, 100, 100, 0.6) !important;
    }

    .day.off .badge {
      background: linear-gradient(145deg,
        #5A0000 0%,
        #6B0000 25%,
        #7A0000 50%,
        #5A0000 75%,
        #2A0000 100%
      ) !important;
      color: #FFD700 !important;
      border: 1px solid rgba(139, 0, 0, 0.7) !important;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 5px rgba(255, 215, 0, 0.5) !important;
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        inset 0 -1px 0 rgba(0, 0, 0, 0.7),
        0 2px 4px rgba(0, 0, 0, 0.4) !important;
    }

    .day.off .names-mini .line {
      background: rgba(255, 255, 255, 0.1) !important;
      border: 1px solid rgba(255, 180, 180, 0.2) !important;
      color: #FFFFFF !important;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 3px rgba(255, 255, 255, 0.5) !important;
    }

    .day.off .names-mini .line:hover {
      background: rgba(255, 255, 255, 0.2) !important;
    }

    .day.off .names-mini .nm {
      color: #FFFFFF !important;
      font-weight: 900 !important;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 3px rgba(255, 255, 255, 0.5) !important;
    }

    .day.off .role-pill {
      border-color: rgba(255, 200, 200, 0.5) !important;
    }

    .day.off .names-mini .empty {
      color: rgba(255, 255, 255, 0.7) !important;
      border: 1px dashed rgba(255, 200, 200, 0.4) !important;
      text-shadow: none !important;
    }

    .day.off .dot {
      background: #5A0000 !important;
      box-shadow: 
        0 0 0 1.5px rgba(255, 100, 100, 0.8) inset,
        0 0 10px rgba(139, 0, 0, 0.8) !important;
    }

    .day.off:hover::before {
      background: 
        radial-gradient(circle at center, 
          rgba(255, 100, 100, 0.1) 0%,
          transparent 70%),
        url("data:image/svg+xml,%3Csvg width='30' height='30' viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M15,9 Q18,6 21,9 Q24,12 21,15 Q18,18 15,15 Q12,18 9,15 Q6,12 9,9 Q12,6 15,9' fill='rgba(255,255,255,0.1)'/%3E%3C/svg%3E");
      background-size: cover, 30px 30px;
      background-position: center, 10px 10px;
      background-repeat: no-repeat;
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0.3;
      z-index: 0;
      pointer-events: none;
    }

    .day.cuti{
      background: linear-gradient(145deg,#d2ebff,#aad7ff,#78b4f0,#ebf8ff);
      border-color:#8cc8ff; color:#031628;
    }
    .day.bagan{
      background: linear-gradient(145deg,#ebe6ff,#d2c8f5,#afa5dc,#f5f2ff);
      border-color:#c8b9ff; color:#16092a;
    }

    .names-mini{
      font-size:11.5px; line-height:1.2; font-weight:800;
      display:grid; gap:3px; margin-top:2px; flex:1; overflow:hidden;
    }

    .names-mini .line{
      display:flex; align-items:center; gap:4px; padding:3px 4px; border-radius:5px;
      background:rgba(255, 255, 255, 0.15); border:1px solid rgba(255, 215, 0, 0.3);
      min-height:20px; max-height:20px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;
      color: #FFD700;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 3px rgba(255, 215, 0, 0.5);
    }
    
    .names-mini .nm{
      flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; min-width:0;
      color: #FFD700;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 3px rgba(255, 215, 0, 0.5);
    }

    .role-pill{
      font-size:8.5px; font-weight:900; padding:1px 5px; border-radius:999px;
      border:1px solid rgba(255, 215, 0, 0.5); text-transform:uppercase; white-space:nowrap;
      flex-shrink:0; max-width:70px; overflow:hidden; text-overflow:ellipsis;
      background: rgba(0, 0, 0, 0.3);
      color: #FFD700;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 3px rgba(255, 215, 0, 0.5);
    }

    .names-mini .empty{
      opacity:.7; font-weight:700; font-size:10px; text-align:center;
      padding:6px 0; background:transparent; border:1px dashed rgba(255, 215, 0, 0.5);
      color: #FFD700;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 3px rgba(255, 215, 0, 0.5);
    }

    .dot{
      position:absolute; right:6px; bottom:6px; width:8px; height:8px; border-radius:50%;
      background: rgba(255, 215, 0, 0.7); box-shadow:0 0 0 1.5px rgba(139, 0, 0, 0.8) inset;
    }
    .day.off .dot,.day.blocked .dot,.day.cuti .dot,.day.bagan .dot{
      background:#fff; box-shadow:0 0 8px rgba(255,255,255,.8);
    }

    .today{outline:2px solid rgba(255, 215, 0, 0.9); outline-offset:-2px;}

    .section-head{
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      background:rgba(255,255,255,.05);
      border-radius:14px;
      margin-bottom:10px;
    }
    .section-title{
      justify-self:center;
      font-weight:900;
      letter-spacing:.5px;
      text-transform:uppercase;
      text-align:center;
      padding:8px 14px;
      border-radius:14px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      min-width:min(520px, 90%);
      color:#f8fafc;
    }
    @media (max-width: 700px){
      .section-title{min-width:unset; width:100%;}
      .section-head{grid-template-columns:1fr;}
      .section-head > div:last-child{justify-self:center;}
    }

    @supports (-webkit-background-clip:text) or (background-clip:text){
      .section-title{
        position:relative;
        overflow:hidden;
        color: transparent !important;
        -webkit-text-fill-color: transparent;
        -webkit-background-clip: text;
        background-clip: text;
        background-size: 220% 220%;
        animation: titleFlow 4.5s ease-in-out infinite;
        text-shadow: 0 10px 30px rgba(0,0,0,.35);
      }
      .section-title::after{
        content:"";
        position:absolute;
        inset:-40% -60%;
        background: linear-gradient(120deg,
          transparent 0%,
          rgba(255,255,255,.22) 45%,
          rgba(255,255,255,.45) 50%,
          rgba(255,255,255,.22) 55%,
          transparent 100%
        );
        transform: translateX(-60%);
        animation: titleShine 3.2s ease-in-out infinite;
        pointer-events:none;
        mix-blend-mode: screen;
      }
      .section-title.title-cuti{
        background-image: linear-gradient(90deg,#38bdf8 0%,#a78bfa 35%,#22c55e 70%,#38bdf8 100%);
      }
      .section-title.title-bagan{
        background-image: linear-gradient(90deg,#f59e0b 0%,#f97316 35%,#ec4899 70%,#f59e0b 100%);
      }
      .section-title.title-piket{
        background-image: linear-gradient(90deg,#e5e7eb 0%,#94a3b8 30%,#f8fafc 55%,#6b7280 80%,#e5e7eb 100%);
        animation-duration: 5.2s;
      }
      .section-title.title-cs{
        background-image: linear-gradient(90deg,#22c55e 0%,#06b6d4 35%,#a78bfa 70%,#22c55e 100%);
      }
      .section-title.title-catatan{
        background-image: linear-gradient(90deg,#FFE5E5 0%,#FFAAAA 35%,#FF6B6B 70%,#FFE5E5 100%);
      }

      @keyframes titleFlow{
        0%   { background-position: 0% 50%; }
        50%  { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      @keyframes titleShine{
        0%   { transform: translateX(-60%) rotate(2deg); opacity:0; }
        20%  { opacity:.55; }
        50%  { transform: translateX(60%) rotate(2deg); opacity:.35; }
        100% { transform: translateX(60%) rotate(2deg); opacity:0; }
      }
    }
    @media (prefers-reduced-motion: reduce){
      .section-title, .section-title::after{ animation:none !important; }
    }

    .cuti-panel{display:none;}
    .cuti-table-wrap{
      width:100%;
      overflow:auto;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      box-shadow:var(--shadow);
    }
    table.cuti-table{
      width:100%;
      border-collapse:collapse;
      min-width:850px;
      font-size:14px;
    }
    .cuti-table thead th{
      background:linear-gradient(90deg, var(--gold), var(--gold2));
      color:#0b1020;
      text-align:center;
      padding:12px 10px;
      font-weight:900;
      letter-spacing:.4px;
      position:sticky; top:0; z-index:1;
    }
    .cuti-table tbody td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.12);
      text-align:center;
      font-weight:800;
      color:#f8fafc;
      background:rgba(0,0,0,.25);
    }
    .cuti-table tbody tr:hover td{background:rgba(255,255,255,.06)}
    .cuti-table td.name{text-align:left; padding-left:16px;}
    .cuti-table .info-btn{
      padding:6px 10px; border-radius:6px;
      background:#0ea5e9; color:white; font-weight:900; font-size:12px;
    }
    .cuti-table .del-btn{
      padding:6px 10px; border-radius:6px;
      background:#ef4444; color:white; font-weight:900; font-size:12px;
      margin-left:6px;
    }

    .bagan-panel{display:none;}
    .bagan-wrap{
      position:relative;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.45);
      box-shadow:var(--shadow);
      padding:14px;
      overflow:auto;
      min-height:65vh;
      min-width:1200px;
    }
    .bagan-board{
      display:grid;
      grid-auto-rows:90px;
      gap:10px;
      width:max-content;
      padding:8px;
      background:rgba(255,255,255,.04);
      border-radius:12px;
    }
    
    .seat{
      position: relative;
      border-radius: 10px;
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      color: #ecf0f1;
      font-weight: 900;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 8px;
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.2),
        0 6px 15px rgba(0,0,0,.4);
      cursor: pointer;
      user-select: none;
      border: 2px solid rgba(255,255,255,.15);
      transition: all 0.2s ease;
      min-height: 90px;
      overflow: hidden;
    }
    
    .seat:hover {
      transform: translateY(-2px);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.3),
        0 8px 20px rgba(0,0,0,.5);
    }
    
    .seat small {
      position: absolute;
      top: 4px;
      left: 6px;
      background: rgba(0,0,0,.7);
      color: #fff;
      font-size: 9px;
      padding: 1px 4px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.2);
      min-width: 16px;
      text-align: center;
    }
    
    .seat.empty {
      opacity: 0.6;
      background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);
      border-color: rgba(255,255,255,.1);
    }
    
    .seat.empty:hover {
      opacity: 0.8;
    }
    
    .seat.dragging{opacity:.35; transform:scale(.98);}
    .seat.drop-target{outline:2px dashed #22c55e; outline-offset:2px;}
    .seat.hidden{
      visibility: hidden;
      pointer-events: none;
      background: transparent !important;
      border: none !important;
      box-shadow: none !important;
    }

    .modal-backdrop{
      position:fixed; inset:0; background:rgba(2,6,23,.6); display:none;
      place-items:center; padding:18px; z-index:50; backdrop-filter: blur(4px);
    }
    .modal{
      width:min(820px,100%);
      background:#0e1430; border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:14px; box-shadow:var(--shadow);
      color:var(--text);
      display:grid; grid-template-columns: 1.2fr .8fr; gap:12px;
    }
    .modal h3{margin:0 0 6px; font-size:16px}
    .modal .sub{color:var(--muted); font-size:12px; margin-bottom:10px}

    .names-grid{display:grid; grid-template-columns:1fr; gap:8px;}
    .names-grid input{
      width:100%; padding:9px 10px; border-radius:10px; outline:none;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      color:var(--text); font-size:13px;
    }

    .modal-actions{
      display:flex; justify-content:space-between; gap:8px; margin-top:12px; flex-wrap:wrap;
      grid-column: 1 / -1;
    }
    .left-actions,.right-actions{display:flex; gap:8px; flex-wrap:wrap;}

    .role-row{display:grid; grid-template-columns:1.6fr 0.9fr; gap:8px;}
    .select-wrap{position:relative; width:100%;}
    .role-select{
      appearance:none; width:100%; padding:9px 34px 9px 10px; border-radius:10px;
      border:1px solid rgba(255,255,255,.12); outline:none; font-size:12.5px; font-weight:900;
      letter-spacing:.3px; background:#202741; color:#eef2ff;
    }
    .select-wrap .chev{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      font-size:12px; opacity:.7; pointer-events:none;
    }

    .copy-panel{
      background: rgba(255,255,255,.05); border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px; padding:10px; display:flex; flex-direction:column; gap:8px;
      height:100%;
    }
    .copy-panel textarea{
      width:100%; flex:1; min-height:200px; resize:vertical; border-radius:10px; padding:10px;
      font-size:12.5px; line-height:1.4; background:rgba(15,23,42,0.8); color:#eef2ff;
      border:1px solid rgba(255,255,255,.15); outline:none; white-space:pre;
      font-family:'Courier New', monospace;
    }
    .copy-panel textarea:focus{
      border-color:var(--accent); box-shadow:0 0 0 2px rgba(139,92,246,.2);
    }
    #copyBtn{
      width:100%; padding:10px; font-size:13px; font-weight:900; letter-spacing:.3px;
    }

    .cuti-form{
      display:grid; gap:8px;
      grid-template-columns:1fr 1fr;
    }
    .cuti-form .full{grid-column:1/-1;}
    .cuti-form label{font-size:12px; font-weight:900; letter-spacing:.3px;}
    .cuti-form input, .cuti-form textarea{
      width:100%; padding:9px 10px; border-radius:10px; outline:none;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      color:var(--text); font-size:13px;
    }
    .cuti-form textarea{min-height:90px; resize:vertical;}

    .toast{
      position:fixed; left:50%; bottom:22px; transform:translateX(-50%);
      background: linear-gradient(135deg, rgba(139,0,0,0.9) 0%, rgba(165,42,42,0.9) 100%);
      color:white; padding:10px 12px; border-radius:10px;
      font-size:13px; opacity:0; pointer-events:none; transition:.2s; z-index:99;
      border: 1px solid rgba(255,215,0,0.3);
      box-shadow: 0 0 20px rgba(255,100,100,0.5);
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px);}

    .piket-panel{display:none;}
    .piket-panel .cuti-table thead th{
      background:linear-gradient(90deg, #111827, #334155);
      color:#f8fafc;
    }
    
    .piket-name {
      display: inline-block;
      padding: 6px 8px;
      margin: 2px;
      border-radius: 10px;
      font-weight: 900;
      cursor: pointer;
      min-width: 70px;
      text-align: center;
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.10);
      
      color: #FFE5E5;
      text-shadow: 
        0 0 8px rgba(255, 100, 100, 0.7),
        0 0 12px rgba(255, 200, 200, 0.5),
        0 0 20px rgba(255, 255, 255, 0.3);
      
      background-image: linear-gradient(
        180deg,
        rgba(255, 245, 245, 0.9) 0%,
        rgba(255, 230, 230, 0.8) 25%,
        rgba(255, 210, 210, 0.7) 50%,
        rgba(255, 190, 190, 0.6) 75%,
        rgba(255, 170, 170, 0.5) 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 200, 200, 0.5);
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.6),
        0 4px 12px rgba(255, 100, 100, 0.4);
    }

    .piket-name.empty {
      opacity: 0.55;
      font-weight: 800;
      background-image: none;
      -webkit-background-clip: initial;
      background-clip: initial;
      -webkit-text-fill-color: initial;
      color: rgba(255, 255, 255, 0.55);
      text-shadow: none;
      border: 1px solid rgba(255, 255, 255, 0.14);
    }

    .piket-name:hover {
      transform: translateY(-1px);
      background-color: rgba(255, 200, 200, 0.15);
      box-shadow: 
        0 0 15px rgba(255, 100, 100, 0.8),
        0 0 25px rgba(255, 200, 200, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      transition: all 0.2s ease;
    }

    #piketPanel .piket-name {
      background: rgba(0, 0, 0, 0.28);
      border: 1px solid rgba(255, 255, 255, 0.14);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.35);
      
      background-image: linear-gradient(
        135deg,
        #FFEAEA 0%,
        #FFDADA 25%,
        #FFCACA 50%,
        #FFBABA 75%,
        #FFAAAA 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 180, 180, 0.6);
      
      text-shadow: 
        0 0 10px rgba(255, 150, 150, 0.8),
        0 0 20px rgba(255, 100, 100, 0.6),
        0 0 30px rgba(255, 50, 50, 0.4);
      
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.7),
        0 8px 20px rgba(255, 100, 100, 0.5);
    }

    #piketPanel .piket-name.empty {
      background-image: none;
      -webkit-background-clip: initial;
      background-clip: initial;
      -webkit-text-fill-color: initial;
      color: rgba(255, 200, 200, 0.55);
      -webkit-text-stroke: 0;
      text-shadow: none;
      border: 1px solid rgba(255, 200, 200, 0.3);
    }

    #toggleBlock {
      background: linear-gradient(145deg,
        #DC2626 0%,
        #EF4444 25%,
        #F87171 50%,
        #EF4444 75%,
        #B91C1C 100%
      ) !important;
      color: white !important;
      border: 1px solid rgba(220, 38, 38, 0.7) !important;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.7),
        0 0 8px rgba(255, 255, 255, 0.5);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -1px 0 rgba(0, 0, 0, 0.6),
        0 4px 12px rgba(220, 38, 38, 0.4) !important;
      font-weight: 900;
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
    }

    #toggleBlock:hover {
      background: linear-gradient(145deg,
        #EF4444 0%,
        #F87171 25%,
        #FCA5A5 50%,
        #F87171 75%,
        #DC2626 100%
      ) !important;
      transform: translateY(-2px);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.5),
        inset 0 -1px 0 rgba(0, 0, 0, 0.7),
        0 6px 16px rgba(220, 38, 38, 0.6) !important;
    }

    .cs-panel{display:none;}
    .cs-wrap{
      width:100%;
      overflow:auto;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      box-shadow: var(--shadow);
      min-width:1200px;
    }
    table.cs-table{
      width:100%;
      border-collapse:collapse;
      min-width:920px;
      font-size:14px;
    }
    .cs-table thead th{
      background:linear-gradient(90deg,#22c55e,#06b6d4,#a78bfa);
      color:#06121a;
      text-align:center;
      padding:12px 10px;
      font-weight:900;
      letter-spacing:.4px;
      position:sticky; top:0; z-index:1;
    }
    .cs-table tbody td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.12);
      text-align:center;
      font-weight:900;
      color:#f8fafc;
      background:rgba(0,0,0,.25);
    }
    .cs-table tbody tr:hover td{background:rgba(255,255,255,.06)}
    .cs-table td.name{
      text-align:left;
      padding-left:16px;
      font-weight:900;
      color:#fff;
    }
    .cs-table td.name:hover{ text-decoration: underline; opacity: .95; }

    .cs-job-wrap{
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
    }
    .cs-job-select{
      appearance:none;
      padding:8px 34px 8px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      outline:none;
      font-weight:900;
      font-size:12px;
      letter-spacing:.3px;
      background:#202741;
      color:#eef2ff;
      cursor:pointer;
      min-width:220px;
    }
    .cs-del-btn{
      padding:7px 10px;
      border-radius:10px;
      background:#ef4444;
      color:white;
      font-weight:900;
      border:0;
      cursor:pointer;
    }
    .cs-del-btn:hover{filter:brightness(1.05); transform:translateY(-1px);}

    .cs-panel .btn-green{
      background:rgba(34,197,94,.28);
      color:#eafff2;
      font-weight:900;
      border-radius:10px;
      padding:7px 10px;
      border:0;
      cursor:pointer;
    }
    .cs-panel .btn-green:hover{
      background:rgba(34,197,94,.38);
      transform:translateY(-1px);
    }

    .cs-add-btn{
      padding:9px 12px;
      border-radius:12px;
      background:rgba(34,197,94,.20);
      color:#eafff2;
      font-weight:900;
      border:0;
      cursor:pointer;
    }
    .cs-add-btn:hover{background:rgba(34,197,94,.30); transform:translateY(-1px);}
    .cs-reset-btn{
      padding:9px 12px;
      border-radius:12px;
      background:rgba(244,63,94,.20);
      color:#ffe9ed;
      font-weight:900;
      border:0;
      cursor:pointer;
    }
    .cs-reset-btn:hover{background:rgba(244,63,94,.30); transform:translateY(-1px);}

    .catatan-panel{display:none;}
    .catatan-container{
      display:flex;
      flex-direction:column;
      gap:15px;
      padding:10px;
      min-width:1200px;
    }
    
    .catatan-form{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px;
      padding:15px;
      margin-bottom:10px;
    }
    
    .catatan-form h3{
      margin:0 0 15px 0;
      color:#fff;
      font-size:16px;
      font-weight:900;
      letter-spacing:.5px;
      text-transform:uppercase;
      text-align:center;
      padding:8px 14px;
      border-radius:14px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
    }
    
    .catatan-form .form-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-bottom:10px;
    }
    
    .catatan-form input,
    .catatan-form textarea,
    .catatan-form select{
      flex:1;
      min-width:200px;
      padding:8px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-size:14px;
    }
    
    .catatan-form textarea{
      min-height:80px;
      resize:vertical;
      width:100%;
    }
    
    .catatan-list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    
    .catatan-item{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:10px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      overflow:hidden;
    }
    
    .catatan-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    
    .catatan-title{
      font-weight:bold;
      font-size:15px;
      font-weight:900;
      letter-spacing:.5px;
      color: transparent !important;
      background-image: linear-gradient(
        135deg,
        #FFEAEA 0%,
        #FFDADA 25%,
        #FFCACA 50%,
        #FFBABA 75%,
        #FFAAAA 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 
        0 0 10px rgba(255, 150, 150, 0.8),
        0 0 20px rgba(255, 100, 100, 0.6),
        0 0 30px rgba(255, 50, 50, 0.4);
    }
    
    .catatan-category{
      font-size:11px;
      padding:3px 8px;
      border-radius:20px;
      font-weight:900;
      letter-spacing:.3px;
    }
    
    .catatan-content{
      font-size:13px;
      line-height:1.4;
      margin:5px 0;
      padding:8px;
      border-radius:6px;
      background:rgba(0,0,0,.25);
      color: #FFE5E5;
      text-shadow: 
        0 0 8px rgba(255, 100, 100, 0.7),
        0 0 12px rgba(255, 200, 200, 0.5),
        0 0 20px rgba(255, 255, 255, 0.3);
      border: 1px solid rgba(255, 180, 180, 0.3);
    }
    
    .catatan-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11px;
    }
    
    .catatan-date{
      opacity:.8;
      font-weight:900;
      color: #FFCACA;
      text-shadow: 
        0 0 5px rgba(255, 150, 150, 0.6),
        0 0 10px rgba(255, 100, 100, 0.4);
    }
    
    .catatan-actions{
      display:flex;
      gap:5px;
    }
    
    .catatan-btn{
      padding:4px 8px;
      border-radius:6px;
      font-size:11px;
      border:none;
      cursor:pointer;
      background:rgba(255,255,255,.08);
      color:var(--text);
      font-weight:900;
      letter-spacing:.3px;
      background-image: linear-gradient(
        180deg,
        rgba(255, 245, 245, 0.9) 0%,
        rgba(255, 230, 230, 0.8) 25%,
        rgba(255, 210, 210, 0.7) 50%,
        rgba(255, 190, 190, 0.6) 75%,
        rgba(255, 170, 170, 0.5) 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 200, 200, 0.5);
      box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.6),
        0 2px 4px rgba(255, 100, 100, 0.3);
    }
    
    .catatan-btn:hover{
      background-color: rgba(255, 200, 200, 0.15);
      transform:translateY(-1px);
      box-shadow: 
        0 0 10px rgba(255, 100, 100, 0.6),
        0 0 15px rgba(255, 200, 200, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }
    
    .catatan-btn.delete{
      background-image: linear-gradient(
        180deg,
        #FFCACA 0%,
        #FFAAAA 25%,
        #FF8A8A 50%,
        #FF6A6A 75%,
        #FF4A4A 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 100, 100, 0.6);
    }
    
    .catatan-btn.edit{
      background-image: linear-gradient(
        180deg,
        #FFF4CA 0%,
        #FFEAAA 25%,
        #FFE08A 50%,
        #FFD66A 75%,
        #FFCC4A 100%
      );
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      
      border: 1px solid rgba(255, 200, 100, 0.6);
    }
    
    .empty-catatan{
      text-align:center;
      padding:40px 20px;
      color:var(--muted);
      font-size:14px;
    }

    .catatan-category[data-category="DI BAWAH 3 BULAN"] {
      background: rgba(34, 197, 94, 0.3);
      color: #a7f3d0;
      border: 1px solid rgba(34, 197, 94, 0.5);
    }
    
    .catatan-category[data-category="DI ATAS 3 BULAN"] {
      background: rgba(59, 130, 246, 0.3);
      color: #93c5fd;
      border: 1px solid rgba(59, 130, 246, 0.5);
    }
    
    .catatan-category[data-category="DI BAWAH 6 BULAN"] {
      background: rgba(245, 158, 11, 0.3);
      color: #fcd34d;
      border: 1px solid rgba(245, 158, 11, 0.5);
    }
    
    .catatan-category[data-category="DI ATAS 6 BULAN"] {
      background: rgba(139, 92, 246, 0.3);
      color: #c4b5fd;
      border: 1px solid rgba(139, 92, 246, 0.5);
    }
    
    .catatan-category[data-category="RESIGN"] {
      background: rgba(239, 68, 68, 0.3);
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, 0.5);
    }

    #topTabs .tab-btn[data-type="CATATAN"] {
      background:rgba(255, 100, 100, 0.16);
      color:#FFCACA;
    }
    
    #topTabs .tab-btn[data-type="CATATAN"]:hover {
      background:rgba(255, 100, 100, 0.26);
    }
    
    #topTabs .tab-btn[data-type="CATATAN"].active {
      background:rgba(255, 100, 100, 0.85);
      color:#FFEAEA;
      box-shadow:0 6px 20px rgba(255, 100, 100, 0.45);
    }

    .password-modal .modal {
      width: min(400px, 90%);
      grid-template-columns: 1fr;
    }
    
    .password-input {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: rgba(255, 255, 255, 0.06);
      color: var(--text);
      font-size: 14px;
      margin: 10px 0;
      letter-spacing: 1px;
    }
    
    .password-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.25);
    }
    
    .password-hint {
      font-size: 11px;
      color: var(--muted);
      margin-top: 5px;
      text-align: center;
    }

    /* Responsif untuk mobile */
    @media (max-width: 700px){
      .modal{grid-template-columns:1fr;}
      .bagan-board{grid-template-columns:repeat(20, 80px);}
      
      .grid{
        gap:6px;
        padding:6px;
      }
      .day{
        min-height:130px;
        padding:4px;
      }
      .date-row{
        font-size:12px;
      }
      .date-row span:first-child{
        font-size:14px;
      }
      .badge{
        font-size:8px;
        padding:1px 4px;
      }
      .names-mini{
        font-size:10.5px;
        gap:2px;
      }
      .names-mini .line{
        padding:2px 3px;
        min-height:18px;
        max-height:18px;
      }
      .role-pill{
        font-size:7.5px;
        padding:1px 4px;
        max-width:60px;
      }

      body::after {
        background-size: 
          60px 60px,
          50px 50px,
          40px 40px,
          30px 30px,
          20px 20px,
          15px 15px;
        
        background-position: 
          5% 5%,
          95% 10%,
          10% 90%,
          90% 85%,
          80% 25%,
          20% 75%,
          95% 50%,
          5% 30%,
          50% 15%,
          85% 95%;
        
        opacity: 0.3;
      }
      
      @keyframes floatRoses {
        0%, 100% {
          transform: translate(0, 0) rotate(0deg);
        }
        25% {
          transform: translate(3px, 5px) rotate(0.5deg);
        }
        50% {
          transform: translate(-2px, -3px) rotate(-0.5deg);
        }
        75% {
          transform: translate(4px, -2px) rotate(0.3deg);
        }
      }
    }

    @media (max-width: 480px){
      .grid{
        gap:4px;
      }
      .day{
        min-height:120px;
      }
      .names-mini{
        font-size:10px;
      }
      .names-mini .line{
        min-height:16px;
        max-height:16px;
      }

      body::after {
        background-size: 
          40px 40px,
          35px 35px,
          30px 30px,
          25px 25px,
          20px 20px,
          15px 15px;
        
        opacity: 0.25;
      }
    }
  
    .cs-name-span{font-weight:900; letter-spacing:.2px;}
    
    /* ===== STYLE UNTUK BARI-BARIS KOLOM EXCEL ===== */
    .baris-kolom-panel {
      display: none;
      background: rgba(255,255,255,.06);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 20px;
      min-width: 1200px;
    }
    
    .baris-kolom-excel-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1400px;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      overflow: hidden;
    }
    
    .baris-kolom-excel-table th {
      background-color: #5A0000;
      color: #FFD700;
      font-weight: 900;
      text-align: center;
      padding: 15px 10px;
      border: 2px solid #FFD700;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .baris-kolom-excel-table th:first-child {
      width: 60px;
      background: #2A0000;
    }
    
    .baris-kolom-excel-table td {
      border: 1px solid rgba(255,215,0,0.3);
      padding: 0;
      background: rgba(255,215,0,0.05);
      transition: background-color 0.2s ease;
      min-width: 180px;
    }
    
    .excel-input-group {
      display: flex;
      flex-direction: column;
      gap: 1px;
      padding: 0;
      min-height: 160px;
    }
    
    .excel-nama-input {
      width: 100%;
      padding: 6px 8px;
      border: none;
      background: transparent;
      color: #FFFFFF !important;
      font-weight: 900 !important;
      font-size: 11px;
      outline: none;
      transition: all 0.2s ease;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 5px rgba(255, 255, 255, 0.3) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .excel-nama-input:focus {
      background: rgba(255, 255, 255, 0.1) !important;
      box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.3) !important;
    }
    
    .excel-nama-input::placeholder {
      color: rgba(255, 255, 255, 0.4) !important;
      font-weight: 700 !important;
    }
    
    .excel-date-container {
      display: flex;
      flex-direction: column;
      gap: 1px;
      margin-top: 3px;
      padding: 3px;
      background: rgba(0, 0, 0, 0.2);
      border-top: 1px solid rgba(0, 255, 0, 0.3);
    }
    
    .excel-date-input {
      width: 100%;
      padding: 5px 6px;
      border: none;
      background: transparent;
      color: #00FF00 !important;
      font-weight: 900 !important;
      font-size: 11px;
      outline: none;
      transition: all 0.2s ease;
      text-shadow: 
        0 1px 0 rgba(0, 0, 0, 0.8),
        0 0 8px rgba(0, 255, 0, 0.7),
        0 0 12px rgba(0, 255, 0, 0.5) !important;
      border-bottom: 1px dashed rgba(0, 255, 0, 0.2);
    }
    
    .excel-date-input:focus {
      background: rgba(0, 255, 0, 0.1) !important;
      box-shadow: 
        inset 0 0 0 2px rgba(0, 255, 0, 0.5),
        0 0 15px rgba(0, 255, 0, 0.3) !important;
    }
    
    .excel-date-input::placeholder {
      color: rgba(0, 255, 0, 0.4) !important;
      font-weight: 700 !important;
    }
    
    .baris-kolom-excel-table tr:hover td {
      background: rgba(255,215,0,0.1);
    }
    
    .baris-kolom-excel-table td:first-child {
      background: rgba(90,0,0,0.4);
      color: #FFD700;
      text-align: center;
      font-weight: 900;
      font-size: 14px;
      border-right: 2px solid #FFD700;
    }
    
    .copy-kolom-excel-btn {
      padding: 6px 12px;
      border-radius: 6px;
      background: #FFD700;
      color: #5A0000;
      border: none;
      font-weight: 900;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-left: 5px;
    }
    
    .copy-kolom-excel-btn:hover {
      background: #FFC800;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .copy-kolom-excel-btn:active {
      transform: translateY(0);
    }
    
    .excel-table-container {
      width: 100%;
      overflow: auto;
      border-radius: 14px;
      border: 1px solid rgba(255,215,0,0.5);
      padding: 15px;
      background: rgba(0,0,0,0.3);
      min-height: 600px;
      max-height: 80vh;
      position: relative;
    }
    
    .excel-table-container::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }
    
    .excel-table-container::-webkit-scrollbar-track {
      background: rgba(90,0,0,0.3);
      border-radius: 6px;
    }
    
    .excel-table-container::-webkit-scrollbar-thumb {
      background: #FFD700;
      border-radius: 6px;
      border: 2px solid rgba(90,0,0,0.3);
    }
    
    .baris-kolom-excel-table thead {
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .baris-kolom-excel-table th:first-child,
    .baris-kolom-excel-table td:first-child {
      position: sticky;
      left: 0;
      z-index: 5;
    }
    
    .kolom-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .kolom-title {
      font-size: 14px;
      font-weight: 900;
      color: #FFD700;
      text-shadow: 0 1px 0 rgba(0, 0, 0, 0.8);
      text-align: center;
      padding: 4px 0;
    }
    
    .nama-management-panel {
      display: none;
      background: rgba(255,255,255,.06);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 20px;
      min-width: 1200px;
    }
    
    .nama-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .nama-card {
      background: rgba(0,0,0,.3);
      border-radius: 12px;
      padding: 15px;
      border: 1px solid rgba(139,92,246,.2);
      transition: all 0.3s ease;
    }
    
    .nama-card:hover {
      border-color: rgba(139,92,246,.5);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(139,92,246,.2);
    }
    
    .nama-card-title {
      font-weight: 900;
      font-size: 14px;
      color: #8B5CF6;
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid rgba(139,92,246,.2);
    }
    
    .nama-input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .nama-input {
      flex: 1;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.1);
      background: rgba(255,255,255,.05);
      color: #eef2ff;
      font-size: 14px;
    }
    
    .nama-select {
      width: 100%;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.1);
      background: rgba(255,255,255,.05);
      color: #eef2ff;
      font-size: 14px;
      margin-bottom: 10px;
      cursor: pointer;
    }
    
    .nama-btn {
      padding: 8px 15px;
      border-radius: 8px;
      background: rgba(139,92,246,.6);
      color: white;
      border: none;
      font-weight: 900;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .nama-btn:hover {
      background: rgba(139,92,246,.8);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(139,92,246,.4);
    }
    
    .nama-list {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
    }
    
    .nama-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px;
      margin-bottom: 5px;
      background: rgba(255,255,255,.03);
      border-radius: 6px;
      border: 1px solid rgba(139,92,246,.1);
    }
    
    .nama-item-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    
    .nama-item-name {
      font-weight: 700;
      color: #eef2ff;
      font-size: 13px;
    }
    
    .nama-item-divisi {
      font-size: 10px;
      color: rgba(139,92,246,.8);
      font-weight: 700;
    }
    
    .nama-item-actions {
      display: flex;
      gap: 5px;
    }
    
    .nama-item-btn {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 900;
      cursor: pointer;
      border: none;
      background: rgba(255,255,255,.08);
      color: #eef2ff;
    }
    
    .nama-item-btn:hover {
      background: rgba(255,255,255,.15);
    }
    
    .nama-item-btn.edit {
      background: rgba(34,197,94,.3);
      color: #A7F3D0;
    }
    
    .nama-item-btn.edit:hover {
      background: rgba(34,197,94,.5);
    }
    
    .nama-item-btn.delete {
      background: rgba(220,38,38,.3);
      color: #FFA5A5;
    }
    
    .nama-item-btn.delete:hover {
      background: rgba(220,38,38,.5);
    }
    
    .nama-empty {
      text-align: center;
      padding: 30px;
      color: rgba(255,255,255,.4);
      font-size: 13px;
      font-style: italic;
    }
    
    #topTabs .tab-btn[data-type="BARI_KOLOM"] {
      background: rgba(255, 215, 0, 0.16);
      color: #FFD700;
    }
    
    #topTabs .tab-btn[data-type="BARI_KOLOM"]:hover {
      background: rgba(255, 215, 0, 0.26);
    }
    
    #topTabs .tab-btn[data-type="BARI_KOLOM"].active {
      background: rgba(255, 215, 0, 0.85);
      color: #0b1020;
      box-shadow: 0 6px 20px rgba(255, 215, 0, 0.45);
    }
    
    #topTabs .tab-btn[data-type="NAMA"] {
      background: rgba(139, 92, 246, 0.16);
      color: #C4B5FD;
    }
    
    #topTabs .tab-btn[data-type="NAMA"]:hover {
      background: rgba(139, 92, 246, 0.26);
    }
    
    #topTabs .tab-btn[data-type="NAMA"].active {
      background: rgba(139, 92, 246, 0.85);
      color: white;
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.45);
    }
    
    @media (max-width: 700px) {
      .baris-kolom-excel-table {
        min-width: 1200px;
      }
      
      .excel-nama-input {
        padding: 5px 6px;
        font-size: 10px;
      }
      
      .excel-date-input {
        padding: 4px 5px;
        font-size: 10px;
      }
      
      .excel-input-group {
        min-height: 140px;
      }
    }
    
    @media (max-width: 480px) {
      .excel-nama-input {
        padding: 4px 5px;
        font-size: 9px;
      }
      
      .excel-date-input {
        padding: 3px 4px;
        font-size: 9px;
      }
      
      .excel-input-group {
        min-height: 120px;
      }
    }
    
    #modalNames {
      max-height: 350px;
      overflow-y: auto;
      overflow-x: hidden;
      padding-right: 5px;
    }
    
    #modalNames::-webkit-scrollbar {
      width: 6px;
    }
    
    #modalNames::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
      border-radius: 3px;
    }
    
    #modalNames::-webkit-scrollbar-thumb {
      background: rgba(139,92,246,0.5);
      border-radius: 3px;
    }
    
    #modalNames::-webkit-scrollbar-thumb:hover {
      background: rgba(139,92,246,0.7);
    }
    
    #undoBtn:not(:disabled):hover, #redoBtn:not(:disabled):hover {
      transform: translateY(-1px);
      background: rgba(245,158,11,0.26);
    }
    
    #undoBtn:disabled, #redoBtn:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
    
    .slot-info {
      font-size: 11px;
      color: #FFD700;
      text-align: center;
      padding: 4px;
      background: rgba(90,0,0,0.2);
      border-radius: 6px;
      margin-bottom: 8px;
      border: 1px solid rgba(255,215,0,0.3);
    }

    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    @media (max-width: 700px) {
      .falling-star {
        display: none;
      }
      
      .floating-rose.large {
        width: 80px;
        height: 80px;
      }
      
      .floating-rose.medium {
        width: 60px;
        height: 60px;
      }
      
      .floating-rose.small {
        width: 30px;
        height: 30px;
      }
      
      .panel::before,
      .panel::after {
        display: none;
      }
      
      .controls button::after {
        animation: none;
      }
      
      #topTabs .tab-btn.active::before {
        animation: none;
      }
    }

    @media (max-width: 480px) {
      .floating-rose {
        display: none;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .falling-star,
      .floating-rose,
      .panel::before,
      .panel::after,
      .controls button::after,
      #topTabs .tab-btn.active::before {
        animation: none !important;
      }
    }

    .starfield {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -3;
    }
    
    /* ===== STYLE UNTUK TOMBOL UNDO/REDO ===== */
    #undoBtn:not(:disabled), #redoBtn:not(:disabled) {
        background: linear-gradient(145deg,
            #F59E0B 0%,
            #FBBF24 25%,
            #FCD34D 50%,
            #FBBF24 75%,
            #D97706 100%
        ) !important;
        color: #000000 !important;
        border: 1px solid rgba(245, 158, 11, 0.7) !important;
        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
        font-weight: 900;
    }
    
    #undoBtn:disabled, #redoBtn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    /* ===== STYLE UNTUK TOMBOL RESET BAGAN ===== */
    #resetBaganBtn {
        background: linear-gradient(145deg,
            #DC2626 0%,
            #EF4444 25%,
            #F87171 50%,
            #EF4444 75%,
            #B91C1C 100%
        ) !important;
        color: white !important;
        border: 1px solid rgba(220, 38, 38, 0.7) !important;
        text-shadow: 
            0 1px 0 rgba(0, 0, 0, 0.7),
            0 0 8px rgba(255, 255, 255, 0.5);
        box-shadow:
            inset 0 1px 0 rgba(255, 255, 255, 0.4),
            inset 0 -1px 0 rgba(0, 0, 0, 0.6),
            0 4px 12px rgba(220, 38, 38, 0.4) !important;
        font-weight: 900;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
    }
    
    #resetBaganBtn:hover {
        background: linear-gradient(145deg,
            #EF4444 0%,
            #F87171 25%,
            #FCA5A5 50%,
            #F87171 75%,
            #DC2626 100%
        ) !important;
        transform: translateY(-2px);
        box-shadow:
            inset 0 1px 0 rgba(255, 255, 255, 0.5),
            inset 0 -1px 0 rgba(0, 0, 0, 0.7),
            0 6px 16px rgba(220, 38, 38, 0.6) !important;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>

<body>
  <div class="app">
    <div class="header">
      <div class="brand">
        <div class="logo">OFF</div>
        <div>
          <img src="https://mawartotoday.com/assets/img/xj/logo.png?v=krjgviudzez0veqxtcqf" alt="MAWARTOTO Logo">
        </div>
      </div>

      <div class="top-tabs" id="topTabs">
        <button class="tab-btn" data-type="OFF">OFFDAY</button>
        <button class="tab-btn" data-type="CUTI">CUTI</button>
        <button class="tab-btn" data-type="BAGAN_VIEW">BAGAN</button>
        <button class="tab-btn" data-type="BARI_KOLOM">EXCEL DIVISI</button>
        <button class="tab-btn" data-type="PIKET">PIKET</button>
        <button class="tab-btn" data-type="CS_MAWAROTO">STAFF MAWAROTO</button>
        <button class="tab-btn" data-type="CATATAN">CATATAN</button>
      </div>

      <div class="controls">
        <button id="prev"> Bulan lalu</button>
        <button id="todayBtn" class="btn-green">Hari ini</button>
        <button id="next">Bulan depan </button>
        <button id="bulkImport" class="btn-accent"> Import Excel</button>
        <button id="lockBtn" class="btn-amber"> TERKUNCI</button>
        <button id="undoBtn" disabled></button>
        <button id="redoBtn" disabled></button>
      </div>
    </div>

    <!-- CALENDAR -->
    <section class="panel" id="calendarPanel">
      <div class="cal-head">
        <div style="display:flex; gap:6px">
          <button id="prevMini"></button>
          <button id="nextMini"></button>
        </div>
        <div class="month" id="monthLabel">-</div>
        <div>
          <button id="jumpYear">Loncat Tahun</button>
          <button id="clearBlockedOnly" class="btn-danger"> Hapus Blocked</button>
        </div>
      </div>

      <div class="weekdays" id="weekdays"></div>
      <div class="grid" id="grid"></div>
    </section>

    <!-- CUTI -->
    <section class="panel cuti-panel" id="cutiPanel">
      <div class="section-head">
        <div class="section-title title-cuti">  DAFTAR CUTI STAFF  </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addCutiBtn" class="btn-green">+ Tambah Cuti</button>
          <button id="exportCutiBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="cuti-table-wrap">
        <table class="cuti-table">
          <thead>
            <tr>
              <th>Nama Staff</th>
              <th>Tanggal Cuti</th>
              <th>Selesai Cuti</th>
              <th>Info</th>
            </tr>
          </thead>
          <tbody id="cutiTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- BAGAN -->
    <section class="panel bagan-panel" id="baganPanel">
      <div class="section-head">
        <div class="section-title title-bagan"> TATA LETAK MEJA KERJA </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addRowBtn" class="btn-green">+ Baris</button>
          <button id="addColBtn" class="btn-green">+ Kolom</button>
          <button id="removeColBtn" class="btn-danger"> Hapus Kolom</button>
          <button id="toggleDeleteSeatBtn" class="btn-amber"> MODE HAPUS: OFF</button>
          <button id="resetBaganBtn" class="btn-danger"> Reset Bagan</button>
          <button id="exportBaganBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="bagan-wrap">
        <div style="font-size:12px; opacity:.8; margin:0 0 10px;"></div>
        <div class="bagan-board" id="baganBoard"></div>
      </div>
    </section>

    <!-- BARI-BARIS KOLOM EXCEL -->
    <section class="panel baris-kolom-panel" id="barisKolomPanel">
      <div class="section-head">
        <div class="section-title title-bagan"> NAMA STAFF DIVISI </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addExcelRowBtn" class="btn-green">+ Tambah Baris</button>
          <button id="exportExcelAllBtn" class="btn-accent">Export Semua Data</button>
        </div>
      </div>
      
      <div style="margin:15px; padding:10px; background:rgba(90,0,0,0.3); border-radius:12px; border:1px solid rgba(255,215,0,0.3);">
        <div style="color:#FFD700; font-weight:900; font-size:12px; margin-bottom:10px;">
          Struktur: 31 Baris x 6 Kolom | Setiap sel: 4 Nama + 1 Tanggal
        </div>
        <div style="color:#FFD700; font-weight:900; font-size:12px;">
          Kolom: LIVE CHAT, WHATSAPP, DEPOSIT, FINANCE, WHITDRAW, DESIGN
        </div>
      </div>
      
      <div class="excel-table-container" id="barisKolomTableContainer"></div>
    </section>

    <!-- NAMA MANAGEMENT -->
    <section class="panel nama-management-panel" id="namaPanel">
      <div class="section-head">
        <div class="section-title title-cs"> DATABASE NAMA STAFF </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="exportNamaBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="nama-grid">
        <div class="nama-card">
          <div class="nama-card-title">Tambah Staff Baru</div>
          <div class="nama-input-group">
            <input type="text" id="namaInput" class="nama-input" placeholder="Nama staff...">
            <select id="divisiSelect" class="nama-select">
              <option value="">Pilih Divisi</option>
              <option value="LIVECHAT">LIVECHAT</option>
              <option value="WHATSAPP">WHATSAPP</option>
              <option value="DEPOSIT">DEPOSIT</option>
              <option value="DESIGN">DESIGN</option>
              <option value="FINANCE">FINANCE</option>
              <option value="ADMIN">ADMIN</option>
              <option value="BANKER">BANKER</option>
              <option value="TELEGRAM">TELEGRAM</option>
              <option value="SPV_WD">SPV WD</option>
              <option value="WORKER_WD">WORKER WD</option>
              <option value="QRIS">QRIS</option>
            </select>
          </div>
          <button id="addNamaBtn" class="nama-btn">+ Tambah ke Database</button>
          
          <div class="nama-card-title" style="margin-top: 20px;">Tambah ke Bagan</div>
          <div style="font-size: 12px; color: rgba(255,255,255,.6); margin-bottom: 10px;">
            Pilih nama untuk dimasukkan ke bagan
          </div>
          <select id="namaToBaganSelect" class="nama-select">
            <option value="">Pilih Staff</option>
          </select>
          <button id="addToBaganBtn" class="nama-btn" style="background: rgba(34,197,94,.6);"> Tambah ke Bagan</button>
        </div>

        <div class="nama-card">
          <div class="nama-card-title">Database Staff</div>
          <div class="nama-list" id="namaDatabaseList"></div>
        </div>
      </div>
    </section>

    <!-- PIKET -->
    <section class="panel piket-panel" id="piketPanel">
      <div class="section-head">
        <div class="section-title title-piket"> PIKET BUANG SAMPAH MAWARTOTO </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="exportPiketBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="cuti-table-wrap">
        <table class="cuti-table" id="piketTable">
          <thead>
            <tr>
              <th>Hari</th>
              <th colspan="8">PIKET SHIF PAGI</th>
            </tr>
          </thead>
          <tbody id="piketTableBody"></tbody>
        </table>
      </div>

      <div style="margin-top:10px; font-size:12px; opacity:.8;">
        Klik nama untuk edit. PIKET ini <b>tidak mempengaruhi</b> OFFDAY / CUTI / BAGAN.
      </div>
    </section>

    <!-- CS MAWAROTO -->
    <section class="panel cs-panel" id="csPanel">
      <div class="section-head">
        <div class="section-title title-cs"> STAFF MAWAROTO </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addCsBtn" class="cs-add-btn">+ Tambah CS</button>
          <button id="exportCsBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="cs-wrap">
        <table class="cs-table">
          <thead>
            <tr>
              <th style="width:45%;">NAMA CS</th>
              <th style="width:30%;">JOBDESK</th>
              <th style="width:25%;">AKSI</th>
            </tr>
          </thead>
          <tbody id="csTableBody"></tbody>
        </table>
      </div>

      <div style="margin-top:10px; font-size:12px; opacity:.85;">
        Dropdown untuk <b>ganti jobdesk</b>. Tombol <b> OFFDAY</b> untuk masukin nama ke kalender.
      </div>
    </section>

    <!-- CATATAN CS BARU & RESIGN -->
    <section class="panel catatan-panel" id="catatanPanel">
      <div class="section-head">
        <div class="section-title title-catatan"> INFO CS BARU & RESIGN </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-self:end;">
          <button id="addCatatanBtn" class="btn-green">+ Tambah Catatan</button>
          <button id="exportCatatanBtn" class="btn-accent">Export (Copy)</button>
        </div>
      </div>

      <div class="catatan-container">
        <div class="catatan-form">
          <h3>MASUKAN NAMA STAFF</h3>
          <form id="catatanForm">
            <div class="form-row">
              <input type="text" id="catatanTitle" placeholder="Nama Staff" required>
              <select id="catatanCategory" required>
                <option value="">Pilih Kategori</option>
                <option value="DI BAWAH 3 BULAN">DI BAWAH 3 BULAN</option>
                <option value="DI ATAS 3 BULAN">DI ATAS 3 BULAN</option>
                <option value="DI BAWAH 6 BULAN">DI BAWAH 6 BULAN</option>
                <option value="DI ATAS 6 BULAN">DI ATAS 6 BULAN</option>
                <option value="RESIGN">RESIGN</option>
              </select>
            </div>
            <div class="form-row">
              <textarea id="catatanContent" placeholder="Isi catatan di sini..." required></textarea>
            </div>
            <button type="submit" class="btn btn-green" style="margin-top:10px;">
              <i class="fas fa-plus"></i> Simpan Catatan
            </button>
          </form>
        </div>

        <div class="catatan-list" id="catatanList"></div>
      </div>
    </section>
  </div>

  <!-- MODAL OFFDAY/BAGAN -->
  <div class="modal-backdrop" id="backdrop">
    <div class="modal">
      <div>
        <h3 id="modalTitle">Isi Jadwal</h3>
        <div class="sub" id="modalSub">Maksimal 10 orang</div>

        <div style="margin:8px 0 10px;">
          <label style="font-size:12px; font-weight:900; letter-spacing:.3px; opacity:.9;">
            Jenis Jadwal
          </label>
          <div class="select-wrap" style="margin-top:6px;">
            <select id="typeSelect" class="role-select" style="font-size:13px;">
              <option value="OFF">OFFDAY</option>
              <option value="BAGAN">BAGAN</option>
            </select>
            <span class="chev"></span>
          </div>
        </div>

        <div class="names-grid" id="modalNames"></div>
      </div>

      <div class="copy-panel">
        <h4>Kolom Copy Nama</h4>
        <p>List otomatis (nama saja). Blok manual atau klik Copy.</p>
        <textarea id="copyBox" readonly placeholder="Belum ada nama..."></textarea>
        <button id="copyBtn" class="btn-accent">Copy</button>
      </div>

      <div class="modal-actions">
        <div class="left-actions">
          <button id="toggleBlock" class="btn-danger">BLOCK TANGGAL</button>
          <button id="deleteOff" class="btn-danger">Hapus Jadwal</button>
        </div>
        <div class="right-actions">
          <button id="cancel">Batal</button>
          <button id="save" class="btn-green">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL CUTI -->
  <div class="modal-backdrop" id="cutiBackdrop">
    <div class="modal" style="grid-template-columns:1fr;">
      <div>
        <h3 id="cutiModalTitle">Tambah CUTI</h3>
        <div class="sub">Isi data cuti staff</div>

        <div class="cuti-form">
          <div class="full">
            <label>Nama Staff</label>
            <input id="cutiName" placeholder="Nama staff..." />
          </div>
          <div>
            <label>Tanggal Cuti</label>
            <input id="cutiStart" type="date" />
          </div>
          <div>
            <label>Selesai Cuti</label>
            <input id="cutiEnd" type="date" />
          </div>
          <div class="full">
            <label>Info / Keterangan</label>
            <textarea id="cutiInfo" placeholder="Contoh: Cuti tahunan / urusan keluarga / dll"></textarea>
          </div>
        </div>

        <div class="modal-actions">
          <div class="left-actions">
            <button id="cutiDeleteBtn" class="btn-danger" style="display:none;">Hapus CUTI</button>
          </div>
          <div class="right-actions">
            <button id="cutiCancelBtn">Batal</button>
            <button id="cutiSaveBtn" class="btn-green">Simpan</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL PASSWORD RESET -->
  <div class="modal-backdrop password-modal" id="passwordBackdrop">
    <div class="modal">
      <div>
        <h3 id="passwordModalTitle">Verifikasi Password</h3>
        <div class="sub" id="passwordModalSub">Masukkan password untuk melanjutkan</div>

        <input type="password" id="passwordInput" class="password-input" placeholder="Masukkan password..." autocomplete="off" />

        <div class="modal-actions">
          <div class="right-actions">
            <button id="passwordCancelBtn">Batal</button>
            <button id="passwordConfirmBtn" class="btn-green">Verifikasi</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD0gaCXH6ny4EwLwhJhUVAZzS5x1nLjs-s",
    authDomain: "dedy-b7d09.firebaseapp.com",
    databaseURL: "https://dedy-b7d09-default-rtdb.firebaseio.com",
    projectId: "dedy-b7d09",
    storageBucket: "dedy-b7d09.appspot.com",
    messagingSenderId: "908979972372",
    appId: "1:908979972372:web:93ebb4eb1bf20ab8f42f0a1"
  };
  firebase.initializeApp(firebaseConfig);
</script>

<script>
(() => {
  const $ = q => document.querySelector(q);

  // =========================
  //  GLOBAL FIREBASE SYNC
  // =========================
  const GLOBAL_ROOM_ID = "mwtt-main";

  const clientIdKey = "mwtt-client-id";
  const clientId = localStorage.getItem(clientIdKey) || ("c_" + Math.random().toString(16).slice(2));
  localStorage.setItem(clientIdKey, clientId);

  const dbRef = firebase.database().ref("offday/" + GLOBAL_ROOM_ID);

  let isApplyingRemote = false;
  let lastRemoteUpdatedAt = 0;
  let pushTimer = null;

  function schedulePush() {
    if (isApplyingRemote) return;
    clearTimeout(pushTimer);
    pushTimer = setTimeout(pushNow, 300);
  }

  function pushNow() {
    if (isApplyingRemote) return;
    const payload = {
      updatedAt: Date.now(),
      updatedBy: clientId,
      calendar: store,
      cuti: cutiStore,
      bagan: { meta: baganMeta, seats: baganStore },
      barisKolomExcel: barisKolomExcelData,
      namaDatabase: namaDatabaseStore,
      piket: piketStore,
      csMawaroto: csStore,
      catatan: catatanStore,
      lock: { isLocked }
    };
    dbRef.set(payload).catch(err => console.error("GLOBAL SAVE ERR:", err));
  }

  function applyRemote(payload) {
    if (!payload) return;
    const u = Number(payload.updatedAt || 0);
    if (u && u <= lastRemoteUpdatedAt) return;

    isApplyingRemote = true;
    try {
      lastRemoteUpdatedAt = u || lastRemoteUpdatedAt;

      if (payload.calendar && typeof payload.calendar === "object") {
        Object.keys(store).forEach(k => delete store[k]);
        Object.assign(store, payload.calendar);
        saveStore();
      }

      if (Array.isArray(payload.cuti)) {
        cutiStore.splice(0, cutiStore.length, ...payload.cuti);
        saveCuti();
      }

      if (payload.bagan && typeof payload.bagan === "object") {
        if (payload.bagan.meta) baganMeta = payload.bagan.meta;
        if (Array.isArray(payload.bagan.seats)) baganStore = payload.bagan.seats;
        saveBagan();
      }

      if (payload.barisKolomExcel) {
        barisKolomExcelData = payload.barisKolomExcel;
        saveBarisKolomExcel();
      }

      if (Array.isArray(payload.namaDatabase)) {
        namaDatabaseStore.splice(0, namaDatabaseStore.length, ...payload.namaDatabase);
        saveNamaDatabase();
      }

      if (payload.piket && typeof payload.piket === "object") {
        Object.keys(piketStore).forEach(k => delete piketStore[k]);
        Object.assign(piketStore, payload.piket);
        savePiket();
      }

      if (Array.isArray(payload.csMawaroto)) {
        csStore.splice(0, csStore.length, ...payload.csMawaroto);
        saveCS();
      }

      if (Array.isArray(payload.catatan)) {
        catatanStore.splice(0, catatanStore.length, ...payload.catatan);
        saveCatatan();
      }

      if (payload.lock && typeof payload.lock.isLocked === "boolean") {
        isLocked = payload.lock.isLocked;
        updateLockUI();
      }

      if (activeFilterType === "CUTI") renderCutiTable();
      else if (activeFilterType === "BAGAN_VIEW") { renderBagan(); updateDeleteSeatUI(); }
      else if (activeFilterType === "BARI_KOLOM") renderBarisKolomTable();
      else if (activeFilterType === "NAMA") { renderNamaDatabase(); updateNamaToBaganSelect(); }
      else if (activeFilterType === "PIKET") renderPiketTable();
      else if (activeFilterType === "CS_MAWAROTO") renderCSTable();
      else if (activeFilterType === "CATATAN") renderCatatanList();
      else renderCalendar();

    } finally {
      isApplyingRemote = false;
    }
  }

  function startRealtimeSync() {
    dbRef.on("value", snap => {
      const payload = snap.val();
      applyRemote(payload);
    }, err => {
      console.error("GLOBAL LOAD ERR:", err);
    });
  }

  // =========================
  //  FITUR UNDO/REDO (CTRL+Z) UNTUK KALENDER
  // =========================
  let undoStack = [];
  let redoStack = [];
  const MAX_UNDO_HISTORY = 20;

  function saveToUndoStack() {
    if (activeKey && store[activeKey]) {
      const snapshot = {
        key: activeKey,
        data: JSON.parse(JSON.stringify(store[activeKey]))
      };
      
      undoStack.push(snapshot);
      if (undoStack.length > MAX_UNDO_HISTORY) {
        undoStack.shift();
      }
      
      redoStack = [];
    }
  }

  function undo() {
    if (undoStack.length === 0) {
      toast("Tidak ada perubahan untuk di-undo");
      return;
    }
    
    const snapshot = undoStack.pop();
    const currentState = store[snapshot.key] ? JSON.parse(JSON.stringify(store[snapshot.key])) : null;
    
    if (currentState) {
      redoStack.push({
        key: snapshot.key,
        data: currentState
      });
    }
    
    store[snapshot.key] = snapshot.data;
    saveStore();
    
    if (activeKey === snapshot.key && $("#backdrop").style.display === "grid") {
      const date = new Date(snapshot.key);
      openCalendarModal(snapshot.key, date);
    }
    
    renderCalendar();
    schedulePush();
    toast("Undo berhasil");
  }

  function redo() {
    if (redoStack.length === 0) {
      toast("Tidak ada perubahan untuk di-redo");
      return;
    }
    
    const snapshot = redoStack.pop();
    const currentState = store[snapshot.key] ? JSON.parse(JSON.stringify(store[snapshot.key])) : null;
    
    if (currentState) {
      undoStack.push({
        key: snapshot.key,
        data: currentState
      });
    }
    
    store[snapshot.key] = snapshot.data;
    saveStore();
    
    if (activeKey === snapshot.key && $("#backdrop").style.display === "grid") {
      const date = new Date(snapshot.key);
      openCalendarModal(snapshot.key, date);
    }
    
    renderCalendar();
    schedulePush();
    toast("Redo berhasil");
  }

  // =========================
  //  SISTEM UNDO/REDO UNTUK BAGAN
  // =========================
  let baganUndoStack = [];
  let baganRedoStack = [];
  const MAX_BAGAN_UNDO = 20;

  function saveBaganToUndoStack() {
    const snapshot = {
        meta: JSON.parse(JSON.stringify(baganMeta)),
        seats: JSON.parse(JSON.stringify(baganStore)),
        timestamp: Date.now(),
        action: "bagan_change"
    };
    
    baganUndoStack.push(snapshot);
    if (baganUndoStack.length > MAX_BAGAN_UNDO) {
        baganUndoStack.shift();
    }
    
    // Reset redo stack ketika ada perubahan baru
    baganRedoStack = [];
    
    updateUndoRedoButtons();
  }

  function undoBagan() {
    if (baganUndoStack.length === 0) {
      toast("Tidak ada perubahan bagan untuk di-undo");
      return;
    }
    
    // Simpan state saat ini ke redo stack
    const currentState = {
        meta: JSON.parse(JSON.stringify(baganMeta)),
        seats: JSON.parse(JSON.stringify(baganStore)),
        timestamp: Date.now(),
        action: "bagan_change"
    };
    baganRedoStack.push(currentState);
    
    // Ambil state sebelumnya dari undo stack
    const previousState = baganUndoStack.pop();
    baganMeta = previousState.meta;
    baganStore = previousState.seats;
    
    saveBagan();
    renderBagan();
    schedulePush();
    
    updateUndoRedoButtons();
    toast("Undo perubahan bagan berhasil");
  }

  function redoBagan() {
    if (baganRedoStack.length === 0) {
      toast("Tidak ada perubahan bagan untuk di-redo");
      return;
    }
    
    // Simpan state saat ini ke undo stack
    const currentState = {
        meta: JSON.parse(JSON.stringify(baganMeta)),
        seats: JSON.parse(JSON.stringify(baganStore)),
        timestamp: Date.now(),
        action: "bagan_change"
    };
    baganUndoStack.push(currentState);
    
    // Ambil state berikutnya dari redo stack
    const nextState = baganRedoStack.pop();
    baganMeta = nextState.meta;
    baganStore = nextState.seats;
    
    saveBagan();
    renderBagan();
    schedulePush();
    
    updateUndoRedoButtons();
    toast("Redo perubahan bagan berhasil");
  }

  function updateUndoRedoButtons() {
    const undoBtn = $("#undoBtn");
    const redoBtn = $("#redoBtn");
    
    if (undoBtn) {
      undoBtn.disabled = baganUndoStack.length === 0 && undoStack.length === 0;
    }
    
    if (redoBtn) {
      redoBtn.disabled = baganRedoStack.length === 0 && redoStack.length === 0;
    }
  }

  // Fungsi untuk menangani semua perubahan bagan yang bisa di-undo
  function handleBaganChange(action, callback) {
    if(isLocked) {
      toast("Terkunci. Hanya bos yang bisa edit bagan.");
      return;
    }
    
    // Simpan state sebelum perubahan
    saveBaganToUndoStack();
    
    // Eksekusi perubahan
    callback();
  }

  // APP ORIGINAL LOGIC
  const WEEKDAYS_ID = ["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU","MINGGU"];
  const MONTHS_ID = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];

  const ROLE_OPTIONS = [
    { value: "", label: "Pilih Divisi", color: "#202741" },
    { value: "FINANCE", label: "FINANCE", color: "#f7d88b" },
    { value: "DESIGN", label: "DESIGN", color: "#7a3a00" },
    { value: "LIVECHAT", label: "LIVECHAT", color: "#bfe3ff" },
    { value: "SPV_WD", label: "SPV WD", color: "#1f5a6b" },
    { value: "WORKER_WD", label: "WORKER WD", color: "#e5c9ff" },
    { value: "DEPOSIT", label: "DEPOSIT", color: "#8B5CF6" },
    { value: "BANKER", label: "BANKER", color: "#ebc480ff" },
    { value: "ADMIN", label: "ADMIN", color: "#FB923C" },
    { value: "WD PGA", label: "WD PGA", color: "#FB7185" },
    { value: "ASSIST LEAD UTAMA", label: "ASSIST LEAD UTAMA", color: "#9F1239" },
    { value: "QRIS", label: "QRIS", color: "#C4B5FD" },
    { value: "LEADER WD", label: "LEADER WD", color: "#22D3EE" },
    { value: "LEADER DEPOSIT", label: "LEADER DEPOSIT", color: "#FDE047" },
    { value: "WHATSAPP", label: "WHATSAPP", color: "#A3E635" },
    { value: "LEADER LIVE CHAT", label: "LEADER LIVE CHAT", color: "#CA8A04" },
    { value: "ASSIT LEADER WD", label: "ASSIT LEADER WD", color: "#003333" },
    { value: "TELEGRAM / SOSMED", label: "TELEGRAM / SOSMED", color: "#FF7F50" },
    { value: "RESULT", label: "RESULT", color: "#ff50c5ff" },
    { value: "LEADER FIN / BANKER", label: "LEADER FIN / BANKER", color: "#644e4eff" },
  ];
  const ROLE_COLOR_MAP = Object.fromEntries(ROLE_OPTIONS.map(o => [o.value, o.color]));

  const DIVISI_OPTIONS = [
    { value: "LIVE_CHAT", label: "LIVE CHAT", color: "#3498db" },
    { value: "WHATSAPP", label: "WHATSAPP", color: "#2ecc71" },
    { value: "DEPOSIT", label: "DEPOSIT", color: "#9b59b6" },
    { value: "DESIGN", label: "DESIGN", color: "#e74c3c" },
    { value: "FINANCE", label: "FINANCE", color: "#f1c40f" },
    { value: "BANKER", label: "BANKER", color: "#1abc9c" },
    { value: "HELPER", label: "HELPER", color: "#34495e" },
    { value: "ADMIN", label: "ADMIN", color: "#e67e22" },
    { value: "MAKETING", label: "MAKETING", color: "#d35400" },
    { value: "TELE_MARKETING", label: "TELE MARKETING", color: "#c0392b" },
    { value: "RESULT", label: "RESULT", color: "#7f8c8d" },
    { value: "REPORT_PHISING", label: "REPORT PHISING", color: "#16a085" },
    { value: "WD_PGA", label: "WD PGA", color: "#8e44ad" },
    { value: "WORKER_WD", label: "WORKER WD", color: "#1d3527ff" },
    { value: "=", label: "=", color: "#16c5e4ff" },
    { value: "SPV_WD", label: "SPV WD", color: "#92c5e7ff" },
    { value: "ASSIT LEADER UTAMA", label: "ASSIT LEADER UTAMA", color: "#01568fff" },
    { value: "MASTER", label: "MASTER", color: "#f39c12" },
    { value: "LEADER MALAM", label: "LEADER MALAM", color: "#c4fa01ff" },
    { value: "TELEGRAM / SOSMED", label: "TELEGRAM / SOSMED", color: "#89a789ff" },
    { value: "*", label: "*", color: "#ff008cff" },
    { value: "-", label: "-", color: "#6e4400ff" },
    { value: "QRIS", label: "QRIS", color: "#d35400" },
    { value: "LEADER_WD", label: "LEADER WD", color: "#5a7794ff" },
    { value: "ASSIT_LEADER_WD", label: "ASSIT LEADER WD", color: "#fbff00ff" },
    { value: "LEADER_DEPOSIT", label: "LEADER DEPOSIT", color: "#ff0000ff" },
    { value: "LEADER_LIVE_CHAT", label: "LEADER LIVE CHAT", color: "#923a3aff" },
    { value: "LEADER_UTAMA", label: "LEADER UTAMA", color: "#e74c3c" }
  ];

  const TYPE_OPTIONS = [
    { value:"OFF", label:"OFFDAY" },
    { value:"BAGAN", label:"BAGAN" }
  ];

  const EDIT_PASSWORD = "mawartoto12";
  const lockKey = "offday-lock-state";
  let isLocked = (localStorage.getItem(lockKey) ?? "true") === "true";

  let passwordCallback = null;
  let resetPanelName = "";

  const storeKey = "offday-v5";
  const store = JSON.parse(localStorage.getItem(storeKey) || "{}");
  const saveStore = () => localStorage.setItem(storeKey, JSON.stringify(store));

  const cutiKey = "cuti-v1";
  const cutiStore = JSON.parse(localStorage.getItem(cutiKey) || "[]");
  const saveCuti = () => localStorage.setItem(cutiKey, JSON.stringify(cutiStore));

  const baganKey = "bagan-v3";
  const baganMetaKey = "bagan-meta-v1";

  let baganMeta = JSON.parse(localStorage.getItem(baganMetaKey) || "null")
               || { rows: 10, cols: 20 };

  function BAGAN_ROWS(){ return baganMeta.rows; }
  function BAGAN_COLS(){ return baganMeta.cols; }
  function BAGAN_SIZE(){ return BAGAN_ROWS() * BAGAN_COLS(); }

  let baganStore = JSON.parse(localStorage.getItem(baganKey) || "null")
                 || Array.from({length:BAGAN_SIZE()}, ()=>({name:"", active:true, divisi: ""}));

  const saveBagan = () => {
    localStorage.setItem(baganKey, JSON.stringify(baganStore));
    localStorage.setItem(baganMetaKey, JSON.stringify(baganMeta));
  };

  function ensureBaganSize(){
    const sizeNeeded = BAGAN_SIZE();
    if(baganStore.length < sizeNeeded){
      baganStore.push(
        ...Array.from(
          {length:sizeNeeded-baganStore.length},
          ()=>({name:"", active:true, divisi: ""})
        )
      );
    }
    if(baganStore.length > sizeNeeded){
      baganStore = baganStore.slice(0, sizeNeeded);
    }

    baganStore.forEach(s=>{
      if(typeof s.active !== "boolean") s.active = true;
      if(typeof s.name !== "string") s.name = "";
      if(typeof s.divisi === "undefined") s.divisi = "";
    });
  }

  // Store untuk BARI-BARIS KOLOM EXCEL
  const barisKolomExcelKey = "baris-kolom-excel-v4";
  let barisKolomExcelData = JSON.parse(localStorage.getItem(barisKolomExcelKey) || "null") || {};
  
  function saveBarisKolomExcel() {
    localStorage.setItem(barisKolomExcelKey, JSON.stringify(barisKolomExcelData));
  }

  // Store untuk NAMA DATABASE
  const namaDatabaseKey = "nama-database-v1";
  const namaDatabaseDefault = [
    { name: "BUDI", divisi: "LIVECHAT" },
    { name: "SARI", divisi: "WHATSAPP" },
    { name: "AGUS", divisi: "DEPOSIT" },
    { name: "DEWI", divisi: "DESIGN" }
  ];
  
  let namaDatabaseStore = JSON.parse(localStorage.getItem(namaDatabaseKey) || "null") 
    || namaDatabaseDefault.slice();
  
  function saveNamaDatabase() {
    localStorage.setItem(namaDatabaseKey, JSON.stringify(namaDatabaseStore));
  }

  const piketKey = "piket-v1";
  const defaultPiket = {
    SENIN: Array(8).fill(""),
    SELASA: Array(8).fill(""),
    RABU: Array(8).fill(""),
    KAMIS: Array(8).fill(""),
    JUMAT: Array(8).fill(""),
    SABTU: Array(8).fill(""),
    MINGGU: Array(8).fill("")
  };
  const safeClone = obj => JSON.parse(JSON.stringify(obj));
  const piketStore = JSON.parse(localStorage.getItem(piketKey) || "null")
    || safeClone(defaultPiket);
  const savePiket = () => localStorage.setItem(piketKey, JSON.stringify(piketStore));

  const csKey = "cs-mawaroto-v1";
  const csDefault = [
    { name: "CS ANITA", job: "LIVECHAT" },
    { name: "CS RINA", job: "WHATSAPP" },
    { name: "CS DWI", job: "REPORT PHISING" }
  ];
  const csStore = JSON.parse(localStorage.getItem(csKey) || "null") || csDefault.slice();
  const saveCS = () => localStorage.setItem(csKey, JSON.stringify(csStore));

  const CS_JOB_OPTIONS = [
    { value:"", label:"Pilih Jobdesk", color:"#202741" },
    { value:"LIVECHAT", label:"LIVECHAT", color:"#bfe3ff" },
    { value:"WHATSAPP", label:"WHATSAPP", color:"#A3E635" },
    { value:"DEPOSIT", label:"DEPOSIT", color:"#8B5CF6" },
    { value:"WORKER WD", label:"WORKER WD", color:"#D8BFD8" },
    { value:"DESIGN", label:"DESIGN", color:"#f59e0b" },
    { value:"ADMIN", label:"ADMIN", color:"#FB923C" },
    { value:"BANKER", label:"BANKER", color:"#22c55e" },
    { value:"FINANCE", label:"FINANCE", color:"#f7d88b" },
    { value:"TELEMARKETING", label:"TELEMARKETING", color:"#fda085" },
    { value:"MARKETING", label:"MARKETING", color:"#ef4444" },
    { value:"LEADER DEPOSIT", label:"LEADER DEPOSIT", color:"#94a3b8" },
    { value:"TELEGRAM / SOSMED", label:"TELEGRAM / SOSMED", color:"#EE82EE" },
    { value:"REPORT PHISING", label:"REPORT PHISING", color:"#2563eb" },
    { value:"LEADER WD", label: "LEADER WD", color:"#b91c1c" },
    { value:"QRIS", label:"QRIS", color:"#C4B5FD" },
    { value:"SPV WD", label:"SPV WD", color:"#0f766e" },
    { value:"WD PGA", label:"WD PGA", color:"#22c55e" },
    { value:"LEADER LIVE CHAT", label:"LEADER LIVE CHAT", color:"#a16207" },
    { value:"ASSIT LEADER UTAMA", label:"ASSIT LEADER UTAMA", color:"#FBCFE8" },
    { value:"ASSIT LEADER WD", label:"ASSIT LEADER WD", color:"#E6E6FA" },
    { value:"RESULT", label:"RESULT", color:"#52525B" },
  ];

  const catatanKey = "catatan-v1";
  const catatanStore = JSON.parse(localStorage.getItem(catatanKey) || "[]");
  const saveCatatan = () => localStorage.setItem(catatanKey, JSON.stringify(catatanStore));

  let view = new Date();
  let activeKey = null;
  let activeFilterType = "ALL";
  let editingCutiIndex = null;
  let editingCatatanIndex = null;

  function toast(msg){
    const t=$("#toast");
    t.textContent=msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 1600);
  }

  async function copyToClipboard(text){
    const t = String(text||"");
    try{
      if(navigator.clipboard && window.isSecureContext){
        await navigator.clipboard.writeText(t);
        return true;
      }
    }catch(e){}
    try{
      const ta = document.createElement("textarea");
      ta.value = t;
      ta.setAttribute("readonly","");
      ta.style.position="fixed";
      ta.style.left="-9999px";
      ta.style.top="0";
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return !!ok;
    }catch(e){
      return false;
    }
  }

  function openPasswordModal(title, sub, callback, panelName = "") {
    resetPanelName = panelName;
    passwordCallback = callback;
    $("#passwordModalTitle").textContent = title;
    $("#passwordModalSub").textContent = sub;
    $("#passwordInput").value = "";
    $("#passwordBackdrop").style.display = "grid";
    setTimeout(() => $("#passwordInput").focus(), 100);
  }

  function closePasswordModal() {
    $("#passwordBackdrop").style.display = "none";
    passwordCallback = null;
    resetPanelName = "";
  }

  $("#passwordCancelBtn").onclick = closePasswordModal;
  $("#passwordConfirmBtn").onclick = () => {
    const input = $("#passwordInput").value.trim();
    if (!input) {
      toast("Password tidak boleh kosong");
      return;
    }

    if (input === EDIT_PASSWORD) {
      if (passwordCallback) {
        passwordCallback();
      }
      closePasswordModal();
    } else {
      toast("Password salah!");
      $("#passwordInput").value = "";
      $("#passwordInput").focus();
    }
  };

  $("#passwordInput").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      $("#passwordConfirmBtn").click();
    }
  });

  function updateLockUI(){
    const b=$("#lockBtn");
    b.textContent = isLocked ? " TERKUNCI" : " EDIT MODE";
    b.className = isLocked ? "btn-amber" : "btn-green";
    localStorage.setItem(lockKey, String(isLocked));
    
    const buttonsToHide = [
      "#addCutiBtn",
      "#addCatatanBtn",
      "#addCsBtn",
      "#addRowBtn",
      "#addColBtn",
      "#removeColBtn",
      "#toggleDeleteSeatBtn",
      "#bulkImport",
      "#addExcelRowBtn",
      "#addNamaBtn",
      "#resetBaganBtn"
    ];
    
    buttonsToHide.forEach(selector => {
      const btn = $(selector);
      if (btn) btn.style.display = isLocked ? "none" : "inline-block";
    });

    reRenderActivePanel();
  }

  function reRenderActivePanel() {
    if (activeFilterType === "CUTI") renderCutiTable();
    else if (activeFilterType === "BAGAN_VIEW") { renderBagan(); updateDeleteSeatUI(); }
    else if (activeFilterType === "BARI_KOLOM") renderBarisKolomTable();
    else if (activeFilterType === "NAMA") { renderNamaDatabase(); updateNamaToBaganSelect(); }
    else if (activeFilterType === "PIKET") renderPiketTable();
    else if (activeFilterType === "CS_MAWAROTO") renderCSTable();
    else if (activeFilterType === "CATATAN") renderCatatanList();
    else renderCalendar();
  }

  $("#lockBtn").onclick = () => {
    if (!isLocked) {
      isLocked = true;
      updateLockUI();
      schedulePush();
      toast("Mode terkunci");
    } else {
      openPasswordModal(
        "Buka Mode Edit",
        "Masukkan password untuk mengaktifkan mode edit",
        () => {
          isLocked = false;
          updateLockUI();
          schedulePush();
          toast("Edit mode aktif");
        }
      );
    }
  };

  function ymd(date){
    const y=date.getFullYear();
    const m=String(date.getMonth()+1).padStart(2,"0");
    const d=String(date.getDate()).padStart(2,"0");
    return y + "-" + m + "-" + d;
  }

  function getMonthData(date){
    const y=date.getFullYear(), m=date.getMonth();
    const first=new Date(y,m,1), last=new Date(y,m+1,0);
    const startDay=(first.getDay()+6)%7;
    return {y:y, m:m, startDay:startDay, daysInMonth:last.getDate()};
  }

  function ensureDay(key){
    store[key]=store[key]||{};
    if(store[key].off===true && !store[key].type) store[key].type="OFF";
    if(!store[key].type) store[key].type="OFF";

    if(!store[key].entries){
      const old = store[key].names || Array(10).fill("");
      store[key].entries = old.map(n=>({name:n||"",role:""}));
      delete store[key].names;
    }
    
    while(store[key].entries.length<10) store[key].entries.push({name:"",role:""});
    store[key].entries = store[key].entries.slice(0,10);

    store[key].blocked = store[key].blocked || false;
  }

  function isDark(hex){
    let c = (hex||"#000").replace("#","");
    if(c.length===3) c=c.split("").map(x=>x+x).join("");
    const r=parseInt(c.slice(0,2),16);
    const g=parseInt(c.slice(2,4),16);
    const b=parseInt(c.slice(4,6),16);
    const lum=0.299*r+0.587*g+0.114*b;
    return lum<140;
  }

  function renderWeekdays(){
    $("#weekdays").innerHTML = WEEKDAYS_ID.map(d=>"<div>"+d+"</div>").join("");
  }

  function buildCopyText(key){
    const entries=(store[key]?.entries||[])
      .map(e=>({name:(e.name||"").trim()}))
      .filter(e=>e.name);
    return entries.length? entries.map(e=>e.name).join("\n") : "";
  }

  function refreshCopyBox(){
    if(!activeKey) return;
    $("#copyBox").value = buildCopyText(activeKey);
  }

  function renderCalendar(){
    const grid=$("#grid");
    const md=getMonthData(view);
    const y=md.y, m=md.m, startDay=md.startDay, daysInMonth=md.daysInMonth;
    $("#monthLabel").textContent=MONTHS_ID[m]+" "+y;
    grid.innerHTML="";

    for(let i=0;i<startDay;i++){
      const blank=document.createElement("div");
      blank.className="day muted";
      grid.appendChild(blank);
    }

    const today=new Date();

    for(let d=1; d<=daysInMonth; d++){
      const date=new Date(y,m,d);
      const key=ymd(date);
      const dow=(date.getDay()+6)%7;
      const isWeekend=dow>=5;

      ensureDay(key);

      const isBlocked=store[key]?.blocked===true;
      const type=store[key]?.type||"OFF";

      const hideByFilter =
        activeFilterType !== "ALL" &&
        activeFilterType !== "CUTI" &&
        activeFilterType !== "BAGAN_VIEW" &&
        activeFilterType !== "BARI_KOLOM" &&
        activeFilterType !== "NAMA" &&
        activeFilterType !== "PIKET" &&
        activeFilterType !== "CS_MAWAROTO" &&
        activeFilterType !== "CATATAN" &&
        !isBlocked &&
        type !== activeFilterType;

      const cell=document.createElement("div");
      cell.className=
        "day"+
        (isWeekend?" weekend":"")+
        (isBlocked?" blocked":"")+
        (!isBlocked && type==="OFF"?" off":"")+
        (!isBlocked && type==="BAGAN"?" bagan":"")+
        (hideByFilter ? " muted":"")+
        (date.toDateString()===today.toDateString()?" today":"");
      cell.dataset.key=key;

      let miniHtml="";
      if(isBlocked){
        miniHtml=
          '<div class="names-mini">'+
            '<div class="line"><b>BLOCKED</b></div>'+
            '<div class="line empty">Tanggal ditutup</div>'+
          '</div>';
      } else{
        const entries=(store[key].entries||[])
          .map(e=>({name:(e.name||"").trim(),role:(e.role||"").trim()}))
          .filter(e=>e.name);

        const typeLabel=(TYPE_OPTIONS.find(t=>t.value===type)||{}).label||type;

        const totalEntries = entries.length;
        const displayedEntries = entries.slice(0, 8);
        const moreCount = totalEntries - 8;

        if(totalEntries===0){
          const emptyText = (type==="OFF") ? "Klik untuk isi (10 slot)" : (typeLabel + ": klik untuk isi");
          miniHtml=
            '<div class="names-mini">'+
              '<div class="line empty">'+emptyText+'</div>'+
            '</div>';
        } else{
          const lines=displayedEntries.map(e=>{
            const copyText=e.name;
            if(!e.role){
              return '<div class="line copy-line" data-copy="'+copyText+'">'+
                        '<span class="nm">'+e.name+'</span>'+
                      '</div>';
            }
            const color=ROLE_COLOR_MAP[e.role]||"#CBD5E1";
            const dark=isDark(color);
            const text=dark?"#F8FAFC":"#0B0F1D";
            return '<div class="line copy-line" data-copy="'+copyText+'">'+
                     '<span class="nm">'+e.name+'</span>'+
                     '<span class="role-pill" style="background:'+color+'; color:'+text+'; border-color:rgba(0,0,0,.15)">'+
                       e.role+
                     '</span>'+
                   '</div>';
          }).join("");

          let moreIndicator = "";
          if (moreCount > 0) {
            moreIndicator = '<div class="line" style="font-size:10px; color:#FFD700; background:rgba(90,0,0,0.3);">' +
              '<span>+' + moreCount + ' nama lagi</span>' +
              '</div>';
          }

          const showHeader = (type !== "OFF");
          const headerHtml = showHeader ? ('<div class="line"><b>'+typeLabel+'</b></div>') : "";

          miniHtml=
            '<div class="names-mini">'+
              headerHtml+
              lines+
              moreIndicator+
            '</div>';
        }
      }

      cell.innerHTML=
        '<div class="date-row">'+
          '<span>'+d+'</span>'+
          '<span class="badge">'+(isWeekend?"WEEKEND":"WORKDAY")+'</span>'+
        '</div>'+
        miniHtml+
        '<div class="dot"></div>';

      cell.querySelectorAll(".copy-line").forEach(line=>{
        line.addEventListener("click", async ev=>{
          ev.stopPropagation();
          const txt=line.dataset.copy||"";
          if(!txt) return;
          try{
            await navigator.clipboard.writeText(txt);
            toast("Tercopy: "+txt);
          }catch(e){ toast("Gagal auto copy, blok manual ya"); }
        });
      });

      cell.addEventListener("click", ()=>{
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
        activeKey=key; openCalendarModal(key,date);
      });

      grid.appendChild(cell);
    }
  }

  function openCalendarModal(key,date){
    saveToUndoStack();
    
    ensureDay(key);
    const type=store[key].type||"OFF";

    $("#modalTitle").textContent =
      "Jadwal: "+WEEKDAYS_ID[(date.getDay()+6)%7]+", "+date.getDate()+" "+MONTHS_ID[date.getMonth()]+" "+date.getFullYear();

    const isBlocked=store[key].blocked===true;
    $("#modalSub").innerHTML = isBlocked
      ? "Tanggal ini sedang diblok."
      : `<div style="margin-bottom: 8px;">Isi sampai 10 orang (boleh kosong).</div>
         <div class="slot-info">Slot tersedia: ${10 - (store[key].entries?.filter(e => e.name.trim()).length || 0)}/10</div>`;

    const typeSelect=$("#typeSelect");
    typeSelect.value=type;
    typeSelect.disabled=isBlocked;

    const wrap=$("#modalNames");
    wrap.innerHTML="";

    for (let i = 0; i < 10; i++) {
      const entry = store[key].entries[i] || { name: "", role: "" };
      
      const row=document.createElement("div");
      row.className="role-row";

      const input=document.createElement("input");
      input.placeholder="Nama "+(i+1);
      input.value=entry.name||"";
      input.dataset.i=i;
      input.disabled=isBlocked;

      const selectWrap=document.createElement("div");
      selectWrap.className="select-wrap";

      const select=document.createElement("select");
      select.className="role-select";
      select.dataset.i=i;
      select.disabled=isBlocked;

      ROLE_OPTIONS.forEach(opt=>{
        const o=document.createElement("option");
        o.value=opt.value; o.textContent=opt.label;
        o.setAttribute("data-color",opt.color);
        if(opt.value===entry.role) o.selected=true;
        select.appendChild(o);
      });

      const chev=document.createElement("span");
      chev.className="chev"; chev.textContent="";

      selectWrap.appendChild(select);
      selectWrap.appendChild(chev);
      row.appendChild(input); row.appendChild(selectWrap);
      wrap.appendChild(row);

      const applyColor=()=>{
        const opt=select.options[select.selectedIndex];
        const color=opt.getAttribute("data-color")||"#202741";
        select.style.background=color;
        const dark=isDark(color);
        select.style.color=dark?"#eef2ff":"#0b0f1d";
        chev.style.color=dark?"#eef2ff":"#0b0f1d";
      };

      input.addEventListener("input",()=>{
        store[key].entries[i].name=input.value;
        refreshCopyBox();
      });
      
      select.addEventListener("change",()=>{
        store[key].entries[i].role=select.value;
        applyColor(); refreshCopyBox();
      });
      
      applyColor();
    }

    typeSelect.onchange=()=>{
      store[key].type=typeSelect.value;
      store[key].off=true;
      saveStore(); refreshCopyBox(); renderCalendar();
      schedulePush();
    };

    refreshCopyBox();
    $("#backdrop").style.display="grid";
  }

  function closeCalendarModal(){
    $("#backdrop").style.display="none";
    activeKey=null;
  }
  $("#cancel").onclick=closeCalendarModal;

  $("#save").onclick=()=>{
    if(!activeKey) return;
    if(store[activeKey].blocked){
      saveStore(); closeCalendarModal(); renderCalendar();
      schedulePush();
      return;
    }

    const inputs=[...$("#modalNames").querySelectorAll("input")];
    const selects=[...$("#modalNames").querySelectorAll("select")];

    inputs.forEach(inp=>{
      const i=Number(inp.dataset.i); store[activeKey].entries[i].name=inp.value;
    });
    selects.forEach(sel=>{
      const i=Number(sel.dataset.i); store[activeKey].entries[i].role=sel.value;
    });

    store[activeKey].off=true;
    store[activeKey].type=store[activeKey].type||"OFF";
    saveStore(); closeCalendarModal(); renderCalendar();
    schedulePush();
  };

  $("#deleteOff").onclick=()=>{
    if(!activeKey) return;
    
    saveToUndoStack();
    
    store[activeKey].off=false;
    store[activeKey].type="OFF";
    store[activeKey].entries=Array.from({length:10},()=>({name:"",role:""}));
    if(!store[activeKey].blocked) delete store[activeKey];
    saveStore(); closeCalendarModal(); renderCalendar();
    schedulePush();
  };

  $("#toggleBlock").onclick=()=>{
    if(!activeKey) return;
    store[activeKey]=store[activeKey]||{};
    store[activeKey].blocked=!store[activeKey].blocked;
    if(store[activeKey].blocked){
      store[activeKey].off=false;
      store[activeKey].entries=Array.from({length:10},()=>({name:"",role:""}));
    } else {
      store[activeKey].type=store[activeKey].type||"OFF";
    }
    saveStore(); closeCalendarModal(); renderCalendar();
    schedulePush();
  };

  $("#copyBtn").onclick = async ()=>{
    const txt=$("#copyBox").value.trim();
    if(!txt){ toast("Belum ada nama"); return; }
    try{
      await navigator.clipboard.writeText(txt);
      toast("Tersalin ke clipboard");
    }catch(e){
      toast("Gagal auto copy, silakan copy manual");
      $("#copyBox").focus(); $("#copyBox").select();
    }
  };

  function fmtDateID(iso){
    if(!iso) return "-";
    const d=new Date(iso);
    return d.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"});
  }

  function renderCutiTable(){
    const body=$("#cutiTableBody");
    body.innerHTML="";

    if(cutiStore.length===0){
      body.innerHTML = '<tr><td colspan="4" style="padding:16px; opacity:.7;">Belum ada data cuti.</td></tr>';
      return;
    }

    cutiStore.forEach((row,idx)=>{
      const tr=document.createElement("tr");
      tr.innerHTML=
        '<td class="name">'+(row.name||"-")+'</td>'+
        '<td>'+fmtDateID(row.start)+'</td>'+
        '<td>'+fmtDateID(row.end)+'</td>'+
        '<td>'+
          '<button class="info-btn" data-idx="'+idx+'">Detail</button>'+
          (!isLocked? '<button class="del-btn" data-del="'+idx+'">Hapus</button>' : '')+
        '</td>';
      body.appendChild(tr);
    });

    body.querySelectorAll(".info-btn").forEach(btn=>{
      btn.onclick=()=>{
        const idx=Number(btn.dataset.idx);
        openCutiModal(idx);
      };
    });

    body.querySelectorAll(".del-btn").forEach(btn=>{
      btn.onclick=()=>{
        if(isLocked) return;
        const idx=Number(btn.dataset.del);
        if(confirm("Hapus data CUTI ini?")){
          cutiStore.splice(idx,1);
          saveCuti(); renderCutiTable();
          schedulePush();
          toast("Data CUTI dihapus");
        }
      };
    });
  }

  function openCutiModal(idx=null){
    if(idx===null && isLocked){
      toast("Terkunci. Tidak bisa tambah CUTI.");
      return;
    }
    editingCutiIndex = idx;
    $("#cutiModalTitle").textContent = idx===null ? "Tambah CUTI" : "Detail / Edit CUTI";
    $("#cutiDeleteBtn").style.display = (!isLocked && idx!==null) ? "inline-block" : "none";

    const data = idx===null ? {name:"",start:"",end:"",info:""} : cutiStore[idx];

    $("#cutiName").value = data.name||"";
    $("#cutiStart").value = data.start||"";
    $("#cutiEnd").value = data.end||"";
    $("#cutiInfo").value = data.info||"";

    ["cutiName","cutiStart","cutiEnd","cutiInfo","cutiSaveBtn"].forEach(id=>{
      $("#"+id).disabled = isLocked && idx!==null;
    });

    $("#cutiBackdrop").style.display="grid";
  }

  function closeCutiModal(){
    $("#cutiBackdrop").style.display="none";
    editingCutiIndex=null;
  }
  $("#cutiCancelBtn").onclick=closeCutiModal;
  $("#addCutiBtn").onclick=()=>openCutiModal(null);

  $("#cutiSaveBtn").onclick=()=>{
    if(isLocked) return;

    const data={
      name: $("#cutiName").value.trim(),
      start: $("#cutiStart").value,
      end: $("#cutiEnd").value,
      info: $("#cutiInfo").value.trim()
    };
    if(!data.name || !data.start || !data.end){
      toast("Nama & tanggal wajib diisi");
      return;
    }

    if(editingCutiIndex===null){
      cutiStore.push(data);
      toast("CUTI ditambahkan");
    } else {
      cutiStore[editingCutiIndex]=data;
      toast("CUTI diupdate");
    }

    saveCuti(); renderCutiTable(); closeCutiModal();
    schedulePush();
  };

  $("#cutiDeleteBtn").onclick=()=>{
    if(isLocked || editingCutiIndex===null) return;
    if(confirm("Hapus data CUTI ini?")){
      cutiStore.splice(editingCutiIndex,1);
      saveCuti(); renderCutiTable(); closeCutiModal();
      schedulePush();
      toast("Data CUTI dihapus");
    }
  };

  $("#exportCutiBtn").onclick=async ()=>{
    const txt = cutiStore.map((r,i)=>(
      (i+1)+". "+r.name+"\n   "+fmtDateID(r.start)+"  "+fmtDateID(r.end)+"\n   "+(r.info||"-")
    )).join("\n\n");
    try{
      await navigator.clipboard.writeText(txt||"Belum ada data cuti");
      toast("Data CUTI dicopy");
    }catch(e){
      toast("Gagal copy, blok manual");
      alert(txt);
    }
  };

  function seatLabel(i){ return String(i + 1); }

  let deleteSeatMode = false;
  function updateDeleteSeatUI(){
    const b = $("#toggleDeleteSeatBtn");
    b.textContent = deleteSeatMode ? " MODE HAPUS: ON" : " MODE HAPUS: OFF";
    b.className = deleteSeatMode ? "btn-danger" : "btn-amber";
  }

  $("#toggleDeleteSeatBtn").onclick = () => {
    if(isLocked){ toast("Terkunci. Tidak bisa hapus seat."); return; }
    deleteSeatMode = !deleteSeatMode;
    updateDeleteSeatUI();
    toast(deleteSeatMode ? "Klik seat untuk hapus (kotak hilang)" : "Mode hapus dimatikan");
  };

  function adjustColor(hex, percent) {
    const num = parseInt(hex.replace("#", ""), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    
    return "#" + (
      0x1000000 +
      (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
      (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
      (B < 255 ? B < 1 ? 0 : B : 255)
    ).toString(16).slice(1);
  }

  function getDivisiLabel(value) {
    const divisi = DIVISI_OPTIONS.find(d => d.value === value) || 
                   DIVISI_OPTIONS.find(d => d.label === value);
    return divisi ? divisi.label : value;
  }

  function renderBagan(){
    ensureBaganSize();

    const board=$("#baganBoard");
    const cols = BAGAN_COLS();
    board.style.gridTemplateColumns = "repeat("+cols+", 100px)";
    board.innerHTML="";

    baganStore.forEach((seat,i)=>{
      const div=document.createElement("div");
      const isActive = seat.active !== false;
      
      const divisiInfo = DIVISI_OPTIONS.find(d => d.value === seat.divisi) || 
                        DIVISI_OPTIONS.find(d => d.label === seat.divisi);
      const divisiColor = divisiInfo ? divisiInfo.color : "#34495e";
      const textColor = isDark(divisiColor) ? "#ffffff" : "#000000";

      div.className =
        "seat" +
        (!isActive ? " hidden" : (!seat.name ? " empty" : ""));

      div.draggable = !isLocked && isActive;
      div.dataset.i=i;

      if (isActive && seat.name && seat.divisi) {
        div.style.background = `linear-gradient(135deg, ${divisiColor} 0%, ${adjustColor(divisiColor, -20)} 100%)`;
        div.style.color = textColor;
        div.style.border = `2px solid ${adjustColor(divisiColor, 30)}`;
        div.style.boxShadow = `0 4px 15px ${divisiColor}40`;
      } else if (isActive && seat.name) {
        div.style.background = "linear-gradient(135deg, #2c3e50 0%, #34495e 100%)";
        div.style.color = "#ffffff";
      } else if (isActive) {
        div.style.background = "linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%)";
        div.style.color = "#ecf0f1";
      }

      if (isActive) {
        if (seat.name) {
          div.innerHTML = `
            <small>${seatLabel(i)}</small>
            <div style="font-weight: 900; font-size: 11px; margin-top: 3px; overflow: hidden; text-overflow: ellipsis;">
              ${seat.name}
            </div>
            ${seat.divisi ? `<div style="font-size: 9px; opacity: 0.9; margin-top: 2px; font-weight: 700;">${getDivisiLabel(seat.divisi)}</div>` : ''}
          `;
        } else {
          div.innerHTML = `<small>${seatLabel(i)}</small>-`;
        }
      }

      div.addEventListener("click", ()=>{
        if(isLocked){
          toast("Terkunci. Tidak bisa edit BAGAN.");
          return;
        }

        if(deleteSeatMode){
          if(!baganStore[i].active){
            toast("Seat "+seatLabel(i)+" sudah dihapus");
            return;
          }
          if(!confirm("Hapus seat "+seatLabel(i)+"? Kotak akan hilang.")) return;

          baganStore[i].name = "";
          baganStore[i].divisi = "";
          baganStore[i].active = false;
          saveBagan();
          renderBagan();
          schedulePush();
          toast("Seat "+seatLabel(i)+" dihapus");
          return;
        }

        openBaganSeatModal(i);
      });

      div.addEventListener("dragstart", e=>{
        div.classList.add("dragging");
        e.dataTransfer.setData("text/plain", String(i));
      });
      div.addEventListener("dragend", ()=>{
        div.classList.remove("dragging");
        board.querySelectorAll(".seat").forEach(s=>s.classList.remove("drop-target"));
      });
      div.addEventListener("dragover", e=>{
        if(isLocked || !isActive) return;
        e.preventDefault();
        div.classList.add("drop-target");
      });
      div.addEventListener("dragleave", ()=> div.classList.remove("drop-target"));
      div.addEventListener("drop", e=>{
        if(isLocked || !isActive) return;
        e.preventDefault();
        const from = Number(e.dataTransfer.getData("text/plain"));
        const to = i;
        if(from===to) return;
        const tmp = baganStore[from];
        baganStore[from]=baganStore[to];
        baganStore[to]=tmp;
        saveBagan(); renderBagan();
        schedulePush();
        toast("Swap seat "+seatLabel(from)+"  "+seatLabel(to));
      });

      board.appendChild(div);
    });
    
    // Update status tombol undo/redo
    updateUndoRedoButtons();
  }

  function openBaganSeatModal(index) {
    const seat = baganStore[index];
    
    const modalHTML = `
      <div class="modal-backdrop" id="baganSeatModal">
        <div class="modal" style="grid-template-columns:1fr; max-width:500px;">
          <div>
            <h3>Edit Seat ${seatLabel(index)}</h3>
            <div class="sub">Isi nama dan pilih divisi</div>
            
            <div style="margin:15px 0;">
              <label style="display:block; margin-bottom:5px; font-weight:700; font-size:12px;">Nama Staff</label>
              <input type="text" id="baganSeatName" placeholder="Masukkan nama..." 
                     style="width:100%; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); background:rgba(255,255,255,0.05); color:#fff;"
                     value="${seat.name || ''}">
            </div>
            
            <div style="margin:15px 0;">
              <label style="display:block; margin-bottom:5px; font-weight:700; font-size:12px;">Divisi</label>
              <div class="select-wrap" style="margin-top:6px;">
                <select id="baganSeatDivisi" class="role-select" style="width:100%;">
                  <option value="">Pilih Divisi</option>
                  ${DIVISI_OPTIONS.map(div => `
                    <option value="${div.value}" ${(seat.divisi === div.value || seat.divisi === div.label) ? 'selected' : ''}
                            style="background:${div.color}; color:${isDark(div.color) ? '#fff' : '#000'}">
                      ${div.label}
                    </option>
                  `).join('')}
                </select>
                <span class="chev"></span>
              </div>
            </div>
            
            <div class="modal-actions">
              <div class="right-actions">
                <button id="baganSeatCancel" class="btn-danger">Batal</button>
                <button id="baganSeatSave" class="btn-green">Simpan</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    
    const modalContainer = document.createElement('div');
    modalContainer.innerHTML = modalHTML;
    document.body.appendChild(modalContainer);
    
    const modal = document.getElementById('baganSeatModal');
    modal.style.display = 'grid';
    
    document.getElementById('baganSeatCancel').onclick = () => {
      modal.remove();
    };
    
    document.getElementById('baganSeatSave').onclick = () => {
      // Simpan state sebelum edit untuk undo
      saveBaganToUndoStack();
      
      const name = document.getElementById('baganSeatName').value.trim();
      const divisi = document.getElementById('baganSeatDivisi').value;
      
      baganStore[index].name = name;
      baganStore[index].divisi = divisi;
      baganStore[index].active = true;
      
      saveBagan();
      renderBagan();
      schedulePush();
      modal.remove();
      
      toast(`Seat ${seatLabel(index)} ${name ? 'diupdate' : 'dikosongkan'}`);
    };
    
    const select = document.getElementById('baganSeatDivisi');
    select.addEventListener('change', function() {
      const selectedOption = this.options[this.selectedIndex];
      if (selectedOption.value) {
        const color = DIVISI_OPTIONS.find(d => d.value === selectedOption.value)?.color || '#34495e';
        this.style.background = color;
        this.style.color = isDark(color) ? '#fff' : '#000';
      } else {
        this.style.background = '#202741';
        this.style.color = '#eef2ff';
      }
    });
    
    select.dispatchEvent(new Event('change'));
  }

  // ===== FUNGSI RESET BAGAN =====
  function resetBagan() {
      if(isLocked){ 
          toast("Terkunci. Hanya bos yang bisa reset bagan."); 
          return; 
      }
      
      if(!confirm("Reset seluruh bagan ke default?\n\nSemua nama akan dihapus, bagan dikembalikan ke 10 baris x 20 kolom.\n\nAksi ini TIDAK BISA di-undo!")){
          return;
      }
      
      baganMeta = { rows: 10, cols: 20 };
      baganStore = Array.from({length: 200}, ()=>({name:"", active:true, divisi: ""}));
      saveBagan();
      renderBagan();
      schedulePush();
      toast("Bagan direset ke default (10 baris x 20 kolom)");
  }

  // Event listener untuk tombol reset
  $("#resetBaganBtn").onclick = resetBagan;

  // Update fungsi addRowBtn untuk menggunakan sistem undo
  $("#addRowBtn").onclick = () => {
    handleBaganChange("add_row", () => {
      baganMeta.rows += 1;
      ensureBaganSize();
      saveBagan();
      renderBagan();
      schedulePush();
      toast("Baris ditambah. Total: " + baganMeta.rows);
    });
  };

  // Update fungsi addColBtn untuk menggunakan sistem undo
  $("#addColBtn").onclick = () => {
    handleBaganChange("add_col", () => {
      baganMeta.cols += 1;
      ensureBaganSize();
      saveBagan();
      renderBagan();
      schedulePush();
      toast("Kolom ditambah. Total: " + baganMeta.cols);
    });
  };

  // Update fungsi removeColBtn untuk menggunakan sistem undo
  $("#removeColBtn").onclick = () => {
    handleBaganChange("remove_col", () => {
      const cols = baganMeta.cols;
      const rows = baganMeta.rows;
      if (cols <= 1) { 
        toast("Kolom minimal 1"); 
        return; 
      }

      const input = prompt(
        "Mau hapus kolom ke berapa?\n\nTotal kolom sekarang: " + cols + "\nIsi angka 1 - " + cols,
        String(cols)
      );
      if (input === null) return;

      const colToRemove = Number(input);
      if (!Number.isInteger(colToRemove) || colToRemove < 1 || colToRemove > cols) {
        toast("Nomor kolom tidak valid");
        return;
      }

      if (!confirm("Yakin hapus kolom ke-" + colToRemove + "?\nSemua nama di kolom ini akan hilang.")) return;

      const oldCols = cols;
      const removeIndexInRow = colToRemove - 1;

      // Simpan kolom yang dihapus untuk informasi undo
      const deletedColumn = [];
      for (let r = 0; r < rows; r++) {
        const idx = r * oldCols + removeIndexInRow;
        if (idx < baganStore.length) {
          deletedColumn.push({
            row: r,
            col: colToRemove,
            seat: JSON.parse(JSON.stringify(baganStore[idx]))
          });
        }
      }

      // Hapus kolom
      for (let r = rows - 1; r >= 0; r--) {
        const idx = r * oldCols + removeIndexInRow;
        baganStore.splice(idx, 1);
      }

      baganMeta.cols -= 1;
      ensureBaganSize();
      saveBagan();
      renderBagan();
      schedulePush();
      toast("Kolom ke-" + colToRemove + " dihapus. Total kolom: " + baganMeta.cols);
    });
  };

  // Update fungsi exportBaganBtn
  $("#exportBaganBtn").onclick=async ()=>{
    const lines = baganStore.map((s,i)=>{
      const seatNum = seatLabel(i);
      const name = s.name || "-";
      const divisi = s.divisi ? ` (${getDivisiLabel(s.divisi)})` : "";
      const status = s.active === false ? " [DELETED]" : "";
      return `${seatNum}: ${name}${divisi}${status}`;
    });
    
    const txt = lines.join("\n");
    try{
      await navigator.clipboard.writeText(txt);
      toast("BAGAN dicopy");
    }catch(e){
      prompt("Copy manual (CTRL+C):", txt);
      toast("Gagal auto copy, copy manual");
    }
  };

  // =========================
  // FUNGSI BARI-BARIS KOLOM EXCEL
  // =========================
  function renderBarisKolomTable() {
    const container = $("#barisKolomTableContainer");
    if (!container) return;
    
    const kolomNames = ["LIVE CHAT", "WHATSAPP", "DEPOSIT", "FINANCE", "WHITDRAW", "DESIGN"];
    
    let html = `
        <table class="baris-kolom-excel-table">
            <thead>
                <tr>
                    <th>NO</th>
    `;
    
    for (let i = 0; i < 6; i++) {
        html += `
            <th>
                <div class="kolom-header">
                    <span class="kolom-title">${kolomNames[i]}</span>
                    <button class="copy-kolom-excel-btn" data-kolom="${i}">COPY</button>
                </div>
            </th>
        `;
    }
    
    html += `</tr></thead><tbody>`;
    
    for (let row = 0; row < 31; row++) {
        html += `<tr>`;
        html += `<td>${row+1}</td>`;
        
        for (let col = 0; col < 6; col++) {
            const data = barisKolomExcelData[row]?.[col] || { 
                nama1: "", 
                nama2: "", 
                nama3: "", 
                nama4: "",
                tanggal: ""
            };
            
            html += `
                <td>
                    <div class="excel-input-group">
                        <input type="text" class="excel-nama-input" data-row="${row}" data-col="${col}" data-type="nama1" 
                               value="${data.nama1}" placeholder="Nama 1">
                        <input type="text" class="excel-nama-input" data-row="${row}" data-col="${col}" data-type="nama2" 
                               value="${data.nama2}" placeholder="Nama 2">
                        <input type="text" class="excel-nama-input" data-row="${row}" data-col="${col}" data-type="nama3" 
                               value="${data.nama3}" placeholder="Nama 3">
                        <input type="text" class="excel-nama-input" data-row="${row}" data-col="${col}" data-type="nama4" 
                               value="${data.nama4}" placeholder="Nama 4">
                        
                        <div class="excel-date-container">
                            <input type="date" class="excel-date-input" data-row="${row}" data-col="${col}" data-type="tanggal" 
                                   value="${data.tanggal}">
                        </div>
                    </div>
                </td>
            `;
        }
        
        html += `</tr>`;
    }
    
    html += `</tbody></table>`;
    
    container.innerHTML = html;
    
    container.querySelectorAll(".excel-nama-input").forEach(input => {
        input.addEventListener("input", (e) => {
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            const type = e.target.dataset.type;
            
            if (!barisKolomExcelData[row]) barisKolomExcelData[row] = [];
            if (!barisKolomExcelData[row][col]) {
                barisKolomExcelData[row][col] = { 
                    nama1: "", 
                    nama2: "", 
                    nama3: "", 
                    nama4: "", 
                    tanggal: "" 
                };
            }
            
            barisKolomExcelData[row][col][type] = e.target.value;
            
            saveBarisKolomExcel();
            schedulePush();
        });
    });
    
    container.querySelectorAll(".excel-date-input").forEach(input => {
        input.addEventListener("change", (e) => {
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            const type = e.target.dataset.type;
            
            if (!barisKolomExcelData[row]) barisKolomExcelData[row] = [];
            if (!barisKolomExcelData[row][col]) {
                barisKolomExcelData[row][col] = { 
                    nama1: "", 
                    nama2: "", 
                    nama3: "", 
                    nama4: "", 
                    tanggal: "" 
                };
            }
            
            barisKolomExcelData[row][col][type] = e.target.value;
            
            saveBarisKolomExcel();
            schedulePush();
        });
    });
    
    container.querySelectorAll(".copy-kolom-excel-btn").forEach(btn => {
        btn.addEventListener("click", async (e) => {
            const kolom = parseInt(e.target.dataset.kolom);
            let allNames = [];
            
            for (let row = 0; row < 31; row++) {
                const cell = barisKolomExcelData[row]?.[kolom] || { 
                    nama1: "", 
                    nama2: "", 
                    nama3: "", 
                    nama4: "" 
                };
                
                const cellNames = [
                    cell.nama1?.trim(),
                    cell.nama2?.trim(),
                    cell.nama3?.trim(),
                    cell.nama4?.trim()
                ].filter(n => n && n !== "");
                
                if (cellNames.length > 0) {
                    allNames.push(cellNames.join(", "));
                }
            }
            
            const text = allNames.join("\n");
            if (!text) {
                toast("Kolom ini kosong");
                return;
            }
            
            try {
                await navigator.clipboard.writeText(text);
                toast(`Kolom ${kolomNames[kolom]} dicopy: ${allNames.length} baris`);
            } catch (err) {
                prompt("Copy manual (Ctrl+C):", text);
                toast("Gagal auto copy, copy manual");
            }
        });
    });
  }

  // =========================
  // FUNGSI NAMA DATABASE
  // =========================
  function renderNamaDatabase() {
    const container = $("#namaDatabaseList");
    if (!container) return;
    
    container.innerHTML = "";
    
    if (namaDatabaseStore.length === 0) {
      container.innerHTML = '<div class="nama-empty">Belum ada staff dalam database</div>';
      return;
    }
    
    namaDatabaseStore.forEach((staff, idx) => {
      const item = document.createElement("div");
      item.className = "nama-item";
      
      item.innerHTML = `
        <div class="nama-item-info">
          <div class="nama-item-name">${staff.name}</div>
          <div class="nama-item-divisi">${staff.divisi || "-"}</div>
        </div>
        <div class="nama-item-actions">
          ${!isLocked ? `<button class="nama-item-btn edit" data-index="${idx}">Edit</button>` : ''}
          ${!isLocked ? `<button class="nama-item-btn delete" data-index="${idx}">Hapus</button>` : ''}
        </div>
      `;
      
      container.appendChild(item);
    });
    
    container.querySelectorAll(".nama-item-btn.edit").forEach(btn => {
      btn.addEventListener("click", (e) => {
        if (isLocked) { toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const idx = parseInt(e.target.dataset.index);
        editNamaStaff(idx);
      });
    });
    
    container.querySelectorAll(".nama-item-btn.delete").forEach(btn => {
      btn.addEventListener("click", (e) => {
        if (isLocked) { toast("Terkunci. Hanya bos yang bisa hapus."); return; }
        const idx = parseInt(e.target.dataset.index);
        deleteNamaStaff(idx);
      });
    });
  }

  function updateNamaToBaganSelect() {
    const select = $("#namaToBaganSelect");
    if (!select) return;
    
    const selectedValue = select.value;
    
    select.innerHTML = '<option value="">Pilih Staff</option>';
    
    namaDatabaseStore.forEach((staff, idx) => {
      const option = document.createElement("option");
      option.value = idx;
      option.textContent = `${staff.name} (${staff.divisi || "-"})`;
      select.appendChild(option);
    });
    
    if (selectedValue && selectedValue !== "") {
      select.value = selectedValue;
    }
  }

  function addNamaStaff() {
    if (isLocked) { toast("Terkunci. Hanya bos yang bisa tambah staff."); return; }
    
    const nameInput = $("#namaInput");
    const divisiSelect = $("#divisiSelect");
    
    const name = nameInput.value.trim();
    const divisi = divisiSelect.value;
    
    if (!name) {
      toast("Nama staff tidak boleh kosong");
      return;
    }
    
    const existing = namaDatabaseStore.find(s => 
      s.name.toLowerCase() === name.toLowerCase()
    );
    
    if (existing) {
      toast("Nama staff sudah ada dalam database");
      return;
    }
    
    namaDatabaseStore.push({ name, divisi });
    saveNamaDatabase();
    renderNamaDatabase();
    updateNamaToBaganSelect();
    
    nameInput.value = "";
    divisiSelect.value = "";
    
    schedulePush();
    toast("Staff ditambahkan: " + name);
  }

  function editNamaStaff(idx) {
    if (isLocked) { return; }
    
    const staff = namaDatabaseStore[idx];
    const newName = prompt("Edit nama staff:", staff.name);
    
    if (newName === null) return;
    
    const trimmed = newName.trim();
    if (!trimmed) {
      toast("Nama staff tidak boleh kosong");
      return;
    }
    
    const existing = namaDatabaseStore.find((s, i) => 
      i !== idx && s.name.toLowerCase() === trimmed.toLowerCase()
    );
    
    if (existing) {
      toast("Nama staff sudah ada dalam database");
      return;
    }
    
    const newDivisi = prompt("Edit divisi staff:", staff.divisi || "");
    
    if (newDivisi === null) return;
    
    namaDatabaseStore[idx] = {
      name: trimmed,
      divisi: newDivisi.trim()
    };
    
    saveNamaDatabase();
    renderNamaDatabase();
    updateNamaToBaganSelect();
    schedulePush();
    toast("Staff diupdate: " + trimmed);
  }

  function deleteNamaStaff(idx) {
    if (isLocked) { return; }
    
    if (!confirm("Hapus staff dari database?")) return;
    
    const deleted = namaDatabaseStore.splice(idx, 1)[0];
    saveNamaDatabase();
    renderNamaDatabase();
    updateNamaToBaganSelect();
    schedulePush();
    toast("Staff dihapus: " + deleted.name);
  }

  function addToBagan() {
    if (isLocked) { toast("Terkunci. Hanya bos yang bisa tambah ke bagan."); return; }
    
    const select = $("#namaToBaganSelect");
    const idx = parseInt(select.value);
    
    if (isNaN(idx) || idx < 0 || idx >= namaDatabaseStore.length) {
      toast("Pilih staff terlebih dahulu");
      return;
    }
    
    const staff = namaDatabaseStore[idx];
    
    let emptySeatIndex = -1;
    for (let i = 0; i < baganStore.length; i++) {
      if (baganStore[i].active && !baganStore[i].name) {
        emptySeatIndex = i;
        break;
      }
    }
    
    if (emptySeatIndex === -1) {
      toast("Tidak ada seat kosong di bagan. Tambah baris/kolom terlebih dahulu.");
      return;
    }
    
    // Simpan state sebelum perubahan untuk undo
    saveBaganToUndoStack();
    
    baganStore[emptySeatIndex] = {
      name: staff.name,
      divisi: staff.divisi,
      active: true
    };
    
    saveBagan();
    renderBagan();
    schedulePush();
    toast(`${staff.name} ditambahkan ke seat ${seatLabel(emptySeatIndex)}`);
    
    select.value = "";
  }

  // =========================
  // SETUP EVENT LISTENERS UNTUK EXCEL DIVISI
  // =========================
  function setupExcelEvents() {
    $("#addExcelRowBtn").onclick = () => {
      if (isLocked) { 
        toast("Terkunci. Hanya bos yang bisa tambah baris."); 
        return; 
      }
      
      const count = prompt("Tambah berapa baris?", "5");
      if (!count || isNaN(count)) return;
      
      const numRows = parseInt(count);
      if (numRows <= 0) return;
      
      const currentRows = Object.keys(barisKolomExcelData).length;
      for (let row = currentRows; row < currentRows + numRows; row++) {
        if (!barisKolomExcelData[row]) {
          barisKolomExcelData[row] = [];
          for (let col = 0; col < 6; col++) {
            barisKolomExcelData[row][col] = { 
              nama1: "", 
              nama2: "", 
              nama3: "", 
              nama4: "", 
              tanggal: "" 
            };
          }
        }
      }
      
      saveBarisKolomExcel();
      renderBarisKolomTable();
      schedulePush();
      toast(`${numRows} baris ditambahkan`);
    };
    
    $("#exportExcelAllBtn").onclick = async () => {
      let allData = "DAFTAR NAMA DAN TANGGAL PER KOLOM (31 Baris):\n\n";
      const kolomNames = ["LIVE CHAT", "WHATSAPP", "DEPOSIT", "FINANCE", "WHITDRAW", "DESIGN"];
      
      for (let col = 0; col < 6; col++) {
        let kolomData = [];
        
        for (let row = 0; row < 31; row++) {
          const cell = barisKolomExcelData[row]?.[col] || { 
            nama1: "", 
            nama2: "", 
            nama3: "", 
            nama4: "", 
            tanggal: "" 
          };
          
          const names = [
            cell.nama1?.trim(),
            cell.nama2?.trim(),
            cell.nama3?.trim(),
            cell.nama4?.trim()
          ].filter(n => n && n !== "");
          
          const dateStr = cell.tanggal?.trim() || "";
          
          if (names.length > 0 || dateStr) {
            const nameStr = names.length > 0 ? names.join(", ") : "-";
            const rowStr = dateStr ? `${nameStr} | ${dateStr}` : nameStr;
            kolomData.push(`${row+1}. ${rowStr}`);
          }
        }
        
        allData += `${kolomNames[col]}:\n`;
        allData += kolomData.length > 0 ? kolomData.join("\n") : "- (kosong)";
        allData += "\n\n";
      }
      
      try {
        await navigator.clipboard.writeText(allData);
        toast("Semua data Excel dicopy (31 baris, 4 nama, 1 tanggal)");
      } catch(e) {
        prompt("Copy manual (Ctrl+C):", allData);
        toast("Gagal auto copy, copy manual");
      }
    };
  }

  function setupNamaEvents() {
    $("#addNamaBtn").onclick = addNamaStaff;
    $("#addToBaganBtn").onclick = addToBagan;
    
    $("#exportNamaBtn").onclick = async () => {
      const txt = namaDatabaseStore.map((s, i) => 
        `${i+1}. ${s.name} - ${s.divisi || "-"}`
      ).join("\n") || "Belum ada staff dalam database";
      
      try {
        await navigator.clipboard.writeText(txt);
        toast("Database staff dicopy");
      } catch(e) {
        alert(txt);
        toast("Gagal copy, blok manual");
      }
    };
  }

  // =========================
  // FUNGSI MIGRASI DATA DARI VERSI LAMA
  // =========================
  function migrateData() {
    const oldStoreKey = "offday-v4";
    const oldStore = JSON.parse(localStorage.getItem(oldStoreKey) || "null");
    if (oldStore && Object.keys(oldStore).length > 0) {
      for (let key in oldStore) {
        if (oldStore[key] && oldStore[key].entries && oldStore[key].entries.length === 8) {
          const oldEntries = oldStore[key].entries;
          const newEntries = [...oldEntries];
          while (newEntries.length < 10) {
            newEntries.push({ name: "", role: "" });
          }
          oldStore[key].entries = newEntries;
        }
      }
      Object.assign(store, oldStore);
      saveStore();
      localStorage.removeItem(oldStoreKey);
    }
  }

  function renderPiketTable(){
    const body = $("#piketTableBody");
    body.innerHTML = "";
    const days = ["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU","MINGGU"];

    days.forEach(day=>{
      const tr = document.createElement("tr");
      const names = piketStore[day] || Array(8).fill("");

      const wrap = document.createElement("div");
      names.forEach((nm,i)=>{
        const span = document.createElement("span");
        span.className = "piket-name " + ((nm||"").trim() ? "" : "empty");
        span.dataset.day = day;
        span.dataset.i = i;
        span.textContent = (nm||"").trim() || "";
        wrap.appendChild(span);
      });

      const tdDay = document.createElement("td");
      tdDay.className = "name";
      tdDay.style.fontWeight = "900";
      tdDay.textContent = day;

      const tdNames = document.createElement("td");
      tdNames.colSpan = 8;
      tdNames.appendChild(wrap);

      tr.appendChild(tdDay);
      tr.appendChild(tdNames);
      body.appendChild(tr);
    });

    body.querySelectorAll(".piket-name").forEach(el=>{
      el.onclick = ()=>{
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const day = el.dataset.day;
        const i = Number(el.dataset.i);
        const old = piketStore[day][i] || "";
        const nm = prompt("Nama piket " + day + " slot " + (i+1) + ":", old);
        if(nm===null) return;
        piketStore[day][i] = nm.trim();
        savePiket();
        renderPiketTable();
        schedulePush();
      };
    });
  }

  $("#exportPiketBtn").onclick = async ()=>{
    const days = ["SENIN","SELASA","RABU","KAMIS","JUMAT","SABTU","MINGGU"];
    let txt = "";
    days.forEach(d=>{
      const list = (piketStore[d]||[]).filter(n=>String(n).trim());
      txt += d + ":\n" + (list.length ? list.map(x=>"- "+x).join("\n") : "- (kosong)") + "\n\n";
    });

    try{
      await navigator.clipboard.writeText(txt);
      toast("PIKET dicopy");
    }catch(e){
      alert(txt);
      toast("Gagal copy, blok manual");
    }
  };

  function renderCSTable(){
    const body = $("#csTableBody");
    if(!body) return;
    body.innerHTML = "";

    if(csStore.length === 0){
      body.innerHTML = `<tr><td colspan="3" style="padding:16px; opacity:.7;">Belum ada data CS.</td></tr>`;
      return;
    }

    csStore.forEach((row, idx) => {
      const tr = document.createElement("tr");

      const tdName = document.createElement("td");
      tdName.className = "name";
      tdName.style.display = "flex";
      tdName.style.alignItems = "center";
      tdName.style.gap = "10px";

      const nameSpan = document.createElement("span");
      nameSpan.className = "cs-name-span";
      nameSpan.textContent = ((idx+1) + ". " + ((row.name||"-").trim() || "-"));
      nameSpan.style.cursor = "pointer";
      nameSpan.title = "Klik untuk copy nama";
      nameSpan.onclick = async (ev) => {
        ev.stopPropagation();
        const nm = (row.name || "").trim();
        if(!nm) { toast("Nama kosong"); return; }
        const ok = await copyToClipboard(nm);
        if(ok) toast("Tercopy: " + nm);
        else { prompt("Copy manual (CTRL+C):", nm); toast("Gagal auto copy, copy manual"); }
      };

      const editBtn = document.createElement("button");
      editBtn.textContent = "";
      editBtn.title = "Edit nama CS";
      editBtn.style.padding = "6px 10px";
      editBtn.style.borderRadius = "10px";
      editBtn.style.border = "1px solid rgba(255,255,255,.16)";
      editBtn.style.background = "rgba(255,255,255,.06)";
      editBtn.style.color = "#eef2ff";
      editBtn.style.cursor = "pointer";
      editBtn.onmouseenter = () => editBtn.style.background = "rgba(255,255,255,.10)";
      editBtn.onmouseleave = () => editBtn.style.background = "rgba(255,255,255,.06)";
      editBtn.onclick = (ev) => {
        ev.stopPropagation();
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const cur = (csStore[idx]?.name || "").trim();
        const nm = prompt("Edit nama CS:", cur);
        if(nm === null) return;
        const name = nm.trim();
        if(!name){ toast("Nama tidak boleh kosong"); return; }
        csStore[idx].name = name;
        saveCS();
        renderCSTable();
        schedulePush();
        toast("Nama CS diupdate");
      };

      tdName.appendChild(nameSpan);
      tdName.appendChild(editBtn);

      const tdJob = document.createElement("td");
      const wrap = document.createElement("div");
      wrap.className = "cs-job-wrap";

      const select = document.createElement("select");
      select.className = "cs-job-select";

      CS_JOB_OPTIONS.forEach(opt=>{
        const o = document.createElement("option");
        o.value = opt.value;
        o.textContent = opt.label;
        o.setAttribute("data-color", opt.color);
        if(opt.value === (row.job||"")) o.selected = true;
        select.appendChild(o);
      });

      const applyJobColor = () => {
        const opt = select.options[select.selectedIndex];
        const color = opt.getAttribute("data-color") || "#202741";
        select.style.background = color;
        const dark = isDark(color);
        select.style.color = dark ? "#eef2ff" : "#0b0f1d";
      };
      applyJobColor();

      select.onchange = () => {
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); renderCSTable(); return; }
        csStore[idx].job = select.value;
        saveCS();
        applyJobColor();
        schedulePush();
        toast("Jobdesk diubah");
      };

      wrap.appendChild(select);
      tdJob.appendChild(wrap);

      const tdAct = document.createElement("td");

      const offBtn = document.createElement("button");
      offBtn.className = "btn-green";
      offBtn.textContent = " OFFDAY";
      offBtn.style.marginRight = "6px";

      offBtn.onclick = () => {
        if(isLocked){
          toast("Terkunci. Hanya bos yang bisa edit.");
          return;
        }

        const tgl = prompt("Masukkan tanggal OFFDAY (YYYY-MM-DD):", ymd(new Date()));
        if(!tgl) return;

        ensureDay(tgl);

        if(store[tgl].blocked){
          toast("Tanggal diblokir");
          return;
        }

        const slot = store[tgl].entries.find(e => !(e.name||"").trim());
        if(!slot){
          toast("Slot OFFDAY penuh (maks 10)");
          return;
        }

        slot.name = row.name || "";
        slot.role = row.job || "";
        store[tgl].type = "OFF";
        store[tgl].off = true;

        saveStore();
        renderCalendar();
        schedulePush();
        toast((row.name||"CS") + " masuk OFFDAY " + tgl);
      };

      const del = document.createElement("button");
      del.className = "cs-del-btn";
      del.textContent = "HAPUS";
      del.onclick = () => {
        if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
        if(confirm("Hapus CS ini?")){
          csStore.splice(idx, 1);
          saveCS();
          renderCSTable();
          schedulePush();
          toast("CS dihapus");
        }
      };

      tdAct.appendChild(offBtn);
      tdAct.appendChild(del);

      tr.appendChild(tdName);
      tr.appendChild(tdJob);
      tr.appendChild(tdAct);
      body.appendChild(tr);
    });
  }

  $("#addCsBtn").onclick = () => {
    if(isLocked){ toast("Terkunci. Hanya bos yang bisa edit."); return; }
    const nm = prompt("Masukkan nama CS:", "");
    if(nm === null) return;
    const name = nm.trim();
    if(!name){ toast("Nama tidak boleh kosong"); return; }
    csStore.push({ name, job: "" });
    saveCS();
    renderCSTable();
    schedulePush();
    toast("CS ditambahkan");
  };

  $("#exportCsBtn").onclick = async () => {
    const txt = csStore.map((r,i)=>`${i+1}. ${r.name}  ${r.job || "-"}`).join("\n") || "Belum ada data CS";
    try{
      await navigator.clipboard.writeText(txt);
      toast("CS dicopy");
    }catch(e){
      alert(txt);
      toast("Gagal copy, blok manual");
    }
  };

  function renderCatatanList() {
    const container = $("#catatanList");
    if (!container) return;
    
    container.innerHTML = "";
    
    if (catatanStore.length === 0) {
      container.innerHTML = '<div class="empty-catatan">Belum ada catatan. Tambahkan catatan baru.</div>';
      return;
    }
    
    const sortedCatatan = [...catatanStore].sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
    
    sortedCatatan.forEach((catatan, idx) => {
      const item = document.createElement("div");
      item.className = "catatan-item";
      
      item.innerHTML = `
        <div class="catatan-header">
          <div class="catatan-title">${catatan.title || "Tanpa Judul"}</div>
          <div class="catatan-category" data-category="${catatan.category || ''}">${catatan.category || ""}</div>
        </div>
        <div class="catatan-content">${catatan.content || ""}</div>
        <div class="catatan-footer">
          <div class="catatan-date">${catatan.date || ""}</div>
          <div class="catatan-actions">
            ${!isLocked ? `<button class="catatan-btn edit" data-index="${idx}">Edit</button>` : ''}
            ${!isLocked ? `<button class="catatan-btn delete" data-index="${idx}">Hapus</button>` : ''}
          </div>
        </div>
      `;
      
      container.appendChild(item);
    });
    
    container.querySelectorAll(".catatan-btn.edit").forEach(btn => {
      btn.addEventListener("click", (e) => {
        if (isLocked) { toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const idx = parseInt(e.target.dataset.index);
        editCatatan(idx);
      });
    });
    
    container.querySelectorAll(".catatan-btn.delete").forEach(btn => {
      btn.addEventListener("click", (e) => {
        if (isLocked) { toast("Terkunci. Hanya bos yang bisa edit."); return; }
        const idx = parseInt(e.target.dataset.index);
        deleteCatatan(idx);
      });
    });
  }

  function editCatatan(idx) {
    if (idx < 0 || idx >= catatanStore.length) return;
    
    const catatan = catatanStore[idx];
    editingCatatanIndex = idx;
    
    $("#catatanTitle").value = catatan.title || "";
    $("#catatanCategory").value = catatan.category || "";
    $("#catatanContent").value = catatan.content || "";
    
    $("#catatanForm button[type='submit']").innerHTML = '<i class="fas fa-save"></i> Update Catatan';
  }

  function deleteCatatan(idx) {
    if (isLocked) { toast("Terkunci. Hanya bos yang bisa hapus."); return; }
    
    if (confirm("Hapus catatan ini?")) {
      catatanStore.splice(idx, 1);
      saveCatatan();
      renderCatatanList();
      schedulePush();
      toast("Catatan dihapus");
    }
  }

  function setupCatatanForm() {
    const form = $("#catatanForm");
    if (!form) return;
    
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      
      if (isLocked) {
        toast("Terkunci. Hanya bos yang bisa tambah catatan.");
        return;
      }
      
      const title = $("#catatanTitle").value.trim();
      const category = $("#catatanCategory").value;
      const content = $("#catatanContent").value.trim();
      
      if (!title || !category || !content) {
        toast("Harap isi semua field!");
        return;
      }
      
      const now = new Date();
      const dateStr = `${now.getDate()} ${MONTHS_ID[now.getMonth()]} ${now.getFullYear()}`;
      
      const newCatatan = {
        title,
        category,
        content,
        date: dateStr
      };
      
      if (editingCatatanIndex !== null) {
        catatanStore[editingCatatanIndex] = newCatatan;
        toast("Catatan diupdate");
      } else {
        catatanStore.push(newCatatan);
        toast("Catatan ditambahkan");
      }
      
      saveCatatan();
      renderCatatanList();
      schedulePush();
      
      form.reset();
      editingCatatanIndex = null;
      $("#catatanForm button[type='submit']").innerHTML = '<i class="fas fa-plus"></i> Simpan Catatan';
    });
  }

  $("#addCatatanBtn").onclick = () => {
    if (isLocked) {
      toast("Terkunci. Hanya bos yang bisa tambah catatan.");
      return;
    }
    
    $("#catatanForm").reset();
    editingCatatanIndex = null;
    $("#catatanForm button[type='submit']").innerHTML = '<i class="fas fa-plus"></i> Simpan Catatan';
    $("#catatanTitle").focus();
  };

  $("#exportCatatanBtn").onclick = async () => {
    if (catatanStore.length === 0) {
      toast("Belum ada catatan untuk diexport");
      return;
    }
    
    const txt = catatanStore.map((c, i) => 
      `${i+1}. ${c.title}\nKategori: ${c.category}\nTanggal: ${c.date}\n${c.content}\n`
    ).join("\n---\n\n");
    
    try {
      await navigator.clipboard.writeText(txt);
      toast("Catatan dicopy ke clipboard");
    } catch(e) {
      alert(txt);
      toast("Gagal copy, blok manual");
    }
  };

  function setActiveTab(type){
    activeFilterType = type;

    $("#topTabs").querySelectorAll(".tab-btn").forEach(b=>{
      b.classList.toggle("active", b.dataset.type===type);
    });

    const hideAll = () => {
      $("#calendarPanel").style.display="none";
      $("#cutiPanel").style.display="none";
      $("#baganPanel").style.display="none";
      $("#barisKolomPanel").style.display="none";
      $("#namaPanel").style.display="none";
      $("#piketPanel").style.display="none";
      $("#csPanel").style.display="none";
      $("#catatanPanel").style.display="none";
    };

    if(type==="CUTI"){
      hideAll();
      $("#cutiPanel").style.display="flex";
      renderCutiTable();
      toast("Mode: CUTI");
      return;
    }

    if(type==="BAGAN_VIEW"){
      hideAll();
      $("#baganPanel").style.display="flex";
      renderBagan();
      updateDeleteSeatUI();
      toast("Mode: BAGAN");
      return;
    }

    if(type==="BARI_KOLOM"){
      hideAll();
      $("#barisKolomPanel").style.display="flex";
      renderBarisKolomTable();
      toast("Mode: EXCEL DIVISI (31 Baris, 4 Nama, 1 Tanggal)");
      return;
    }

    if(type==="NAMA"){
      hideAll();
      $("#namaPanel").style.display="flex";
      renderNamaDatabase();
      updateNamaToBaganSelect();
      toast("Mode: DATABASE NAMA");
      return;
    }

    if(type==="PIKET"){
      hideAll();
      $("#piketPanel").style.display="flex";
      renderPiketTable();
      toast("Mode: PIKET");
      return;
    }

    if(type==="CS_MAWAROTO"){
      hideAll();
      $("#csPanel").style.display="flex";
      renderCSTable();
      toast("Menu: CS MAWAROTO");
      return;
    }

    if(type==="CATATAN"){
      hideAll();
      $("#catatanPanel").style.display="flex";
      renderCatatanList();
      toast("Menu: Catatan Awal Masuk Kerja");
      return;
    }

    $("#calendarPanel").style.display="flex";
    $("#cutiPanel").style.display="none";
    $("#baganPanel").style.display="none";
    $("#barisKolomPanel").style.display="none";
    $("#namaPanel").style.display="none";
    $("#piketPanel").style.display="none";
    $("#csPanel").style.display="none";
    $("#catatanPanel").style.display="none";
    renderCalendar();
    toast(type==="ALL" ? "Mode: ALL" : "Filter: "+type);
  }

  function initTopTabs(){
    $("#topTabs").querySelectorAll(".tab-btn").forEach(btn=>{
      btn.addEventListener("click", ()=> setActiveTab(btn.dataset.type));
    });
  }

  const prev=()=>{view.setMonth(view.getMonth()-1); renderCalendar();};
  const next=()=>{view.setMonth(view.getMonth()+1); renderCalendar();};
  $("#prev").onclick=$("#prevMini").onclick=prev;
  $("#next").onclick=$("#nextMini").onclick=next;
  $("#todayBtn").onclick=()=>{view=new Date(); renderCalendar();};
  $("#jumpYear").onclick=()=>{
    const y=prompt("Masukkan tahun (contoh 2026):", view.getFullYear());
    if(!y) return; view.setFullYear(Number(y)); renderCalendar();
  };

  // Fungsi untuk menghapus hanya data yang blocked di bulan ini
  $("#clearBlockedOnly").onclick=()=>{
    if(isLocked){ toast("Terkunci. Tidak bisa hapus."); return; }
    const md=getMonthData(view);
    const prefix = md.y+"-"+String(md.m+1).padStart(2,"0");
    let count = 0;
    Object.keys(store).forEach(k=>{ 
      if(k.startsWith(prefix) && store[k].blocked) {
        delete store[k];
        count++;
      }
    });
    saveStore(); renderCalendar();
    schedulePush();
    toast(count + " tanggal blocked dihapus");
  };

  function parseNamesFromPaste(text){
    return text.split(/\r?\n|\t|,|;/g).map(s=>s.trim()).filter(Boolean);
  }
  function shuffle(arr){
    const a=arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }
  function normalizeName(n){ return (n||"").trim().toLowerCase(); }

  function getCsJobForName(name){
    const key = normalizeName(name);
    const found = (csStore||[]).find(r => normalizeName(r.name) === key);
    return found ? (found.job || "") : "";
  }

  function bulkImportNames(){
    if(isLocked){ toast("Terkunci. Tidak bisa import."); return; }

    const pasted = prompt(
      "Paste nama dari Excel.\n\nMODE: PENCAR PERIODE\n- Periode 1: tgl 115\n- Periode 2: tgl 16akhir\nNama sama otomatis beda periode.\nRandom 1 nama per tanggal.\nSkip BLOCKED.\n\nNote: Sekarang tersedia 10 slot per tanggal.",
      ""
    );
    if(!pasted) return;

    let rawNames=parseNamesFromPaste(pasted);
    if(rawNames.length===0){ toast("Tidak ada nama terdeteksi"); return; }

    const md = getMonthData(view);
    const y = md.y, m = md.m, daysInMonth = md.daysInMonth;
    for (let d = 1; d <= daysInMonth; d++) {
        const key = ymd(new Date(y, m, d));
        if (store[key]) {
            saveToUndoStack();
            break;
        }
    }

    const toggleByName={}, namesP1=[], namesP2=[];
    for(const nm of rawNames){
      const key=normalizeName(nm);
      if(!(key in toggleByName)) toggleByName[key]=0;
      if(toggleByName[key]===0){ namesP1.push(nm); toggleByName[key]=1; }
      else { namesP2.push(nm); toggleByName[key]=0; }
    }

    const listP1=shuffle(namesP1), listP2=shuffle(namesP2);
    const md2=getMonthData(view);
    const y2=md2.y, m2=md2.m, daysInMonth2=md2.daysInMonth;

    let eligibleP1=[], eligibleP2=[];
    for(let d=1; d<=daysInMonth2; d++){
      const key=ymd(new Date(y2,m2,d));
      ensureDay(key);
      if(store[key]?.blocked) continue;
      (d<=15?eligibleP1:eligibleP2).push(key);
    }

    function fillPeriod(namesList, eligibleKeys){
      let idx=0, filled=0;
      while(idx<namesList.length){
        const roundKeys=shuffle(eligibleKeys);
        let any=false;
        for(const key of roundKeys){
          if(idx>=namesList.length) break;
          ensureDay(key);
          const slot=store[key].entries.find(e=>!(e.name||"").trim());
          if(slot){
            slot.name=namesList[idx];
            slot.role=getCsJobForName(namesList[idx]);
            store[key].type="OFF";
            store[key].off=true;
            idx++; filled++; any=true;
          }
        }
        if(!any) break;
      }
      return {filled:filled, remaining:namesList.length-idx};
    }

    const r1=fillPeriod(listP1, eligibleP1);
    const r2=fillPeriod(listP2, eligibleP2);
    saveStore(); renderCalendar();
    schedulePush();
    toast("P1 masuk "+r1.filled+" | P2 masuk "+r2.filled+" | 10 slot per tanggal");
  }
  $("#bulkImport").onclick=bulkImportNames;

  // ===== FITUR GESER KIRI-KANAN DENGAN SHIFT + MOUSE WHEEL =====
  let isShiftPressed = false;
  
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Shift') {
      isShiftPressed = true;
    }
  });

  document.addEventListener('keyup', (e) => {
    if (e.key === 'Shift') {
      isShiftPressed = false;
    }
  });

  document.addEventListener('wheel', (e) => {
    if (isShiftPressed) {
      e.preventDefault();
      
      const activePanels = [
        document.querySelector('.app'),
        document.querySelector('#grid'),
        document.querySelector('.bagan-wrap'),
        document.querySelector('.cuti-table-wrap'),
        document.querySelector('.cs-wrap'),
        document.querySelector('.catatan-container'),
        document.querySelector('.excel-table-container')
      ];
      
      activePanels.forEach(panel => {
        if (panel && panel.offsetParent !== null) {
          panel.scrollLeft += e.deltaY * 2;
        }
      });
      
      toast(` Geser ${e.deltaY > 0 ? 'kanan' : 'kiri'} (Shift + Scroll)`);
    }
  }, { passive: false });

  // ===== HILANGKAN PESAN "CONSOLE ASSETS SHORTCUTS" =====
  (function() {
    const originalLog = console.log;
    const originalWarn = console.warn;
    const originalError = console.error;
    const originalInfo = console.info;
    
    console.log = function(...args) {
      const message = args.join(' ');
      if (!message.includes('Console Assets Shortcuts') && 
          !message.includes('assets shortcuts') &&
          !message.includes('assets-shortcuts')) {
        originalLog.apply(console, args);
      }
    };
    
    console.warn = function(...args) {
      const message = args.join(' ');
      if (!message.includes('Console Assets Shortcuts') &&
          !message.includes('assets shortcuts') &&
          !message.includes('assets-shortcuts')) {
        originalWarn.apply(console, args);
      }
    };
    
    console.error = function(...args) {
      const message = args.join(' ');
      if (!message.includes('Console Assets Shortcuts') &&
          !message.includes('assets shortcuts') &&
          !message.includes('assets-shortcuts')) {
        originalError.apply(console, args);
      }
    };
    
    console.info = function(...args) {
      const message = args.join(' ');
      if (!message.includes('Console Assets Shortcuts') &&
          !message.includes('assets shortcuts') &&
          !message.includes('assets-shortcuts')) {
        originalInfo.apply(console, args);
      }
    };
    
    setTimeout(() => {
      console.clear();
      console.log(" MAWARTOTO - Jadwal Offday System");
      console.log("  Sistem berjalan dengan baik");
      console.log(" Gunakan Shift + Scroll mouse untuk geser horizontal");
      console.log(" Gunakan Ctrl+Z untuk undo, Ctrl+Y untuk redo");
      console.log(" Sekarang tersedia 10 slot per tanggal di offday");
      console.log(" Data tidak terhapus otomatis - sistem penyimpanan permanen");
      console.log(" Tombol Reset Bagan tersedia di panel Bagan");
    }, 1000);
  })();

  // =========================
  // EFEK VISUAL BARU
  // =========================

  function createFallingStars() {
    const container = document.createElement('div');
    container.className = 'falling-stars';
    
    for (let i = 0; i < 15; i++) {
      const star = document.createElement('div');
      const isMoon = Math.random() > 0.7;
      star.className = `falling-star ${isMoon ? 'moon' : 'star'}`;
      
      const size = isMoon ? 
        Math.random() * 15 + 10 : 
        Math.random() * 8 + 5;
      
      const left = Math.random() * 100;
      const duration = Math.random() * 10 + 15;
      const delay = Math.random() * 10;
      
      Object.assign(star.style, {
        width: `${size}px`,
        height: `${size}px`,
        left: `${left}vw`,
        top: '-100px',
        animation: `fallingStar ${duration}s linear infinite`,
        animationDelay: `${delay}s`,
        opacity: '0'
      });
      
      container.appendChild(star);
    }
    
    document.body.appendChild(container);
  }

  function createFloatingRoses() {
    const container = document.createElement('div');
    container.className = 'floating-roses';
    
    for (let i = 0; i < 8; i++) {
      const rose = document.createElement('div');
      const sizes = ['large', 'medium', 'small'];
      const size = sizes[i % 3];
      
      rose.className = `floating-rose ${size}`;
      
      const left = Math.random() * 100;
      const duration = Math.random() * 10 + 20;
      const delay = Math.random() * 15;
      
      Object.assign(rose.style, {
        left: `${left}vw`,
        animation: `floatRose ${duration}s linear infinite`,
        animationDelay: `${delay}s`
      });
      
      container.appendChild(rose);
    }
    
    document.body.appendChild(container);
  }

  function createStarfield() {
    const starsContainer = document.createElement('div');
    starsContainer.className = 'starfield';
    starsContainer.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -3;
    `;
    
    for (let i = 0; i < 100; i++) {
      const star = document.createElement('div');
      const size = Math.random() * 2 + 1;
      const left = Math.random() * 100;
      const top = Math.random() * 100;
      const opacity = Math.random() * 0.5 + 0.2;
      const twinkleDelay = Math.random() * 5;
      
      star.style.cssText = `
        position: absolute;
        width: ${size}px;
        height: ${size}px;
        background: rgba(255, 255, 255, ${opacity});
        border-radius: 50%;
        left: ${left}vw;
        top: ${top}vh;
        box-shadow: 0 0 ${size * 2}px rgba(255, 255, 255, ${opacity * 0.5});
        animation: twinkle ${Math.random() * 3 + 2}s ease-in-out infinite;
        animation-delay: ${twinkleDelay}s;
      `;
      
      starsContainer.appendChild(star);
    }
    
    document.body.appendChild(starsContainer);
  }

  const style = document.createElement('style');
  style.textContent = `
    @keyframes twinkle {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }
  `;
  document.head.appendChild(style);

  // ===== INISIALISASI SEMUA EFEK VISUAL =====
  function initVisualEffects() {
    createStarfield();
    createFloatingRoses();
    createFallingStars();
    
    document.querySelectorAll('.panel').forEach(panel => {
      panel.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
      panel.addEventListener('mouseenter', () => {
        if (window.innerWidth > 768) {
          panel.style.transform = 'translateY(-5px)';
          panel.style.boxShadow = '0 25px 70px rgba(0, 0, 0, 0.6)';
        }
      });
      
      panel.addEventListener('mouseleave', () => {
        panel.style.transform = 'translateY(0)';
        panel.style.boxShadow = 'var(--shadow)';
      });
    });
    
    document.querySelectorAll('#topTabs .tab-btn').forEach(tab => {
      tab.addEventListener('click', function(e) {
        const ripple = document.createElement('span');
        const rect = this.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const x = e.clientX - rect.left - size / 2;
        const y = e.clientY - rect.top - size / 2;
        
        ripple.style.cssText = `
          position: absolute;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.3);
          transform: scale(0);
          animation: ripple 0.6s linear;
          width: ${size}px;
          height: ${size}px;
          left: ${x}px;
          top: ${y}px;
          pointer-events: none;
        `;
        
        this.appendChild(ripple);
        
        setTimeout(() => {
          ripple.remove();
        }, 600);
      });
    });
    
    const rippleStyle = document.createElement('style');
    rippleStyle.textContent = `
      @keyframes ripple {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(rippleStyle);
  }

  // ===== RESET EFEK VISUAL SAAT RESIZE =====
  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      document.querySelectorAll('.falling-stars, .floating-roses, .starfield').forEach(el => {
        if (el.parentNode) {
          el.parentNode.removeChild(el);
        }
      });
      
      if (window.innerWidth > 480) {
        initVisualEffects();
      }
    }, 250);
  });

  // ===== EVENT LISTENER UNTUK UNDO/REDO =====
  document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && !e.altKey) {
      if (e.key === 'z' || e.key === 'Z') {
        e.preventDefault();
        if (activeFilterType === "BAGAN_VIEW") {
          if (e.shiftKey) {
            redoBagan();
          } else {
            undoBagan();
          }
        } else {
          if (e.shiftKey) {
            redo();
          } else {
            undo();
          }
        }
      } else if (e.key === 'y' || e.key === 'Y') {
        e.preventDefault();
        if (activeFilterType === "BAGAN_VIEW") {
          redoBagan();
        } else {
          redo();
        }
      }
    }
  });

  // ===== SETUP TOMBOL UNDO/REDO =====
  $("#undoBtn").onclick = () => {
    if (activeFilterType === "BAGAN_VIEW") {
      undoBagan();
    } else {
      undo();
    }
  };

  $("#redoBtn").onclick = () => {
    if (activeFilterType === "BAGAN_VIEW") {
      redoBagan();
    } else {
      redo();
    }
  };

  window.addEventListener("load", () => {
    updateLockUI();
    initTopTabs();
    renderWeekdays();
    
    migrateData();
    
    renderCalendar();
    setActiveTab("ALL");
    updateDeleteSeatUI();
    renderCSTable();
    setupCatatanForm();
    setupExcelEvents();
    setupNamaEvents();

    startRealtimeSync();

    setTimeout(() => {
      initVisualEffects();
    }, 500);

    setTimeout(() => {
      dbRef.once("value").then(snap => {
        if (!snap.exists()) pushNow();
      }).catch(()=>{});
    }, 500);
    
    // Inisialisasi tombol undo/redo
    updateUndoRedoButtons();
  });
})();
</script>

<script>
  document.addEventListener("contextmenu", e => e.preventDefault());

  document.onkeydown = function(e) {
    if (e.keyCode === 123) {
      alert("MAEN KALI AHHH");
      return false;
    }

    if (e.ctrlKey && e.shiftKey && e.keyCode === 73) {
      alert("MAEN KALI AHHH");
      return false;
    }

    if (e.ctrlKey && e.shiftKey && e.keyCode === 74) {
      alert("OWALAHHH");
      return false;
    }

    if (e.ctrlKey && e.shiftKey && e.keyCode === 67) {
      alert("EAA GAK NYERAH YAA");
      return false;
    }

    if (e.ctrlKey && e.keyCode === 85) {
      alert("WOPSS MASOKK DIAAA");
      return false;
    }
  };
</script>
</body>
</html>
